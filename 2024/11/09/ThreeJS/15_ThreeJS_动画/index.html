<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>15_ThreeJS_动画 | 春和景明的记事本</title><meta name="author" content="Scenery"><meta name="copyright" content="Scenery"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="关键帧动画1 整体流程12345678910111213141516171819202122232425262728293031const group &amp;#x3D; new THREE.Group();&amp;#x2F;&amp;#x2F; 添加一个正方体const geometry &amp;#x3D; new THREE.BoxGeometry(50, 5"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vernalscenery.github.io/2024/11/09/ThreeJS/15_ThreeJS_%E5%8A%A8%E7%94%BB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '15_ThreeJS_动画',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-12 11:27:48'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">59</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/1.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="春和景明的记事本"><span class="site-name">春和景明的记事本</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">15_ThreeJS_动画</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-09T01:31:11.000Z" title="发表于 2024-11-09 09:31:11">2024-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-12T03:27:48.235Z" title="更新于 2024-11-12 11:27:48">2024-11-12</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>43分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="15_ThreeJS_动画"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="关键帧动画"><a href="#关键帧动画" class="headerlink" title="关键帧动画"></a>关键帧动画</h1><h2 id="1-整体流程"><a href="#1-整体流程" class="headerlink" title="1 整体流程"></a>1 整体流程</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line"><span class="comment">// 添加一个正方体</span></span><br><span class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="number">0x0000ff</span>, <span class="comment">//设置材质颜色</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span><br><span class="line"><span class="keyword">const</span> mesh2 = mesh.<span class="title function_">clone</span>(); <span class="comment">// 共享材质</span></span><br><span class="line">mesh2.<span class="property">position</span>.<span class="property">y</span> += <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 给需要设置关键帧动画的模型命名</span></span><br><span class="line">mesh.<span class="property">name</span> = <span class="string">&#x27;Box&#x27;</span>; <span class="comment">// 命名用于区分</span></span><br><span class="line">group.<span class="title function_">add</span>(mesh, mesh2); <span class="comment">// 添加到组里</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.给名为Box的模型对象的设置关键帧数据KeyframeTrack</span></span><br><span class="line"><span class="keyword">const</span> times = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>]; <span class="comment">//时间轴上，设置三个时刻0、3、6秒</span></span><br><span class="line"><span class="comment">// times中三个不同时间点，物体分别对应values中的三个xyz坐标</span></span><br><span class="line"><span class="keyword">const</span> values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>];</span><br><span class="line"><span class="comment">// 0~3秒，物体从(0,0,0)逐渐移动到(100,0,0),3~6秒逐渐从(100,0,0)移动到(0,0,100)</span></span><br><span class="line"><span class="keyword">const</span> posKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.position&#x27;</span>, times, values);</span><br><span class="line"><span class="comment">// 从2秒到5秒，物体从红色逐渐变化为蓝色</span></span><br><span class="line"><span class="keyword">const</span> colorKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.material.color&#x27;</span>, [<span class="number">2</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.基于关键帧数据，创建一个clip关键帧动画对象，命名&quot;test&quot;，持续时间6秒。</span></span><br><span class="line">clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&#x27;test&#x27;</span>, <span class="number">6</span>, [posKF, colorKF]);</span><br><span class="line"><span class="comment">// 3.包含关键帧动画的模型对象作为AnimationMixer的参数创建一个播放器mixer</span></span><br><span class="line"><span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(group); <span class="comment">// 会自动识别组里的所有模型，根据name设置动画</span></span><br><span class="line"><span class="comment">// 4.AnimationMixer的`.clipAction()`返回一个AnimationAction对象</span></span><br><span class="line"><span class="keyword">const</span> clipAction = mixer.<span class="title function_">clipAction</span>(clip); </span><br><span class="line"><span class="comment">//.play()控制动画播放，默认循环播放</span></span><br><span class="line">clipAction.<span class="title function_">play</span>(); </span><br></pre></td></tr></table></figure>

<p>整体上就是分为 四步：</p>
<ol>
<li>基于相对应的 <code>times</code> 和 <code>values</code>，与模型属性相绑定，创建关键帧数据<code>KeyframeTrack</code></li>
<li>基于<strong>关键帧数据</strong>，创建关键帧动画对象<code>AnimationClip</code></li>
<li>基于关键帧动画的<strong>模型对象</strong>，创建动画混合播放器 <code>AnimationMixer</code></li>
<li>基于<strong>clip</strong>关键帧动画对象和播放器 <strong>mixer</strong>创建动画<code>AnimationAction</code></li>
</ol>
<h2 id="2-KeyframeTrack-关键帧数据"><a href="#2-KeyframeTrack-关键帧数据" class="headerlink" title="2 KeyframeTrack 关键帧数据"></a>2 KeyframeTrack 关键帧数据</h2><blockquote>
<p>关键帧轨道(KeyframeTrack)是关键帧(<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Key_frame">keyframes</a>)的定时序列, 它由时间和相关值的列表组成, 用来让一个对象的某个特定属性动起来。</p>
<p>关键帧轨道(KeyframeTrack)中总是存在两个数组：<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/animation/KeyframeTrack.times" title="KeyframeTrack.times">times</a>数组按顺序存储该轨道的所有关键帧的时间值，而<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/animation/KeyframeTrack.values" title="KeyframeTrack.values">values</a>数组包含动画属性的相应更改值。</p>
</blockquote>
<h3 id="2-1-构造函数"><a href="#2-1-构造函数" class="headerlink" title="2.1 构造函数"></a>2.1 构造函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">KeyframeTrack</span>( name : <span class="title class_">String</span>, times : <span class="title class_">Array</span>, values : <span class="title class_">Array</span>, interpolation : <span class="title class_">Constant</span> )</span><br></pre></td></tr></table></figure>

<ul>
<li><code>name</code> - 关键帧轨道(KeyframeTrack)的标识符.</li>
<li><code>times</code> - 关键帧的时间数组, 被内部转化为 Float32Array.</li>
<li><code>values</code> - 与时间数组中的时间点相关的值组成的数组, 被内部转化为 Float32Array.</li>
<li><code>interpolation</code> - 使用的插值类型。 参见 Animation Constants for possible values. Default is InterpolateLinear.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.给名为Box的模型对象的设置关键帧数据KeyframeTrack</span></span><br><span class="line"><span class="keyword">const</span> times = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>]; <span class="comment">//时间轴上，设置三个时刻0、3、6秒</span></span><br><span class="line"><span class="comment">// times中三个不同时间点，物体分别对应values中的三个xyz坐标</span></span><br><span class="line"><span class="keyword">const</span> values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>];</span><br><span class="line"><span class="comment">// 0~3秒，物体从(0,0,0)逐渐移动到(100,0,0),3~6秒逐渐从(100,0,0)移动到(0,0,100)</span></span><br><span class="line"><span class="keyword">const</span> posKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.position&#x27;</span>, times, values);</span><br></pre></td></tr></table></figure>

<h3 id="2-2-属性"><a href="#2-2-属性" class="headerlink" title="2.2 属性"></a>2.2 属性</h3><p>同方法</p>
<h3 id="2-3-方法"><a href="#2-3-方法" class="headerlink" title="2.3 方法"></a>2.3 方法</h3><ul>
<li><p><code>.createInterpolant () : Interpolant</code><br>根据传入构造器中的插值类型参数，创建线性插值(LinearInterpolant)，立方插值(CubicInterpolant)或离散插值 (DiscreteInterpolant)</p>
</li>
<li><p><code>.setInterpolation ( interpolationType : Constant ) : this</code><br>设置插值类型。 参阅Animation Constants以供选择。</p>
</li>
<li><p><code>.getInterpolation () : Interpolant</code><br>返回插值类型</p>
</li>
<li><p><code>.scale () : this</code><br>缩放所有关键帧的时间。</p>
</li>
<li><p><code>.shift ( timeOffsetInSeconds : Number ) : this</code><br>及时删除之前或之后的所有关键帧。</p>
</li>
<li><p><code>.trim ( startTimeInSeconds : Number, endTimeInSeconds : Number ) : this</code><br>删除开始时间(startTime)之前以及结束时间(endTime)之后的关键帧，不改变[startTime, endTime]范围内的任何值。</p>
</li>
</ul>
<h2 id="3-AnimationClip-关键帧动画对象"><a href="#3-AnimationClip-关键帧动画对象" class="headerlink" title="3 AnimationClip 关键帧动画对象"></a>3 AnimationClip 关键帧动画对象</h2><blockquote>
<p>动画剪辑（AnimationClip）是一个可重用的关键帧轨道集，它代表动画。</p>
</blockquote>
<h3 id="3-1-构造函数"><a href="#3-1-构造函数" class="headerlink" title="3.1 构造函数"></a>3.1 构造函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AnimationClip</span>( name : <span class="title class_">String</span>, duration : <span class="title class_">Number</span>, tracks : <span class="title class_">Array</span> )</span><br></pre></td></tr></table></figure>

<ul>
<li><code>name</code> - 此剪辑的名称</li>
<li><code>duration</code> - 持续时间 (单位秒). 如果传入负数, 持续时间将会从传入的数组中计算得到。</li>
<li><code>tracks</code> - 一个由关键帧轨道（KeyframeTracks）组成的数组。</li>
</ul>
<p>说明: 与其直接调用构造函数实例化一个动画剪辑, 不如使用其静态方法中的一个来创建： </p>
<ul>
<li>用JSON (parse)</li>
<li>用变形目标序列(CreateFromMorphTargetSequence, CreateClipsFromMorphTargetSequences)</li>
<li>用动画层级 (parseAnimation)来创建 </li>
</ul>
<h3 id="3-2-属性"><a href="#3-2-属性" class="headerlink" title="3.2 属性"></a>3.2 属性</h3><ul>
<li><p><code>.duration : Number</code><br>剪辑的持续时间 (单位秒). 可以通过resetDuration从轨道数组（tracks）计算出来。</p>
</li>
<li><p><code>.name : String</code><br>剪辑的名称. 调用findByName根据名称搜索某个剪辑</p>
</li>
<li><p><code>.tracks : Array</code><br>一个包含该剪辑中有动画的所有属性的关键帧轨道（KeyframeTrack）的数组。</p>
</li>
<li><p><code>.uuid : String</code><br>剪辑实例的UUID，自动分配且不可编辑。</p>
</li>
</ul>
<h3 id="3-3-方法"><a href="#3-3-方法" class="headerlink" title="3.3 方法"></a>3.3 方法</h3><ul>
<li><p><code>.clone () : AnimationClip</code></p>
</li>
<li><p><code>.optimize () : this</code><br>通过移除等效的顺序键（在变形目标序列中很常见）来优化每一个轨道</p>
</li>
<li><p><code>.resetDuration () : this</code><br>将剪辑的持续时间（duration）设为最长的关键帧轨道(KeyframeTrack)的持续时间。</p>
</li>
<li><p><code>.toJSON () : Object</code><br>Returns a JSON object representing the serialized animation clip.</p>
</li>
<li><p><code>.trim () : this</code><br>修剪所有的轨道到该剪辑的持续时间。</p>
</li>
<li><p><code>.validate () : Boolean</code><br>对剪辑中的每个轨道执行最小验证。如果所有轨道都有效，返回true。</p>
</li>
</ul>
<h3 id="3-4-静态方法"><a href="#3-4-静态方法" class="headerlink" title="3.4 静态方法"></a>3.4 静态方法</h3><ul>
<li><p><code>.findByName ( objectOrClipArray : Object, name : String ) : AnimationClip</code><br>根据名称搜索动画剪辑(AnimationClip), 接收一个动画剪辑数组或者一个包含名为”animation”的数组的网格（或几何体）作为第一个参数。</p>
</li>
<li><p><code>.parse ( json : Object ) : AnimationClip</code><br>解析剪辑的JSON表示，并返回一个动画剪辑(AnimationClip)。</p>
</li>
<li><p><code>.toJSON ( clip : AnimationClip ) : Object</code><br>接收一个动画剪辑为参数并返回一个JSON对象.</p>
</li>
</ul>
<h2 id="4-AnimationMixer-动画混合器"><a href="#4-AnimationMixer-动画混合器" class="headerlink" title="4 AnimationMixer 动画混合器"></a>4 AnimationMixer 动画混合器</h2><blockquote>
<p>动画混合器是用于场景中特定对象的动画的播放器。当场景中的多个对象独立动画时，每个对象都可以使用同一个动画混合器。</p>
</blockquote>
<h3 id="4-1-构造函数"><a href="#4-1-构造函数" class="headerlink" title="4.1 构造函数"></a>4.1 构造函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AnimationMixer</span>( rootObject : <span class="title class_">Object3D</span> )</span><br></pre></td></tr></table></figure>

<p><code>rootObject </code>：混合器播放的动画所属的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(group); <span class="comment">// 会自动识别组里的所有模型，根据name设置动画</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-方法"><a href="#4-2-方法" class="headerlink" title="4.2 方法"></a>4.2 方法</h3><ul>
<li><p><code>.clipAction (clip : AnimationClip, optionalRoot : Object3D) : AnimationAction</code><br>  返回所传入的剪辑参数的AnimationAction, 根对象参数可选，默认值为混合器的默认根对象。第一个参数可以是动画剪辑(AnimationClip)对象或者动画剪辑的名称。如果不存在符合传入的剪辑和根对象这两个参数的动作, 该方法将会创建一个。传入相同的参数多次调用将会返回同一个剪辑实例。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> clipAction = mixer.<span class="title function_">clipAction</span>(clip); </span><br></pre></td></tr></table></figure></li>
<li><p><code>.getRoot () : Object3D</code><br>  返回混合器的根对象</p>
</li>
<li><p><code>.update (deltaTimeInSeconds : Number) : this</code><br>推进混合器时间并更新动画<br><strong>通常在渲染循环中完成, 传入按照混合器的时间比例(<code>timeScale</code>)缩放过的<code>clock.getDelta</code></strong></p>
</li>
<li><p><code>.uncacheClip (clip : AnimationClip) : undefined</code><br>释放剪辑的所有内存资源</p>
</li>
<li><p><code>.uncacheRoot (root : Object3D) : undefined</code><br>释放根对象的所有内存资源</p>
</li>
<li><p><code>.uncacheAction (clip : AnimationClip, optionalRoot : Object3D) : undefined</code><br>释放动作的所有内存资源</p>
</li>
</ul>
<h2 id="5-AnimationAction"><a href="#5-AnimationAction" class="headerlink" title="5 AnimationAction"></a>5 AnimationAction</h2><blockquote>
<p>AnimationActions 用来调度存储在<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/animation/AnimationClip" title="AnimationClip">AnimationClips</a>中的动画。  </p>
<p>说明: AnimationAction的大多数方法都可以<strong>链式调用</strong></p>
</blockquote>
<h3 id="5-1-构造函数"><a href="#5-1-构造函数" class="headerlink" title="5.1 构造函数"></a>5.1 构造函数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">AnimationAction</span>( mixer : <span class="title class_">AnimationMixer</span>, clip : <span class="title class_">AnimationClip</span>, localRoot : <span class="title class_">Object3D</span> )</span><br></pre></td></tr></table></figure>

<ul>
<li><code>mixer</code> - 被此动作控制的 动画混合器</li>
<li><code>clip</code> - 动画剪辑 保存了此动作当中的动画数据</li>
<li><code>localRoot</code> - 动作执行的根对象</li>
</ul>
<p>说明: <strong>不要直接调用这个构造函数</strong>，而应该先用<code>AnimationMixer.clipAction</code>实例化一个AnimationAction，因为这个方法提供了缓存以提高性能。</p>
<h3 id="5-2-属性"><a href="#5-2-属性" class="headerlink" title="5.2 属性"></a>5.2 属性</h3><ul>
<li><p><code>.time : Number</code><br>  动作开始的时间点 (单位是秒, 从0开始计时)。</p>
</li>
<li><p><code>.loop : Number</code><br>  循环模式 (可以通过setLoop改变)。默认值是 THREE.LoopRepeat (重复repetitions次数无穷)<br>  必须是以下值之一：<br>  THREE.LoopOnce - 只执行一次<br>  THREE.LoopRepeat - 重复次数为repetitions的值, 且每次循环结束时候将回到起始动作开始下一次循环。<br>  THREE.LoopPingPong - 重复次数为repetitions的值, 且像乒乓球一样在起始点与结束点之间来回循环。</p>
</li>
<li><p><code>.repetitions : Number</code><br>  整个动作过程动画剪辑（AnimationClip）执行的次数，可以通过setLoop修改。默认值是Infinity<br>  如果循环模式（loop mode）值被设置为THREE.LoopOnce，repetitions值将会无效。</p>
</li>
<li><p><code>.paused : Boolean</code><br>  paused置为true会通过将动作的有效时间比例改为0来使动作暂停执行。默认值是false</p>
</li>
<li><p><code>.clampWhenFinished : Boolean</code><br>  如果 clampWhenFinished 值设为true, 那么动画将在最后一帧之后自动暂停（paused）</p>
</li>
<li><p>.<code>timeScale : Number</code><br>  时间(time)的比例因子. 值为0时会使动画暂停。值为负数时动画会反向执行。默认值是1。<br>  <strong>设置倍速播放的</strong></p>
</li>
<li><p><code>.weight : Number</code><br>  动作的影响程度 (取值范围[0, 1]). 0 (无影响)到1（完全影响）之间的值可以用来混合多个动作。默认值是1</p>
</li>
</ul>
<h3 id="5-3-方法"><a href="#5-3-方法" class="headerlink" title="5.3 方法"></a>5.3 方法</h3><ul>
<li><p><code>.play () : this</code><br>  让混合器激活动作。此方法可链式调用。<br>  说明: 激活动作并不意味着动画会立刻开始: 如果动作在此之前已经完成（到达最后一次循环的结尾），或者如果已经设置了延时 启动(通过 startAt)，则必须先执行重置操作（reset）。 一些其它的设置项 (paused=true, enabled=false, weight=0, timeScale=0) 也可以阻止动画的开始。</p>
</li>
<li><p><code>.reset () : this</code><br>  重置动作。此方法可链式调用。</p>
</li>
<li><p><code>.stop () : this</code><br>  让混合器停止动作。该方法可以被链式调用<br>  动作会马上停止以及完全[page:.reset 重置].<br>  说明: 你可以通过mixer.stopAllAction在一个混合器中一举停止所有处于激活态的动作。</p>
</li>
</ul>
<h3 id="5-4-案例-动画播放-暂停、倍速、循环"><a href="#5-4-案例-动画播放-暂停、倍速、循环" class="headerlink" title="5.4 案例_动画播放 (暂停、倍速、循环)"></a>5.4 案例_动画播放 (暂停、倍速、循环)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;scene&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleStar&quot;</span>&gt;</span>&#123;&#123; starText &#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handlePause&quot;</span>&gt;</span>&#123;&#123; pauseText &#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; onBeforeUnmount, onMounted, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Motor3</span>d <span class="keyword">from</span> <span class="string">&#x27;../../utils/motor3d&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">motor3d</span>: <span class="title class_">Motor3</span>d;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">clipAction</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">clip</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationClip</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> starText = <span class="title function_">ref</span>(<span class="string">&#x27;播放&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> pauseText = <span class="title function_">ref</span>(<span class="string">&#x27;暂停&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handleStar</span> = (<span class="params">e: any</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (starText.<span class="property">value</span> === <span class="string">&#x27;播放&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 一共是0-6秒 现在只播放其中的3-5秒</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">time</span> = <span class="number">3</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clip.<span class="property">duration</span> = <span class="number">5</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">paused</span> = <span class="literal">false</span>; <span class="comment">// 把暂停取消</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="title function_">play</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    starText.<span class="property">value</span> = <span class="string">&#x27;停止&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="title function_">stop</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handlePause</span> = (<span class="params">e: any</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (pauseText.<span class="property">value</span> === <span class="string">&#x27;暂停&#x27;</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">paused</span> = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    pauseText.<span class="property">value</span> = <span class="string">&#x27;继续&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125; <span class="keyword">else</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">paused</span> = <span class="literal">false</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    pauseText.<span class="property">value</span> = <span class="string">&#x27;暂停&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">init</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 添加一个正方体</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">color</span>: <span class="number">0x0000ff</span>, <span class="comment">//设置材质颜色</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> mesh2 = mesh.<span class="title function_">clone</span>(); <span class="comment">// 共享材质</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  mesh2.<span class="property">position</span>.<span class="property">y</span> += <span class="number">100</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 给需要设置关键帧动画的模型命名</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  mesh.<span class="property">name</span> = <span class="string">&#x27;Box&#x27;</span>; <span class="comment">// 命名用于区分</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  group.<span class="title function_">add</span>(mesh, mesh2); <span class="comment">// 添加到组里</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 给名为Box的模型对象的设置关键帧数据KeyframeTrack</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> times = [<span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>]; <span class="comment">//时间轴上，设置三个时刻0、3、6秒</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// times中三个不同时间点，物体分别对应values中的三个xyz坐标</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> values = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 0~3秒，物体从(0,0,0)逐渐移动到(100,0,0),3~6秒逐渐从(100,0,0)移动到(0,0,100)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> posKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.position&#x27;</span>, times, values);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 从2秒到5秒，物体从红色逐渐变化为蓝色</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> colorKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.material.color&#x27;</span>, [<span class="number">2</span>, <span class="number">5</span>], [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 1.3 基于关键帧数据，创建一个clip关键帧动画对象，命名&quot;test&quot;，持续时间6秒。</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&#x27;test&#x27;</span>, <span class="number">6</span>, [posKF, colorKF]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 包含关键帧动画的模型对象作为AnimationMixer的参数创建一个播放器mixer</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(group); <span class="comment">// 会自动识别组里的所有模型，根据name设置动画</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 监听动画播放完成事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  mixer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;finished&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    pauseText.<span class="property">value</span> = <span class="string">&#x27;暂停&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="title function_">reset</span>(); <span class="comment">// 重新开始新的动画播放</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">paused</span> = <span class="literal">true</span>; <span class="comment">// 切换为暂停状态</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// AnimationMixer的`.clipAction()`返回一个AnimationAction对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  clipAction = mixer.<span class="title function_">clipAction</span>(clip);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">/* 动画相关属性设置 */</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">//不循环播放，执行一次后默认回到动画开头</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  clipAction.<span class="property">loop</span> = <span class="variable constant_">THREE</span>.<span class="property">LoopOnce</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 物体状态停留在动画结束的时候</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  clipAction.<span class="property">clampWhenFinished</span> = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 0~2倍速之间调节</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(clipAction, <span class="string">&#x27;timeScale&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;动画倍速&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 任意时刻动画帧</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> timeController = motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(clipAction, <span class="string">&#x27;time&#x27;</span>, <span class="number">0</span>, clip.<span class="property">duration</span>).<span class="title function_">step</span>(<span class="number">1</span>).<span class="title function_">name</span>(<span class="string">&#x27;任意时刻&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 监听时间变化</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  timeController.<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`时间改变: <span class="subst">$&#123;value&#125;</span>`</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 开始播放后立即暂停</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="title function_">play</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">paused</span> = <span class="literal">true</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    clipAction.<span class="property">time</span> = value;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    pauseText.<span class="property">value</span> = <span class="string">&#x27;继续&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">addGroup</span>(group);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> frameT = clock.<span class="title function_">getDelta</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    mixer.<span class="title function_">update</span>(frameT); <span class="comment">// 更新播放器相关的时间</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">render</span>(loop);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (motor3d) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="title function_">destroy</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-id">#scene</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">overflow</span>: hidden; <span class="comment">/* 去除滚动条 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin</span>: <span class="number">0px</span>; <span class="comment">/* 去除外边距 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.control-box</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">top</span>: <span class="number">70px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">left</span>: <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-11-12-09-23-51.gif" alt="2024-11-12-09-23-51.gif|632"></p>
<p><strong>注意：</strong></p>
<p>从时间轴上选择时间段播放动画，开始时刻<code>AnimationAction.time</code>，结束时刻<code>AnimationClip.duration</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//AnimationAction设置开始播放时间：从1秒时刻对应动画开始播放</span></span><br><span class="line">clipAction.<span class="property">time</span> = <span class="number">1</span>; </span><br><span class="line"><span class="comment">//AnimationClip设置播放结束时间：到5秒时刻对应的动画状态停止</span></span><br><span class="line">clip.<span class="property">duration</span> = <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>事件监听</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听动画播放完成事件</span></span><br><span class="line">mixer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;finished&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span><br><span class="line">  pauseText.<span class="property">value</span> = <span class="string">&#x27;暂停&#x27;</span>;</span><br><span class="line">  clipAction.<span class="title function_">reset</span>(); <span class="comment">// 重新开始新的动画播放</span></span><br><span class="line">  clipAction.<span class="property">paused</span> = <span class="literal">true</span>; <span class="comment">// 切换为暂停状态</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>GUI 相关</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 任意时刻动画帧</span></span><br><span class="line">  <span class="keyword">const</span> timeController = motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(clipAction, <span class="string">&#x27;time&#x27;</span>, <span class="number">0</span>, clip.<span class="property">duration</span>).<span class="title function_">step</span>(<span class="number">1</span>).<span class="title function_">name</span>(<span class="string">&#x27;任意时刻&#x27;</span>);</span><br><span class="line">  <span class="comment">// 监听时间变化</span></span><br><span class="line">  timeController.<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`时间改变: <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">    <span class="comment">// 开始播放后立即暂停</span></span><br><span class="line">    clipAction.<span class="title function_">play</span>();</span><br><span class="line">    clipAction.<span class="property">paused</span> = <span class="literal">true</span>;</span><br><span class="line">    clipAction.<span class="property">time</span> = value;</span><br><span class="line">    starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span><br><span class="line">    pauseText.<span class="property">value</span> = <span class="string">&#x27;继续&#x27;</span>;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="6-解析外部模型关键帧动画"><a href="#6-解析外部模型关键帧动画" class="headerlink" title="6 解析外部模型关键帧动画"></a>6 解析外部模型关键帧动画</h2><p>加载gltf模型，如果存在帧动画数据的话，可以通过加载返回gltf对象的动画属性<code>.animations</code>获取。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/机械装配动画.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;动画数据&#x27;</span>, gltf.<span class="property">animations</span>);</span><br><span class="line">    group.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 包含关键帧动画的模型作为参数创建一个播放器</span></span><br><span class="line">    mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    <span class="comment">// 监听动画播放完成事件</span></span><br><span class="line">    mixer.<span class="title function_">addEventListener</span>(<span class="string">&#x27;finished&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span><br><span class="line">      pauseText.<span class="property">value</span> = <span class="string">&#x27;暂停&#x27;</span>;</span><br><span class="line">      clipAction.<span class="title function_">reset</span>(); <span class="comment">// 重新开始新的动画播放</span></span><br><span class="line">      clipAction.<span class="property">paused</span> = <span class="literal">true</span>; <span class="comment">//切换为暂停状态</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取gltf.animations[0]的第一个clip动画对象</span></span><br><span class="line">    clip = gltf.<span class="property">animations</span>[<span class="number">0</span>];</span><br><span class="line">    clipAction = mixer.<span class="title function_">clipAction</span>(clip); <span class="comment">//创建动画clipAction对象</span></span><br><span class="line">    clipAction.<span class="property">loop</span> = <span class="variable constant_">THREE</span>.<span class="property">LoopOnce</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0~2 倍速之间调节</span></span><br><span class="line">    motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(clipAction, <span class="string">&#x27;timeScale&#x27;</span>, <span class="number">0</span>, <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;动画倍速&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 任意时刻动画帧</span></span><br><span class="line">    <span class="keyword">const</span> timeController = motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(clipAction, <span class="string">&#x27;time&#x27;</span>, <span class="number">0</span>, clip.<span class="property">duration</span>).<span class="title function_">step</span>(<span class="number">1</span>).<span class="title function_">name</span>(<span class="string">&#x27;任意时刻&#x27;</span>);</span><br><span class="line">    <span class="comment">// 监听时间变化</span></span><br><span class="line">    timeController.<span class="title function_">onChange</span>(<span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`时间改变: <span class="subst">$&#123;value&#125;</span>`</span>);</span><br><span class="line">      <span class="comment">// 开始播放后立即暂停</span></span><br><span class="line">      clipAction.<span class="title function_">play</span>();</span><br><span class="line">      clipAction.<span class="property">paused</span> = <span class="literal">true</span>;</span><br><span class="line">      clipAction.<span class="property">time</span> = value;</span><br><span class="line">      starText.<span class="property">value</span> = <span class="string">&#x27;播放&#x27;</span>;</span><br><span class="line">      pauseText.<span class="property">value</span> = <span class="string">&#x27;继续&#x27;</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="变形动画"><a href="#变形动画" class="headerlink" title="变形动画"></a>变形动画</h1><h2 id="1-整体流程-1"><a href="#1-整体流程-1" class="headerlink" title="1 整体流程"></a>1 整体流程</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//几何体两组顶点一一对应，位置不同，然后通过权重系数，可以控制模型形状在两组顶点之间变化</span></span><br><span class="line"><span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">50</span>, <span class="number">50</span>, <span class="number">50</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshNormalMaterial</span>();</span><br><span class="line"><span class="comment">// 为geometry提供变形目标的顶点数据(注意和原始geometry顶点数量一致)</span></span><br><span class="line"><span class="keyword">const</span> target1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">50</span>, <span class="number">200</span>, <span class="number">50</span>).<span class="property">attributes</span>.<span class="property">position</span>; <span class="comment">//变高</span></span><br><span class="line"><span class="keyword">const</span> target2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">10</span>, <span class="number">50</span>, <span class="number">10</span>).<span class="property">attributes</span>.<span class="property">position</span>; <span class="comment">//变细</span></span><br><span class="line"><span class="comment">// 几何体顶点变形目标数据，可以设置1组或多组</span></span><br><span class="line">geometry.<span class="property">morphAttributes</span>.<span class="property">position</span> = [target1, target2]; <span class="comment">//  执行代码new THREE.Mesh()之前设置</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;变形目标影响程度&#x27;</span>, mesh.<span class="property">morphTargetInfluences</span>);</span><br></pre></td></tr></table></figure>

<h3 id="1-1-morphTargetInfluences权重系数控制变形程度"><a href="#1-1-morphTargetInfluences权重系数控制变形程度" class="headerlink" title="1.1 .morphTargetInfluences权重系数控制变形程度"></a>1.1 <code>.morphTargetInfluences</code>权重系数控制变形程度</h3><p>查看文档，你可以看到网格模型<code>Mesh</code>、点模型、线模型都有一个权重属性<code>.morphTargetInfluences</code>，该权重的作用是，控制geometry自身顶点和变形目标顶点分别对模型形状形象程度。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// GUI拖动条可视化改变变形目标权重系数</span></span><br><span class="line">  <span class="keyword">const</span> obj = &#123; <span class="attr">t1</span>: <span class="number">0</span>, <span class="attr">t2</span>: <span class="number">0</span> &#125;;</span><br><span class="line">  motor3d.<span class="property">gui</span></span><br><span class="line">    ?.<span class="title function_">add</span>(obj, <span class="string">&#x27;t1&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">name</span>(<span class="string">&#x27;变形目标1&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onChange</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      mesh.<span class="property">morphTargetInfluences</span>![<span class="number">0</span>] = obj.<span class="property">t1</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">  motor3d.<span class="property">gui</span></span><br><span class="line">    ?.<span class="title function_">add</span>(obj, <span class="string">&#x27;t2&#x27;</span>, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">name</span>(<span class="string">&#x27;变形目标2&#x27;</span>)</span><br><span class="line">    .<span class="title function_">onChange</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      mesh.<span class="property">morphTargetInfluences</span>![<span class="number">1</span>] = obj.<span class="property">t2</span>;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-11-12-09-32-09.gif" alt="2024-11-12-09-32-09.gif|562"></p>
<h4 id="1-1-1-多个变形目标综合影响模型形状"><a href="#1-1-1-多个变形目标综合影响模型形状" class="headerlink" title="1.1.1 多个变形目标综合影响模型形状"></a>1.1.1 多个变形目标综合影响模型形状</h4><p>一个网格模型的几何体geometry可以有多个变形目标，只要对应权重不为0，每个变形目标的形状都会影响模型的形状。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 两个变形目标同时影响模型形状</span></span><br><span class="line">mesh.<span class="property">morphTargetInfluences</span>[<span class="number">1</span>] = <span class="number">0.5</span>;</span><br><span class="line">mesh.<span class="property">morphTargetInfluences</span>[<span class="number">0</span>] = <span class="number">0.5</span>;</span><br></pre></td></tr></table></figure>

<h3 id="1-2-生成变形动画"><a href="#1-2-生成变形动画" class="headerlink" title="1.2 生成变形动画"></a>1.2 生成变形动画</h3><p>生成变形动画的方法非常简单，你只是需要通过关键帧动画，改变模型的变形权重系数即可。</p>
<p>变形动画目标：0<del>5秒，物体变高，5</del>10秒，物体变细。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建变形动画权重系数的关键帧数据</span></span><br><span class="line">mesh.<span class="property">name</span> = <span class="string">&quot;Box&quot;</span>;<span class="comment">//关键帧动画控制的模型对象命名</span></span><br><span class="line"><span class="comment">// 设置变形目标1对应权重随着时间的变化</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">KF1</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.morphTargetInfluences[0]&#x27;</span>, [<span class="number">0</span>, <span class="number">5</span>], [<span class="number">0</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">// 设置变形目标2对应权重随着时间的变化</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">KF2</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;Box.morphTargetInfluences[1]&#x27;</span>, [<span class="number">5</span>, <span class="number">10</span>], [<span class="number">0</span>, <span class="number">1</span>]);</span><br><span class="line"><span class="comment">// 创建一个剪辑clip对象</span></span><br><span class="line"><span class="keyword">const</span> clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&quot;t&quot;</span>, <span class="number">10</span>, [<span class="title class_">KF1</span>, <span class="title class_">KF2</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="2-解析外部变形动画模型"><a href="#2-解析外部变形动画模型" class="headerlink" title="2 解析外部变形动画模型"></a>2 解析外部变形动画模型</h2><p>项目开发，大部分情况下，不需要你代码编辑变形动画的几何体变形数据，通常是在三维建模软件中，比如Blender，编辑好变形数据，你只需要在代码中播放变形动画即可。</p>
<p>播放外部变形动画模型，和你播放其它外部模型的关键帧动画一样，只要美术在三维软件中设置好变形的关键帧动画，你只需要播放关键帧动画即可，不同管内部的变形过程。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">loader.<span class="title function_">load</span>(<span class="string">&quot;./鸟.glb&quot;</span>, <span class="keyword">function</span> (<span class="params">gltf</span>) &#123; </span><br><span class="line">    model.<span class="title function_">add</span>(gltf.<span class="property">scene</span>); </span><br><span class="line"></span><br><span class="line">    <span class="comment">//包含关键帧动画的模型作为参数创建一个播放器</span></span><br><span class="line">    <span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    <span class="comment">//  获取gltf.animations[0]的第一个clip动画对象</span></span><br><span class="line">    <span class="keyword">const</span> clipAction = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">0</span>]);</span><br><span class="line">    clipAction.<span class="title function_">play</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">requestAnimationFrame</span>(loop);</span><br><span class="line">        <span class="keyword">const</span> frameT = clock.<span class="title function_">getDelta</span>();</span><br><span class="line">        <span class="comment">// 更新播放器相关的时间</span></span><br><span class="line">        mixer.<span class="title function_">update</span>(frameT);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">loop</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-1-案例——变形动画-定制人物胖瘦"><a href="#2-1-案例——变形动画-定制人物胖瘦" class="headerlink" title="2.1 案例——变形动画(定制人物胖瘦)"></a>2.1 案例——变形动画(定制人物胖瘦)</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span><br><span class="line">  motor3d.<span class="title function_">init</span>();</span><br><span class="line">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line">  <span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span><br><span class="line">  <span class="keyword">let</span> <span class="attr">mixer</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationMixer</span>;</span><br><span class="line"></span><br><span class="line">  loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/人.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;控制台查看gltf对象结构&#x27;</span>, gltf);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;动画数据&#x27;</span>, gltf.<span class="property">animations</span>);</span><br><span class="line">    group.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 1、变形数据 */</span></span><br><span class="line">    <span class="keyword">const</span> mesh = gltf.<span class="property">scene</span>.<span class="property">children</span>[<span class="number">0</span>] <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>; <span class="comment">// 访问人体网格模型</span></span><br><span class="line">    <span class="comment">// 获取所有变形目标的顶点数据</span></span><br><span class="line">    <span class="keyword">const</span> tArr = mesh.<span class="property">geometry</span>.<span class="property">morphAttributes</span>.<span class="property">position</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;所有变形目标&#x27;</span>, tArr);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;所有权重&#x27;</span>, mesh.<span class="property">morphTargetInfluences</span>);</span><br><span class="line">    <span class="comment">//每个变形目标对应的含义(注意和变形目标对应起来)</span></span><br><span class="line">    <span class="keyword">const</span> nameArr = [<span class="string">&#x27;变胖&#x27;</span>, <span class="string">&#x27;丰乳肥臀&#x27;</span>, <span class="string">&#x27;增肌&#x27;</span>, <span class="string">&#x27;年龄&#x27;</span>, <span class="string">&#x27;变瘦&#x27;</span>];</span><br><span class="line">    <span class="comment">// GUI拖动条可视化改变变形目标权重系数</span></span><br><span class="line">    <span class="keyword">const</span> <span class="attr">obj</span>: <span class="title class_">Record</span>&lt;string, number&gt; = &#123;&#125;; <span class="comment">// 显式定义 obj 的类型</span></span><br><span class="line">    <span class="keyword">const</span> folder = motor3d.<span class="property">gui</span>?.<span class="title function_">addFolder</span>(<span class="string">&#x27;控制&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; tArr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      obj[<span class="string">&#x27;t&#x27;</span> + i] = <span class="number">0</span>; <span class="comment">//obj批量定义一个属性表示变性目标的权重系数</span></span><br><span class="line">      <span class="comment">// 批量设置要改变的obj属性，对应name名字，和对应权重</span></span><br><span class="line">      folder!</span><br><span class="line">        .<span class="title function_">add</span>(obj, <span class="string">&#x27;t&#x27;</span> + i, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">        .<span class="title function_">name</span>(nameArr[i])</span><br><span class="line">        .<span class="title function_">onChange</span>(<span class="keyword">function</span> (<span class="params">v</span>) &#123;</span><br><span class="line">          mesh.<span class="property">morphTargetInfluences</span>![i] = v;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 2、利用变形数据 生成关键帧动画 */</span></span><br><span class="line">    mesh.<span class="property">name</span> = <span class="string">&#x27;per&#x27;</span>; <span class="comment">//关键帧动画控制的模型对象命名</span></span><br><span class="line">    <span class="comment">// 设置变形目标1对应权重随着时间的变化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">KF1</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;per.morphTargetInfluences[0]&#x27;</span>, [<span class="number">0</span>, <span class="number">5</span>], [<span class="number">0</span>, <span class="number">1</span>]);</span><br><span class="line">    <span class="comment">// 生成关键帧动画</span></span><br><span class="line">    <span class="keyword">const</span> clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&#x27;t&#x27;</span>, <span class="number">5</span>, [<span class="title class_">KF1</span>]);</span><br><span class="line">    <span class="comment">//包含关键帧动画的模型作为参数创建一个播放器</span></span><br><span class="line">    <span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    <span class="keyword">const</span> clipAction = mixer.<span class="title function_">clipAction</span>(clip);</span><br><span class="line">    clipAction.<span class="title function_">play</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> frameT = clock.<span class="title function_">getDelta</span>();</span><br><span class="line">      mixer.<span class="title function_">update</span>(frameT); <span class="comment">// 更新播放器相关的时间</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    motor3d.<span class="title function_">render</span>(loop);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  motor3d.<span class="title function_">addGroup</span>(group);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241112093653.png" alt="image.png"></p>
<h1 id="骨骼节点-Bone"><a href="#骨骼节点-Bone" class="headerlink" title="骨骼节点(Bone)"></a>骨骼节点(Bone)</h1><blockquote>
<p>骨骼是<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/objects/Skeleton" title="Skeleton">Skeleton</a>（骨架）的一部分。骨架是由<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/objects/SkinnedMesh" title="SkinnedMesh">SkinnedMesh</a>（蒙皮网格）依次来使用的。 骨骼几乎和空白<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/core/Object3D" title="Object3D">Object3D</a>相同。</p>
</blockquote>
<h2 id="1-原理"><a href="#1-原理" class="headerlink" title="1 原理"></a>1 原理</h2><p>骨骼关节<code>Bone</code>的父类是Object3D,自然会继承Object3D相关的属性或方法，比如位置属性<code>position</code>、旋转方法<code>rotateX()</code>、添加方法<code>add()</code>等等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span><br><span class="line">  motor3d.<span class="title function_">init</span>();</span><br><span class="line">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Bone1</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Bone</span>(); <span class="comment">//关节1，用来作为根关节</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Bone2</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Bone</span>(); <span class="comment">//关节2</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title class_">Bone3</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Bone</span>(); <span class="comment">//关节3</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置关节父子关系   多个骨头关节构成一个树结构</span></span><br><span class="line">  <span class="title class_">Bone1</span>.<span class="title function_">add</span>(<span class="title class_">Bone2</span>);</span><br><span class="line">  <span class="title class_">Bone2</span>.<span class="title function_">add</span>(<span class="title class_">Bone3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//平移Bone1，Bone2、Bone3跟着平移</span></span><br><span class="line">  <span class="title class_">Bone1</span>.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">50</span>, <span class="number">0</span>, <span class="number">50</span>);</span><br><span class="line">  <span class="title class_">Bone2</span>.<span class="property">position</span>.<span class="property">y</span> = <span class="number">60</span>; <span class="comment">//Bone2相对父对象Bone1位置</span></span><br><span class="line">  <span class="title class_">Bone3</span>.<span class="property">position</span>.<span class="property">y</span> = <span class="number">30</span>; <span class="comment">//Bone3相对父对象Bone2位置</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 骨骼关节旋转</span></span><br><span class="line">  <span class="title class_">Bone1</span>.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">6</span>);</span><br><span class="line">  <span class="title class_">Bone2</span>.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 把所有骨骼关节对象的父对象，也就是根节点骨骼Bone1，添加一个模型对象中作为子对象</span></span><br><span class="line">  group.<span class="title function_">add</span>(<span class="title class_">Bone1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// SkeletonHelper会可视化参数模型对象所包含的所有骨骼关节</span></span><br><span class="line">  <span class="keyword">const</span> skeletonHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkeletonHelper</span>(group);</span><br><span class="line">  group.<span class="title function_">add</span>(skeletonHelper);</span><br><span class="line"></span><br><span class="line">  motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(<span class="title class_">Bone1</span>.<span class="property">rotation</span>, <span class="string">&#x27;x&#x27;</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;关节1&#x27;</span>);</span><br><span class="line">  motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(<span class="title class_">Bone2</span>.<span class="property">rotation</span>, <span class="string">&#x27;x&#x27;</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;关节2&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  motor3d.<span class="property">scene</span>?.<span class="title function_">add</span>(group);</span><br><span class="line">  motor3d.<span class="title function_">render</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/1783420665-%E4%BD%9C%E8%80%85Mcc-2024-11-12-09-41-53.gif" alt="1783420665-作者Mcc-2024-11-12-09-41-53.gif|522"></p>
<h3 id="1-1-SkeletonHelper可视化骨骼关节"><a href="#1-1-SkeletonHelper可视化骨骼关节" class="headerlink" title="1.1 SkeletonHelper可视化骨骼关节"></a>1.1 <code>SkeletonHelper</code>可视化骨骼关节</h3><p>把所有骨骼关节对象的父对象，也就是根节点骨骼Bone1，添加一个模型对象中作为子对象，然后把模型对象作为<code>SkeletonHelper</code>的参数，就可以看到骨骼关节的可视化效果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 骨骼关节可以和普通网格模型一样作为其他模型子对象，添加到场景中</span></span><br><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line">group.<span class="title function_">add</span>(<span class="title class_">Bone1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// SkeletonHelper会可视化参数模型对象所包含的所有骨骼关节</span></span><br><span class="line"><span class="keyword">const</span> skeletonHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkeletonHelper</span>(group);</span><br><span class="line">group.<span class="title function_">add</span>(skeletonHelper);</span><br></pre></td></tr></table></figure>

<p>注意SkeletonHelper的可视化效果，SkeletonHelper几个线段并不表示Bone，每个Bone你可以理解为一个虚拟关节点，SkeletonHelper几个线段是每个虚拟Bone关节点连线。</p>
<h2 id="2-外部模型骨骼动画"><a href="#2-外部模型骨骼动画" class="headerlink" title="2 外部模型骨骼动画"></a>2 外部模型骨骼动画</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span><br><span class="line">  motor3d.<span class="title function_">init</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line">  <span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span><br><span class="line"></span><br><span class="line">  loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/骨骼动画.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;控制台查看gltf对象结构&#x27;</span>, gltf);</span><br><span class="line">    group.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据骨骼关节名字获取骨关节Bone</span></span><br><span class="line">    <span class="comment">// 在三维软件中，骨骼关节层层展开，可以看到下面三个骨骼关节</span></span><br><span class="line">    <span class="keyword">const</span> bone1 = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;Bone1&#x27;</span>); <span class="comment">//关节1</span></span><br><span class="line">    <span class="keyword">const</span> bone2 = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;Bone2&#x27;</span>); <span class="comment">//关节2</span></span><br><span class="line">    <span class="keyword">const</span> bone3 = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;Bone3&#x27;</span>); <span class="comment">//关节3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(bone1, bone2, bone3);</span><br><span class="line">    bone2!.<span class="property">rotation</span>.<span class="property">x</span> = <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">6</span>; <span class="comment">// 关节2旋转</span></span><br><span class="line">    bone3!.<span class="property">rotation</span>.<span class="property">x</span> = <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">6</span>; <span class="comment">// 关节3旋转</span></span><br><span class="line">    motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(bone1!.<span class="property">rotation</span>, <span class="string">&#x27;x&#x27;</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;关节1&#x27;</span>);</span><br><span class="line">    motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(bone2!.<span class="property">rotation</span>, <span class="string">&#x27;x&#x27;</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;关节2&#x27;</span>);</span><br><span class="line">    motor3d.<span class="property">gui</span>!.<span class="title function_">add</span>(bone3!.<span class="property">rotation</span>, <span class="string">&#x27;x&#x27;</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> / <span class="number">3</span>).<span class="title function_">name</span>(<span class="string">&#x27;关节3&#x27;</span>);</span><br><span class="line">    <span class="comment">// 骨骼辅助显示</span></span><br><span class="line">    <span class="keyword">const</span> skeletonHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SkeletonHelper</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    group.<span class="title function_">add</span>(skeletonHelper);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据节点名字获取某个骨骼网格模型</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">SkinnedMesh</span> = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;身体&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">SkinnedMesh</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;骨架&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;骨架所有关节&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>.<span class="property">bones</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;根关节&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">0</span>]);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  motor3d.<span class="title function_">addGroup</span>(group);</span><br><span class="line">  motor3d.<span class="title function_">render</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241112095039.png" alt="image.png"></p>
<h3 id="2-1-查看骨骼网格模型SkinnedMesh"><a href="#2-1-查看骨骼网格模型SkinnedMesh" class="headerlink" title="2.1 查看骨骼网格模型SkinnedMesh"></a>2.1 查看骨骼网格模型<code>SkinnedMesh</code></h3><blockquote>
<p>具有<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/objects/Skeleton" title="Skeleton">Skeleton</a>（骨架）和<a target="_blank" rel="noopener" href="https://threejs.org/docs/index.html#api/zh/objects/Bone" title="Bone">bones</a>（骨骼）的网格，可用于给几何体上的顶点添加动画</p>
</blockquote>
<p>在threejs中，骨骼动画模型的外表面是用骨骼网格模型<code>SkinnedMesh</code>表示，<code>SkinnedMesh</code>表示的父类就是网格模型<code>Mesh</code>,<code>SkinnedMesh</code>和网格模型<code>Mesh</code>一样都是网格模型，用来表达一个物体的外表面。</p>
<p>加载gltf模型，如果存在骨骼网格模型的话，可以通过加载返回gltf对象的场景属性<code>.scene</code>查看。浏览器控制层层展开gltf.scene，就可以找到<code>SkinnedMesh</code>的模型对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>(); </span><br><span class="line">loader.<span class="title function_">load</span>(<span class="string">&quot;../骨骼动画.glb&quot;</span>, <span class="keyword">function</span> (<span class="params">gltf</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;控制台查看gltf对象结构&#x27;</span>, gltf);</span><br><span class="line">    model.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    <span class="comment">// 根据节点名字获取某个骨骼网格模型</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">SkinnedMesh</span> = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;身体&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;骨骼网格模型&#x27;</span>, <span class="title class_">SkinnedMesh</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-骨骼网格模型的骨架SkinnedMesh-skeleton"><a href="#2-2-骨骼网格模型的骨架SkinnedMesh-skeleton" class="headerlink" title="2.2 骨骼网格模型的骨架SkinnedMesh.skeleton"></a>2.2 骨骼网格模型的骨架<code>SkinnedMesh.skeleton</code></h3><p><code>SkinnedMesh</code>相比较<code>Mesh</code>区别就是，可以跟着自己的骨架<code>.skeleton</code>变化，比如骨架里面的骨骼关节<code>Bone</code>旋转,会带动附近骨骼网格模型<code>SkinnedMesh</code>跟着旋转。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 根据节点名字获取某个骨骼网格模型</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">SkinnedMesh</span> = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(<span class="string">&#x27;身体&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">SkinnedMesh</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;骨架&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;骨架所有关节&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>.<span class="property">bones</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;根关节&#x27;</span>, <span class="title class_">SkinnedMesh</span>.<span class="property">skeleton</span>.<span class="property">bones</span>[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<h2 id="3-骨骼网格模型的关键帧动画"><a href="#3-骨骼网格模型的关键帧动画" class="headerlink" title="3 骨骼网格模型的关键帧动画"></a>3 骨骼网格模型的关键帧动画</h2><p>gltf模型<code>gltf.animations</code>包含四个关键帧动画对象<code>AnimationClip</code>，分别对应休息、跑步等动作。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包含关键帧动画的模型作为参数创建一个播放器</span></span><br><span class="line"><span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span><br><span class="line"><span class="comment">// gltf.animations[0] Idle  休息</span></span><br><span class="line"><span class="comment">// gltf.animations[1] Run   跑步</span></span><br><span class="line"><span class="comment">// gltf.animations[2] TPose T形静止展开</span></span><br><span class="line"><span class="comment">// gltf.animations[3] Walk  走路</span></span><br><span class="line"><span class="title class_">IdleAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">0</span>]);</span><br><span class="line"><span class="title class_">RunAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">1</span>]);</span><br><span class="line"><span class="title class_">TPoseAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">2</span>]);</span><br><span class="line"><span class="title class_">WalkAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">3</span>]);</span><br></pre></td></tr></table></figure>

<h3 id="3-1-案例"><a href="#3-1-案例" class="headerlink" title="3.1 案例"></a>3.1 案例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;scene&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;control-box&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;handleClick(item)&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;item in btnText&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;item&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">GLTFLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/loaders/GLTFLoader.js&#x27;</span>; <span class="comment">// 引入gltf模型加载库GLTFLoader.js</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; onBeforeUnmount, onMounted, ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Motor3</span>d <span class="keyword">from</span> <span class="string">&#x27;../../utils/motor3d&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">motor3d</span>: <span class="title class_">Motor3</span>d;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title class_">IdleAction</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title class_">RunAction</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title class_">TPoseAction</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title class_">WalkAction</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="title class_">ActionState</span>: <span class="variable constant_">THREE</span>.<span class="property">AnimationAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> btnText = ref&lt;string[]&gt;([<span class="string">&#x27;走路&#x27;</span>, <span class="string">&#x27;跑步&#x27;</span>, <span class="string">&#x27;休息&#x27;</span>, <span class="string">&#x27;T形静止展开&#x27;</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">handleClick</span> = (<span class="params">item: string</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title class_">ActionState</span>.<span class="title function_">stop</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">switch</span> (item) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">case</span> <span class="string">&#x27;休息&#x27;</span>:</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ActionState</span> = <span class="title class_">IdleAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">break</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">case</span> <span class="string">&#x27;跑步&#x27;</span>:</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ActionState</span> = <span class="title class_">RunAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">break</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">case</span> <span class="string">&#x27;T形静止展开&#x27;</span>:</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ActionState</span> = <span class="title class_">TPoseAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">break</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">case</span> <span class="string">&#x27;走路&#x27;</span>:</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title class_">ActionState</span> = <span class="title class_">WalkAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">break</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title class_">ActionState</span>.<span class="title function_">play</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">init</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="property">camera</span>?.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/士兵.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    group.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="title function_">addGroup</span>(group);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//包含关键帧动画的模型作为参数创建一个播放器</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// gltf.animations[0] Idle  休息</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// gltf.animations[1] Run   跑步</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// gltf.animations[2] TPose T形静止展开</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// gltf.animations[3] Walk  走路</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">IdleAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">0</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">RunAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">1</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">TPoseAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">2</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">WalkAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">3</span>]);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">ActionState</span> = <span class="title class_">TPoseAction</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="title class_">ActionState</span>.<span class="title function_">play</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// clock.getDelta()方法获得loop()两次执行时间间隔</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> frameT = clock.<span class="title function_">getDelta</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 更新播放器相关的时间</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      mixer.<span class="title function_">update</span>(frameT);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="title function_">render</span>(loop);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (motor3d) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="title function_">destroy</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-id">#scene</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">overflow</span>: hidden; <span class="comment">/* 去除滚动条 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin</span>: <span class="number">0px</span>; <span class="comment">/* 去除外边距 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-class">.control-box</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: absolute;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">top</span>: <span class="number">70px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">left</span>: <span class="number">10px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-11-12-09-53-00.gif" alt="2024-11-12-09-53-00.gif|518"></p>
<h3 id="3-2-AnimationAction的权重属性-weight"><a href="#3-2-AnimationAction的权重属性-weight" class="headerlink" title="3.2 AnimationAction的权重属性.weight"></a>3.2 AnimationAction的权重属性.weight</h3><p>动画动作对象<code>AnimationAction</code>的权重属性<code>.weight</code>可以控制动画的执行，权重为0，对应动画不影响人的动作，权重为1影响程度最大。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span><br><span class="line">  motor3d.<span class="title function_">init</span>();</span><br><span class="line">  motor3d.<span class="property">camera</span>?.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span><br><span class="line">  <span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span><br><span class="line"></span><br><span class="line">  loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/士兵.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span><br><span class="line">    group.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    motor3d.<span class="title function_">addGroup</span>(group);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//包含关键帧动画的模型作为参数创建一个播放器</span></span><br><span class="line">    <span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(gltf.<span class="property">scene</span>);</span><br><span class="line">    <span class="comment">// gltf.animations[0] Idle  休息</span></span><br><span class="line">    <span class="comment">// gltf.animations[1] Run   跑步</span></span><br><span class="line">    <span class="comment">// gltf.animations[2] TPose T形静止展开</span></span><br><span class="line">    <span class="comment">// gltf.animations[3] Walk  走路</span></span><br><span class="line">    <span class="title class_">IdleAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">0</span>]);</span><br><span class="line">    <span class="title class_">RunAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">1</span>]);</span><br><span class="line">    <span class="title class_">TPoseAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">2</span>]);</span><br><span class="line">    <span class="title class_">WalkAction</span> = mixer.<span class="title function_">clipAction</span>(gltf.<span class="property">animations</span>[<span class="number">3</span>]);</span><br><span class="line">    <span class="title class_">IdleAction</span>.<span class="title function_">play</span>();</span><br><span class="line">    <span class="title class_">RunAction</span>.<span class="title function_">play</span>();</span><br><span class="line">    <span class="title class_">WalkAction</span>.<span class="title function_">play</span>();</span><br><span class="line">    <span class="comment">// 权重为0，对应动画不影响人的动作，权重为1影响程度最大。</span></span><br><span class="line">    <span class="title class_">IdleAction</span>.<span class="property">weight</span> = <span class="number">0.8</span>;</span><br><span class="line">    <span class="title class_">RunAction</span>.<span class="property">weight</span> = <span class="number">0.2</span>;</span><br><span class="line">    <span class="title class_">WalkAction</span>.<span class="property">weight</span> = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> clock = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="comment">// clock.getDelta()方法获得loop()两次执行时间间隔</span></span><br><span class="line">      <span class="keyword">const</span> frameT = clock.<span class="title function_">getDelta</span>();</span><br><span class="line">      <span class="comment">// 更新播放器相关的时间</span></span><br><span class="line">      mixer.<span class="title function_">update</span>(frameT);</span><br><span class="line">    &#125;</span><br><span class="line">    motor3d.<span class="title function_">render</span>(loop);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-11-12-09-54-33.gif" alt="2024-11-12-09-54-33.gif|440"></p>
<h1 id="动画库tweenJs"><a href="#动画库tweenJs" class="headerlink" title="动画库tweenJs"></a>动画库tweenJs</h1><h2 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="1 基本语法"></a>1 基本语法</h2><h3 id="1-1-tweenjs改变threejs模型对象位置"><a href="#1-1-tweenjs改变threejs模型对象位置" class="headerlink" title="1.1 tweenjs改变threejs模型对象位置"></a>1.1 tweenjs改变threejs模型对象位置</h3><p>three.js模型的位置<code>mesh.position</code>属性是一个具有<code>.x</code>、<code>.y</code>、<code>.z</code>属性的对象，可以直接使用tweenjs直接改变。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一段mesh平移的动画</span></span><br><span class="line"><span class="keyword">const</span> tween = <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(mesh.<span class="property">position</span>);</span><br><span class="line"><span class="comment">//经过2000毫秒，pos对象的x和y属性分别从零变化为100、50</span></span><br><span class="line">tween.<span class="title function_">to</span>(&#123;<span class="attr">x</span>: <span class="number">100</span>,<span class="attr">y</span>: <span class="number">50</span>&#125;, <span class="number">2000</span>);</span><br><span class="line"><span class="comment">//tween动画开始执行</span></span><br><span class="line">tween.<span class="title function_">start</span>(); </span><br></pre></td></tr></table></figure>

<p>支持链式调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(mesh.<span class="property">scale</span>)</span><br><span class="line">    .<span class="title function_">to</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">x</span>: <span class="number">2</span>, <span class="comment">// x 方向放大2倍</span></span><br><span class="line">        <span class="attr">y</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">z</span>: <span class="number">1</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="number">2000</span>,</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<p>最后不要忘记在渲染循环中更新<code>TWEEN.update();</code>即可。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 渲染循环</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">render</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable constant_">TWEEN</span>.<span class="title function_">update</span>();</span><br><span class="line">    renderer.<span class="title function_">render</span>(scene, camera);</span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">render</span>();</span><br></pre></td></tr></table></figure>

<h3 id="1-2-Tweenjs回调函数"><a href="#1-2-Tweenjs回调函数" class="headerlink" title="1.2 Tweenjs回调函数"></a>1.2 Tweenjs回调函数</h3><p>twwenjs库提供了<code>onStart</code>、<code>onUpdate</code>、<code>onComplete</code>等用于控制动画执行的回调函数。</p>
<ul>
<li><code>onStart</code>：动画开始执行触发</li>
<li><code>onUpdate</code>：动画执行过程中，一直被调用执行</li>
<li><code>onComplete</code>：动画正常执行完触发</li>
</ul>
<h4 id="1-2-1-相机圆周运动-，且保持相机镜头对准坐标原点"><a href="#1-2-1-相机圆周运动-，且保持相机镜头对准坐标原点" class="headerlink" title="1.2.1 相机圆周运动 ，且保持相机镜头对准坐标原点"></a>1.2.1 相机圆周运动 ，且保持相机镜头对准坐标原点</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> R = <span class="number">100</span>; <span class="comment">// 相机圆周运动的半径</span></span><br><span class="line">  <span class="comment">// tweenjs改变参数对象的过程中，.onUpdate方法会被重复调用执行</span></span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123; <span class="attr">angle</span>: <span class="number">0</span> &#125;)</span><br><span class="line">    .<span class="title function_">to</span>(&#123; <span class="attr">angle</span>: <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span> &#125;, <span class="number">16000</span>)</span><br><span class="line">    .<span class="title function_">onUpdate</span>(<span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span><br><span class="line">      motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">x</span> = R * <span class="title class_">Math</span>.<span class="title function_">cos</span>(obj.<span class="property">angle</span>);</span><br><span class="line">      motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">z</span> = R * <span class="title class_">Math</span>.<span class="title function_">sin</span>(obj.<span class="property">angle</span>);</span><br><span class="line">      motor3d.<span class="property">camera</span>!.<span class="title function_">lookAt</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>); <span class="comment">// 始终盯着中心点</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">start</span>();</span><br><span class="line">  <span class="comment">// 实时更新动画</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable constant_">TWEEN</span>.<span class="title function_">update</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  motor3d.<span class="title function_">render</span>(loop);</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-模型、标签淡入"><a href="#1-2-2-模型、标签淡入" class="headerlink" title="1.2.2 模型、标签淡入"></a>1.2.2 模型、标签淡入</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型淡入</span></span><br><span class="line">material.<span class="property">transparent</span> = <span class="literal">true</span>;<span class="comment">//开启透明计算</span></span><br><span class="line">material.<span class="property">opacity</span> = <span class="number">0.0</span>;<span class="comment">//完全透明</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// new TWEEN.Tween(material)</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;<span class="attr">opacity</span>:material.<span class="property">opacity</span>&#125;)</span><br><span class="line">.<span class="title function_">to</span>(&#123;<span class="attr">opacity</span>:<span class="number">1.0</span>&#125;, <span class="number">3000</span>)</span><br><span class="line">.<span class="title function_">onUpdate</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    material.<span class="property">opacity</span> = obj.<span class="property">opacity</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onComplete</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//动画结束：关闭允许透明，恢复到模型原来状态</span></span><br><span class="line">    material.<span class="property">transparent</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<p>如果是标签，则</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 标签淡出</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;<span class="attr">opacity</span>:<span class="number">0</span>&#125;)</span><br><span class="line">.<span class="title function_">to</span>(&#123;<span class="attr">opacity</span>:<span class="number">1.0</span>&#125;, <span class="number">1000</span>)</span><br><span class="line">.<span class="title function_">onUpdate</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    <span class="comment">// 动态更新div元素透明度</span></span><br><span class="line">    divTag.<span class="property">style</span>.<span class="property">opacity</span> = obj.<span class="property">opacity</span>;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-模型淡出"><a href="#1-2-3-模型淡出" class="headerlink" title="1.2.3 模型淡出"></a>1.2.3 模型淡出</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型淡出</span></span><br><span class="line"><span class="comment">// new TWEEN.Tween(material)</span></span><br><span class="line"><span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;<span class="attr">opacity</span>:material.<span class="property">opacity</span>&#125;)</span><br><span class="line">.<span class="title function_">to</span>(&#123;<span class="attr">opacity</span>:<span class="number">0.0</span>&#125;, <span class="number">3000</span>)</span><br><span class="line">.<span class="title function_">onStart</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//动画开始：允许透明opacity属性才能生效</span></span><br><span class="line">    material.<span class="property">transparent</span> = <span class="literal">true</span>;</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">onUpdate</span>(<span class="keyword">function</span>(<span class="params">obj</span>)&#123;</span><br><span class="line">    material.<span class="property">opacity</span> = obj.<span class="property">opacity</span></span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">start</span>();</span><br></pre></td></tr></table></figure>

<h3 id="1-3-缓动算法-easing"><a href="#1-3-缓动算法-easing" class="headerlink" title="1.3 缓动算法.easing"></a>1.3 缓动算法.easing</h3><p>语法格式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// easing函数：缓动算法(运动效果)</span></span><br><span class="line"><span class="comment">// easing类型：定义缓动算法起作用地方</span></span><br><span class="line">tween.<span class="title function_">easing</span>(<span class="variable constant_">TWEEN</span>.<span class="property">Easing</span>.<span class="property">easing</span>函数.<span class="property">easing</span>类型);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 动画开始缓动方式(类比加速启动)</span></span><br><span class="line">tween.<span class="title function_">easing</span>(<span class="variable constant_">TWEEN</span>.<span class="property">Easing</span>.<span class="property">Sinusoidal</span>.<span class="property">In</span>);</span><br><span class="line"><span class="comment">// 动画结束缓动方式(类比减速刹车)</span></span><br><span class="line">tween.<span class="title function_">easing</span>(<span class="variable constant_">TWEEN</span>.<span class="property">Easing</span>.<span class="property">Sinusoidal</span>.<span class="property">Out</span>);</span><br><span class="line"><span class="comment">// 同时设置In和Out</span></span><br><span class="line">tween.<span class="title function_">easing</span>(<span class="variable constant_">TWEEN</span>.<span class="property">Easing</span>.<span class="property">Sinusoidal</span>.<span class="property">InOut</span>); <span class="comment">// 进入和结束都设置缓动</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241112100348.png" alt="image.png"></p>
<h2 id="2-综合案例"><a href="#2-综合案例" class="headerlink" title="2 综合案例"></a>2 综合案例</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;scene&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;tag&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span>设备A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&lt;/template&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="variable constant_">TWEEN</span> <span class="keyword">from</span> <span class="string">&#x27;@tweenjs/tween.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">GLTFLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/loaders/GLTFLoader.js&#x27;</span>; <span class="comment">// 引入gltf模型加载库GLTFLoader.js</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; onBeforeUnmount, onMounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 后处理扩展库EffectComposer.js</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">EffectComposer</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/postprocessing/EffectComposer.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 引入渲染器通道RenderPass</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">RenderPass</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/postprocessing/RenderPass.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 引入OutlinePass通道</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">OutlinePass</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/postprocessing/OutlinePass.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> &#123; <span class="title class_">CSS3DObject</span>, <span class="title class_">CSS3DRenderer</span>, <span class="title class_">CSS3DSprite</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/addons/renderers/CSS3DRenderer.js&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">import</span> <span class="title class_">Motor3</span>d <span class="keyword">from</span> <span class="string">&#x27;../../utils/motor3d&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">motor3d</span>: <span class="title class_">Motor3</span>d;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">endTarget</span>: <span class="variable constant_">THREE</span>.<span class="property">Vector3</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">endPos</span>: <span class="variable constant_">THREE</span>.<span class="property">Vector3</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> startPos = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> startTarget = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">let</span> <span class="attr">divTag</span>: <span class="title class_">HTMLElement</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="comment">// 创建动画</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">createCameraTween</span> = (<span class="params">endPos: THREE.Vector3, endTarget: THREE.Vector3</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  startPos = motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="title function_">clone</span>(); <span class="comment">// 这里记得克隆，不然就引用的地址</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  startTarget = motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="title function_">clone</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 不管相机此刻处于什么状态，直接读取当前的位置和目标观察点</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">x</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">x</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">y</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">y</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">z</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">z</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">tx</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">x</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">ty</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">y</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="attr">tz</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">z</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    .<span class="title function_">to</span>(</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 动画结束相机位置坐标</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">x</span>: endPos.<span class="property">x</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">y</span>: endPos.<span class="property">y</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">z</span>: endPos.<span class="property">z</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// 动画结束相机指向的目标观察点</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">tx</span>: endTarget.<span class="property">x</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">ty</span>: endTarget.<span class="property">y</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="attr">tz</span>: endTarget.<span class="property">z</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="number">1000</span>,</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    )</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    .<span class="title function_">onUpdate</span>(<span class="function">(<span class="params">obj: any</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 动态改变相机位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="title function_">set</span>(obj.<span class="property">x</span>, obj.<span class="property">y</span>, obj.<span class="property">z</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 动态计算相机视线</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// camera.lookAt(obj.tx, obj.ty, obj.tz);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="title function_">set</span>(obj.<span class="property">tx</span>, obj.<span class="property">ty</span>, obj.<span class="property">tz</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      motor3d.<span class="property">controls</span>!.<span class="title function_">update</span>(); <span class="comment">// 内部会执行.lookAt()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    .<span class="title function_">start</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">createOutlinePass</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// OutlinePass第一个参数v2的尺寸和canvas画布保持一致</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> v2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(motor3d.<span class="property">width</span>, motor3d.<span class="property">height</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> outlinePass = <span class="keyword">new</span> <span class="title class_">OutlinePass</span>(v2, motor3d.<span class="property">scene</span>!, motor3d.<span class="property">camera</span>!);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 相关属性设置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  outlinePass.<span class="property">visibleEdgeColor</span>.<span class="title function_">set</span>(<span class="number">0x00ffff</span>); <span class="comment">// 模型描边颜色，默认白色</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  outlinePass.<span class="property">edgeThickness</span> = <span class="number">4</span>; <span class="comment">// 高亮发光描边厚度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  outlinePass.<span class="property">edgeStrength</span> = <span class="number">6</span>; <span class="comment">// 高亮描边发光强度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  outlinePass.<span class="property">pulsePeriod</span> = <span class="number">2</span>; <span class="comment">// 模型闪烁频率控制，默认0不闪烁//模型闪烁频率控制，默认0不闪烁</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> outlinePass;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="keyword">const</span> <span class="title function_">createHtml</span> = (<span class="params">name: string</span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> html = <span class="string">`&lt;div id=&quot;tag&quot; &quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">        &lt;!-- position:relative;约束子元素绝对定位参照点 --&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">        &lt;div style=&quot;position:relative;width:400px;height:322px;color: #fff;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;!-- 图片绝对定位100%填充父元素，作为标签的背景 --&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;img src=&quot;/threeJs/img/信息背景.png&quot; alt=&quot;&quot; style=&quot;width: 100%; position: absolute; left: 0px; top: 0px&quot; /&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml"></span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;!-- 名称、存储量、设备状态、等信息叠加到背景图上即可 --&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;div style=&quot;position:absolute;left:48px;top:36px;font-size:16px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;div style=&quot;font-size:20px;font-weight: 400;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                    &lt;span&gt;<span class="subst">$&#123;name&#125;</span>&lt;/span&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;div style=&quot;margin-top: 30px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                    &lt;span style=&quot;font-weight: 400;margin-left: 80px;font-size: 40px;color: #00ffff;&quot;&gt;276559 L&lt;/span&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;div style=&quot;margin-top: 20px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                    &lt;span style=&quot;color: #ccc;font-weight: 300;&quot;&gt;管理&lt;/span&gt;&lt;span</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                        style=&quot;font-weight: 400;margin-left: 30px;&quot;&gt;郭老师&lt;/span&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;div style=&quot;margin-top: 10px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                    &lt;span style=&quot;color: #ccc;font-weight: 300;&quot;&gt;工号&lt;/span&gt;&lt;span</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                        style=&quot;font-weight: 400;margin-left: 30px;&quot;&gt;webgl3d.cn&lt;/span&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;div style=&quot;position:absolute;left:285px;top:35px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;span style=&quot;color: #ffff00;&quot;&gt;异常&lt;/span&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;div style=&quot;position:absolute;left:350px;top:20px;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">                &lt;img class=&quot;close&quot; src=&quot;/threeJs/img/关闭.png&quot; width=&quot;32&quot; style=&quot;pointer-events: auto;cursor: pointer;&quot;&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">            &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">        &lt;/div&gt;</span></span></span></span><br><span class="line"><span class="string"><span class="language-javascript"><span class="language-xml">    &lt;/div&gt;`</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">return</span> html;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d = <span class="keyword">new</span> <span class="title class_">Motor3</span>d(<span class="string">&#x27;#scene&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">init</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">render</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 后处理通道</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> composer = <span class="keyword">new</span> <span class="title class_">EffectComposer</span>(motor3d.<span class="property">renderer</span>!); <span class="comment">// 创建后处理对象EffectComposer，WebGL渲染器作为参数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> renderPass = <span class="keyword">new</span> <span class="title class_">RenderPass</span>(motor3d.<span class="property">scene</span>!, motor3d.<span class="property">camera</span>!); <span class="comment">// 创建一个渲染器通道，场景和相机作为参数</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  composer.<span class="title function_">addPass</span>(renderPass); <span class="comment">// 设置renderPass通道</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> outlinePass = <span class="title function_">createOutlinePass</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 创建组</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> model = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> choseGroup = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 添加到场景</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">addGroup</span>(choseGroup);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="title function_">addGroup</span>(model);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 创建GLTF加载器对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  loader.<span class="title function_">load</span>(<span class="string">&#x27;/threeJs/3dModules/工厂.glb&#x27;</span>, <span class="function">(<span class="params">gltf</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">//需要批量标注的标签数据arr</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> arr = [<span class="string">&#x27;设备A&#x27;</span>, <span class="string">&#x27;设备B&#x27;</span>, <span class="string">&#x27;停车场&#x27;</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; arr.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 注意是多个标签，需要克隆复制一份</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> div = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;tag&#x27;</span>)!.<span class="title function_">cloneNode</span>() <span class="keyword">as</span> <span class="title class_">HTMLElement</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      div.<span class="property">style</span>.<span class="property">color</span> = <span class="string">&#x27;rgb(255, 255, 255)&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      div.<span class="property">innerHTML</span> = arr[i]; <span class="comment">//标签数据填写</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// HTML元素转化为threejs的CSS3对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// const tag = new CSS3DObject(div);</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> tag = <span class="keyword">new</span> <span class="title class_">CSS3DSprite</span>(div);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      div.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span>; <span class="comment">//避免标签遮挡canvas鼠标事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// obj是建模软件中创建的一个空对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> obj = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(arr[i] + <span class="string">&#x27;标注&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// tag会标注在空对象obj对应的位置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      obj?.<span class="title function_">add</span>(tag);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      tag.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">1</span>); <span class="comment">//适当缩放模型标签</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      tag.<span class="property">position</span>.<span class="property">y</span> = (<span class="number">40</span> / <span class="number">2</span>) * <span class="number">0.1</span>; <span class="comment">//标签底部箭头和空对象标注点重合：偏移高度像素值一半*缩放比例</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> arr2 = [<span class="string">&#x27;设备A&#x27;</span>, <span class="string">&#x27;设备B&#x27;</span>];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    arr2.<span class="title function_">forEach</span>(<span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> obj = gltf.<span class="property">scene</span>.<span class="title function_">getObjectByName</span>(name);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; obj!.<span class="property">children</span>.<span class="property">length</span>; i++) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">const</span> group = obj!.<span class="property">children</span>[i];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">//递归遍历chooseObj，并给chooseObj的所有子孙后代设置一个ancestors属性指向自己</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        group.<span class="title function_">traverse</span>(<span class="keyword">function</span> (<span class="params">inner_obj</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">if</span> (inner_obj <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 添加其父级对象, 使得整体发光</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            (inner_obj <span class="keyword">as</span> any).<span class="property">ancestors</span> = obj;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    model.<span class="title function_">add</span>(gltf.<span class="property">scene</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 监听鼠标点击事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="property">container</span>!.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">event: Event</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> raycaster = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> mouseEvent = event <span class="keyword">as</span> <span class="title class_">MouseEvent</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> px = mouseEvent.<span class="property">offsetX</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> py = mouseEvent.<span class="property">offsetY</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> x = (px / motor3d.<span class="property">width</span>) * <span class="number">2</span> - <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> y = -(py / motor3d.<span class="property">height</span>) * <span class="number">2</span> + <span class="number">1</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 更新射线 在点击位置创建一条射线，用来选中拾取模型对象</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    raycaster.<span class="title function_">setFromCamera</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(x, y), motor3d.<span class="property">camera</span>!);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 射线交叉计算拾取模型</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> intersects = raycaster.<span class="title function_">intersectObjects</span>(motor3d.<span class="property">scene</span>!.<span class="property">children</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (intersects.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      intersects.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> ((item.<span class="property">object</span> <span class="keyword">as</span> any).<span class="property">ancestors</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 先清除之前的</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          choseGroup.<span class="title function_">clear</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          divTag = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          divTag.<span class="property">innerHTML</span> = <span class="title function_">createHtml</span>((item.<span class="property">object</span> <span class="keyword">as</span> any).<span class="property">ancestors</span>.<span class="property">name</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 标签淡出</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          divTag.<span class="property">style</span>.<span class="property">opacity</span> = <span class="string">&#x27;0&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123; <span class="attr">opacity</span>: <span class="number">0</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            .<span class="title function_">to</span>(&#123; <span class="attr">opacity</span>: <span class="number">1.0</span> &#125;, <span class="number">1000</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            .<span class="title function_">onUpdate</span>(<span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              <span class="comment">//动态更新div元素透明度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              divTag.<span class="property">style</span>.<span class="property">opacity</span> = <span class="title class_">String</span>(obj.<span class="property">opacity</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            .<span class="title function_">start</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 添加靠近动画放大预览</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          endTarget = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          (item.<span class="property">object</span> <span class="keyword">as</span> any).<span class="property">ancestors</span>!.<span class="title function_">getWorldPosition</span>(endTarget); <span class="comment">// 获取三维场景中某个对象世界坐标</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 相机飞行到的位置和观察目标拉开一定的距离</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          endPos = endTarget.<span class="title function_">clone</span>().<span class="title function_">addScalar</span>(<span class="number">50</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">createCameraTween</span>(endPos, endTarget);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// 添加关闭按钮事件</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          divTag.<span class="title function_">getElementsByClassName</span>(<span class="string">&#x27;close&#x27;</span>)[<span class="number">0</span>].<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">createCameraTween</span>(startPos, startTarget);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            outlinePass.<span class="property">selectedObjects</span> = []; <span class="comment">//无发光描边</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="comment">// 标签弹出</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123; <span class="attr">opacity</span>: <span class="number">1</span> &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              .<span class="title function_">to</span>(&#123; <span class="attr">opacity</span>: <span class="number">0</span> &#125;, <span class="number">400</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              .<span class="title function_">onUpdate</span>(<span class="keyword">function</span> (<span class="params">obj</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                <span class="comment">//动态更新div元素透明度</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                divTag.<span class="property">style</span>.<span class="property">opacity</span> = <span class="title class_">String</span>(obj.<span class="property">opacity</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              .<span class="title function_">onComplete</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">                choseGroup.<span class="title function_">clear</span>(); <span class="comment">//从场景移除</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              &#125;)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">              .<span class="title function_">start</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">const</span> tag = <span class="keyword">new</span> <span class="title class_">CSS3DObject</span>(divTag);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// new CSS3DObject(div); 之后设置style.pointerEvents</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          divTag.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">const</span> ancestors = (item.<span class="property">object</span> <span class="keyword">as</span> any).<span class="property">ancestors</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="keyword">const</span> worldPosition = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          ancestors.<span class="title function_">getWorldPosition</span>(worldPosition);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          tag.<span class="property">position</span>.<span class="title function_">copy</span>(worldPosition);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          tag.<span class="property">position</span>.<span class="property">y</span> += <span class="number">15</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">//适当缩放模型标签</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          tag.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">0.1</span>, <span class="number">0.1</span>, <span class="number">1</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          choseGroup.<span class="title function_">add</span>(tag);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          outlinePass.<span class="property">selectedObjects</span> = [ancestors];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 创建一个CSS3渲染器CSS2DRenderer</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> css3Renderer = <span class="keyword">new</span> <span class="title class_">CSS3DRenderer</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  motor3d.<span class="property">container</span>!.<span class="title function_">appendChild</span>(css3Renderer.<span class="property">domElement</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  css3Renderer.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&#x27;absolute&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  css3Renderer.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&#x27;0px&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  css3Renderer.<span class="property">domElement</span>.<span class="property">style</span>.<span class="property">pointerEvents</span> = <span class="string">&#x27;none&#x27;</span>; <span class="comment">// 解决HTML元素标签对threejs canvas画布鼠标事件的遮挡</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  composer.<span class="title function_">addPass</span>(outlinePass);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 循环渲染</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">const</span> <span class="title function_">render</span> = (<span class="params"></span>) =&gt; &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (motor3d.<span class="property">isRendering</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      css3Renderer.<span class="title function_">setSize</span>(motor3d.<span class="property">width</span>, motor3d.<span class="property">height</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      css3Renderer.<span class="title function_">render</span>(motor3d.<span class="property">scene</span>!, motor3d.<span class="property">camera</span>!);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      composer.<span class="title function_">render</span>(); <span class="comment">// 内部会调用webgl渲染器执行.render()</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable constant_">TWEEN</span>.<span class="title function_">update</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">requestAnimationFrame</span>(render);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="title function_">render</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="comment">// 重置渲染器输出画布canvas尺寸</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="variable language_">window</span>.<span class="property">onresize</span> = <span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="property">width</span> = <span class="title class_">Number</span>(motor3d.<span class="property">container</span>?.<span class="property">clientWidth</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="property">height</span> = <span class="title class_">Number</span>(motor3d.<span class="property">container</span>?.<span class="property">clientHeight</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="property">renderer</span>?.<span class="title function_">setSize</span>(motor3d.<span class="property">width</span>, motor3d.<span class="property">height</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    css3Renderer.<span class="title function_">setSize</span>(motor3d.<span class="property">width</span>, motor3d.<span class="property">height</span>); <span class="comment">// HTML标签css3Renderer.domElement尺寸重新设置</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> k = motor3d.<span class="property">width</span> / motor3d.<span class="property">height</span>; <span class="comment">//canvas画布宽高比</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="comment">// 透视相机的情况下</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">if</span> (motor3d.<span class="property">camera</span> <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      motor3d.<span class="property">camera</span>!.<span class="property">aspect</span> = k; <span class="comment">// 全屏情况下：设置观察范围长宽比aspect为窗口宽高比</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="property">camera</span>!.<span class="title function_">updateProjectionMatrix</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"><span class="title function_">onBeforeUnmount</span>(<span class="function">() =&gt;</span> &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  <span class="keyword">if</span> (motor3d) &#123;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    motor3d.<span class="title function_">destroy</span>();</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">  &#125;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">&#125;);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-id">#scene</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">position</span>: relative;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">overflow</span>: hidden; <span class="comment">/* 去除滚动条 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">margin</span>: <span class="number">0px</span>; <span class="comment">/* 去除外边距 */</span></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"><span class="selector-id">#tag</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">width</span>: <span class="number">70px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">height</span>: <span class="number">40px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">line-height</span>: <span class="number">32px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">text-align</span>: center;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">color</span>: <span class="number">#fff</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">/threeJs/img/标签箭头背景.png</span>);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-repeat</span>: no-repeat;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">&#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-11-12-10-09-07.gif" alt="2024-11-12-10-09-07.gif|676"></p>
<p><strong>注意：</strong></p>
<p>相机位置相对目标观察点，适当偏移，希望观察的范围大，就距离远一点，希望观察的设备显示效果大，就距离设备近一点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 相机飞行到的位置和观察目标拉开一定的距离</span></span><br><span class="line">endPos = endTarget.<span class="title function_">clone</span>().<span class="title function_">addScalar</span>(<span class="number">50</span>); <span class="comment">// 向量的x、y、z坐标分别在pos基础上增加30</span></span><br></pre></td></tr></table></figure>

<p>相机的位置逐渐改变，相机的观察目标也逐渐改变。<br>尤其是<code>controls</code>记得 <code>update</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建动画</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createCameraTween</span> = (<span class="params">endPos: THREE.Vector3, endTarget: THREE.Vector3</span>) =&gt; &#123;</span><br><span class="line">  startPos = motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="title function_">clone</span>(); <span class="comment">// 这里记得克隆，不然就引用的地址</span></span><br><span class="line">  startTarget = motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="title function_">clone</span>();</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">TWEEN</span>.<span class="title class_">Tween</span>(&#123;</span><br><span class="line">    <span class="comment">// 不管相机此刻处于什么状态，直接读取当前的位置和目标观察点</span></span><br><span class="line">    <span class="attr">x</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">x</span>,</span><br><span class="line">    <span class="attr">y</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">y</span>,</span><br><span class="line">    <span class="attr">z</span>: motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="property">z</span>,</span><br><span class="line">    <span class="attr">tx</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">x</span>,  </span><br><span class="line">    <span class="attr">ty</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">y</span>,</span><br><span class="line">    <span class="attr">tz</span>: motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="property">z</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">    .<span class="title function_">to</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 动画结束相机位置坐标</span></span><br><span class="line">        <span class="attr">x</span>: endPos.<span class="property">x</span>,</span><br><span class="line">        <span class="attr">y</span>: endPos.<span class="property">y</span>,</span><br><span class="line">        <span class="attr">z</span>: endPos.<span class="property">z</span>,</span><br><span class="line">        <span class="comment">// 动画结束相机指向的目标观察点</span></span><br><span class="line">        <span class="attr">tx</span>: endTarget.<span class="property">x</span>,</span><br><span class="line">        <span class="attr">ty</span>: endTarget.<span class="property">y</span>,</span><br><span class="line">        <span class="attr">tz</span>: endTarget.<span class="property">z</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="number">1000</span>,</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">onUpdate</span>(<span class="function">(<span class="params">obj: any</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 动态改变相机位置</span></span><br><span class="line">      motor3d.<span class="property">camera</span>!.<span class="property">position</span>.<span class="title function_">set</span>(obj.<span class="property">x</span>, obj.<span class="property">y</span>, obj.<span class="property">z</span>);</span><br><span class="line">      <span class="comment">// 动态计算相机视线</span></span><br><span class="line">      <span class="comment">// camera.lookAt(obj.tx, obj.ty, obj.tz);</span></span><br><span class="line">      motor3d.<span class="property">controls</span>!.<span class="property">target</span>.<span class="title function_">set</span>(obj.<span class="property">tx</span>, obj.<span class="property">ty</span>, obj.<span class="property">tz</span>);</span><br><span class="line">      motor3d.<span class="property">controls</span>!.<span class="title function_">update</span>(); <span class="comment">// 内部会执行.lookAt()</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">start</span>();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://VernalScenery.github.io">Scenery</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://vernalscenery.github.io/2024/11/09/ThreeJS/15_ThreeJS_%E5%8A%A8%E7%94%BB/">https://vernalscenery.github.io/2024/11/09/ThreeJS/15_ThreeJS_%E5%8A%A8%E7%94%BB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://VernalScenery.github.io" target="_blank">春和景明的记事本</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ThreeJS/">ThreeJS</a></div><div class="post_share"><div class="social-share" data-image="/./img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/11/13/ThreeJS/16_ThreeJS_%E6%95%B0%E5%AD%A6_%E5%90%91%E9%87%8F/" title="16_ThreeJS_数学_向量"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">16_ThreeJS_数学_向量</div></div></a></div><div class="next-post pull-right"><a href="/2024/11/09/ThreeJS/14_ThreeJS_%E5%9C%BA%E6%99%AF%E6%A0%87%E6%B3%A8%E6%A0%87%E7%AD%BE%E4%BF%A1%E6%81%AF/" title="14_ThreeJS_场景标注标签信息"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">14_ThreeJS_场景标注标签信息</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/09/12/ThreeJS/02_ThreeJS_%E5%90%84%E7%A7%8D%E6%A8%A1%E5%9E%8B/" title="02_ThreeJS_各种模型"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-12</div><div class="title">02_ThreeJS_各种模型</div></div></a></div><div><a href="/2024/09/12/ThreeJS/01_ThreeJS_%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8/" title="01_ThreeJS_快速入门"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-12</div><div class="title">01_ThreeJS_快速入门</div></div></a></div><div><a href="/2024/09/11/ThreeJS/03_ThreeJS_%E5%87%A0%E4%BD%95%E4%BD%93Geometries/" title="03_ThreeJS_几何体"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-11</div><div class="title">03_ThreeJS_几何体</div></div></a></div><div><a href="/2024/09/12/ThreeJS/04_ThreeJS_%E6%9D%90%E8%B4%A8(Material)/" title="04_ThreeJS_材质(Material)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-12</div><div class="title">04_ThreeJS_材质(Material)</div></div></a></div><div><a href="/2024/09/12/ThreeJS/05_ThreeJS_%E8%B4%B4%E5%9B%BE(Texture)/" title="ThreeJS_纹理贴图(Texture)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-12</div><div class="title">ThreeJS_纹理贴图(Texture)</div></div></a></div><div><a href="/2024/09/12/ThreeJS/09_ThreeJS_%E6%9B%B2%E7%BA%BF(Curve)%E5%92%8C%E5%BD%A2%E7%8A%B6(Shape)/" title="09_ThreeJS_曲线(Curve)和形状(Shape)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-12</div><div class="title">09_ThreeJS_曲线(Curve)和形状(Shape)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Scenery</div><div class="author-info__description">今天不想跑，所以才去跑</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">59</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">12</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/chjm0121" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1595718686@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-text">关键帧动画</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-text">1 整体流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-KeyframeTrack-%E5%85%B3%E9%94%AE%E5%B8%A7%E6%95%B0%E6%8D%AE"><span class="toc-text">2 KeyframeTrack 关键帧数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">2.1 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%B1%9E%E6%80%A7"><span class="toc-text">2.2 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%96%B9%E6%B3%95"><span class="toc-text">2.3 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-AnimationClip-%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB%E5%AF%B9%E8%B1%A1"><span class="toc-text">3 AnimationClip 关键帧动画对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">3.1 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%B1%9E%E6%80%A7"><span class="toc-text">3.2 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%96%B9%E6%B3%95"><span class="toc-text">3.3 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95"><span class="toc-text">3.4 静态方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-AnimationMixer-%E5%8A%A8%E7%94%BB%E6%B7%B7%E5%90%88%E5%99%A8"><span class="toc-text">4 AnimationMixer 动画混合器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">4.1 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E6%96%B9%E6%B3%95"><span class="toc-text">4.2 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-AnimationAction"><span class="toc-text">5 AnimationAction</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-text">5.1 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%B1%9E%E6%80%A7"><span class="toc-text">5.2 属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%96%B9%E6%B3%95"><span class="toc-text">5.3 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%A1%88%E4%BE%8B-%E5%8A%A8%E7%94%BB%E6%92%AD%E6%94%BE-%E6%9A%82%E5%81%9C%E3%80%81%E5%80%8D%E9%80%9F%E3%80%81%E5%BE%AA%E7%8E%AF"><span class="toc-text">5.4 案例_动画播放 (暂停、倍速、循环)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E8%A7%A3%E6%9E%90%E5%A4%96%E9%83%A8%E6%A8%A1%E5%9E%8B%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-text">6 解析外部模型关键帧动画</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB"><span class="toc-text">变形动画</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B-1"><span class="toc-text">1 整体流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-morphTargetInfluences%E6%9D%83%E9%87%8D%E7%B3%BB%E6%95%B0%E6%8E%A7%E5%88%B6%E5%8F%98%E5%BD%A2%E7%A8%8B%E5%BA%A6"><span class="toc-text">1.1 .morphTargetInfluences权重系数控制变形程度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E5%A4%9A%E4%B8%AA%E5%8F%98%E5%BD%A2%E7%9B%AE%E6%A0%87%E7%BB%BC%E5%90%88%E5%BD%B1%E5%93%8D%E6%A8%A1%E5%9E%8B%E5%BD%A2%E7%8A%B6"><span class="toc-text">1.1.1 多个变形目标综合影响模型形状</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%94%9F%E6%88%90%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB"><span class="toc-text">1.2 生成变形动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%A7%A3%E6%9E%90%E5%A4%96%E9%83%A8%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB%E6%A8%A1%E5%9E%8B"><span class="toc-text">2 解析外部变形动画模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A1%88%E4%BE%8B%E2%80%94%E2%80%94%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB-%E5%AE%9A%E5%88%B6%E4%BA%BA%E7%89%A9%E8%83%96%E7%98%A6"><span class="toc-text">2.1 案例——变形动画(定制人物胖瘦)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%AA%A8%E9%AA%BC%E8%8A%82%E7%82%B9-Bone"><span class="toc-text">骨骼节点(Bone)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86"><span class="toc-text">1 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-SkeletonHelper%E5%8F%AF%E8%A7%86%E5%8C%96%E9%AA%A8%E9%AA%BC%E5%85%B3%E8%8A%82"><span class="toc-text">1.1 SkeletonHelper可视化骨骼关节</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%A4%96%E9%83%A8%E6%A8%A1%E5%9E%8B%E9%AA%A8%E9%AA%BC%E5%8A%A8%E7%94%BB"><span class="toc-text">2 外部模型骨骼动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%9F%A5%E7%9C%8B%E9%AA%A8%E9%AA%BC%E7%BD%91%E6%A0%BC%E6%A8%A1%E5%9E%8BSkinnedMesh"><span class="toc-text">2.1 查看骨骼网格模型SkinnedMesh</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%AA%A8%E9%AA%BC%E7%BD%91%E6%A0%BC%E6%A8%A1%E5%9E%8B%E7%9A%84%E9%AA%A8%E6%9E%B6SkinnedMesh-skeleton"><span class="toc-text">2.2 骨骼网格模型的骨架SkinnedMesh.skeleton</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%AA%A8%E9%AA%BC%E7%BD%91%E6%A0%BC%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%85%B3%E9%94%AE%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="toc-text">3 骨骼网格模型的关键帧动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E6%A1%88%E4%BE%8B"><span class="toc-text">3.1 案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-AnimationAction%E7%9A%84%E6%9D%83%E9%87%8D%E5%B1%9E%E6%80%A7-weight"><span class="toc-text">3.2 AnimationAction的权重属性.weight</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8A%A8%E7%94%BB%E5%BA%93tweenJs"><span class="toc-text">动画库tweenJs</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95"><span class="toc-text">1 基本语法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-tweenjs%E6%94%B9%E5%8F%98threejs%E6%A8%A1%E5%9E%8B%E5%AF%B9%E8%B1%A1%E4%BD%8D%E7%BD%AE"><span class="toc-text">1.1 tweenjs改变threejs模型对象位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Tweenjs%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-text">1.2 Tweenjs回调函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E7%9B%B8%E6%9C%BA%E5%9C%86%E5%91%A8%E8%BF%90%E5%8A%A8-%EF%BC%8C%E4%B8%94%E4%BF%9D%E6%8C%81%E7%9B%B8%E6%9C%BA%E9%95%9C%E5%A4%B4%E5%AF%B9%E5%87%86%E5%9D%90%E6%A0%87%E5%8E%9F%E7%82%B9"><span class="toc-text">1.2.1 相机圆周运动 ，且保持相机镜头对准坐标原点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E6%A8%A1%E5%9E%8B%E3%80%81%E6%A0%87%E7%AD%BE%E6%B7%A1%E5%85%A5"><span class="toc-text">1.2.2 模型、标签淡入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E6%A8%A1%E5%9E%8B%E6%B7%A1%E5%87%BA"><span class="toc-text">1.2.3 模型淡出</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E7%BC%93%E5%8A%A8%E7%AE%97%E6%B3%95-easing"><span class="toc-text">1.3 缓动算法.easing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="toc-text">2 综合案例</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/13/JS/14_JSLearn_%E6%A8%A1%E5%9D%97%E5%8C%96/" title="14_JSLearn_模块化">14_JSLearn_模块化</a><time datetime="2024-12-13T01:19:26.000Z" title="发表于 2024-12-13 09:19:26">2024-12-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/13/JS/13_JSLearn_%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/" title="13_JSLearn_异常处理">13_JSLearn_异常处理</a><time datetime="2024-12-13T00:28:47.000Z" title="发表于 2024-12-13 08:28:47">2024-12-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/12/JS/12_JSLearn_%E5%BC%82%E6%AD%A5%E5%87%BD%E6%95%B0%E3%80%81%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF-%E9%98%9F%E5%88%97/" title="12_JSLearn_异步函数、事件循环-队列">12_JSLearn_异步函数、事件循环-队列</a><time datetime="2024-12-12T00:47:24.000Z" title="发表于 2024-12-12 08:47:24">2024-12-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/11/JS/11_JSLearn_Iterator%E3%80%81Generator/" title="11_JSLearn_Iterator、Generator">11_JSLearn_Iterator、Generator</a><time datetime="2024-12-10T23:12:36.000Z" title="发表于 2024-12-11 07:12:36">2024-12-11</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/05/JS/10_JSLearn_Promise/" title="10_JSLearn_Promise">10_JSLearn_Promise</a><time datetime="2024-12-05T02:03:58.000Z" title="发表于 2024-12-05 10:03:58">2024-12-05</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Scenery</div><div class="footer_custom_text"><div>波澜不惊</div><div class="footer-div"><img class="footer-icon" src="./img/备案图标.png"><a class="footer-a" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">皖ICP备2021016944号-1</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>