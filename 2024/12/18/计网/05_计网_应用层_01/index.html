<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>05_计网_应用层_01 | 春和景明的记事本</title><meta name="author" content="Scenery"><meta name="copyright" content="Scenery"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 概览  2 FTP 协议 FTP (File Transfer Protocol) 是一种标准网络协议，用于在客户端和服务器之间传输文件。它基于客户端-服务器架构，支持双向文件传输。  2.1 常见用途  从FTP服务器批量下载文件：FTP允许用户从远程服务器上下载多个文件，这对于备份数据或获取"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vernalscenery.github.io/2024/12/18/%E8%AE%A1%E7%BD%91/05_%E8%AE%A1%E7%BD%91_%E5%BA%94%E7%94%A8%E5%B1%82_01/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '05_计网_应用层_01',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-12-22 15:30:40'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">82</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/1.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="春和景明的记事本"><span class="site-name">春和景明的记事本</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">05_计网_应用层_01</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-12-17T20:45:04.000Z" title="发表于 2024-12-18 04:45:04">2024-12-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-12-22T07:30:40.028Z" title="更新于 2024-12-22 15:30:40">2024-12-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">23.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>94分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="05_计网_应用层_01"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-概览"><a href="#1-概览" class="headerlink" title="1 概览"></a>1 概览</h2><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219081314.png" alt="image.png|851"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219081457.png" alt="image.png|860"></p>
<h2 id="2-FTP-协议"><a href="#2-FTP-协议" class="headerlink" title="2 FTP 协议"></a>2 FTP 协议</h2><blockquote>
<p>FTP (File Transfer Protocol) 是一种标准网络协议，用于在客户端和服务器之间传输文件。它基于客户端-服务器架构，支持双向文件传输。</p>
</blockquote>
<h3 id="2-1-常见用途"><a href="#2-1-常见用途" class="headerlink" title="2.1 常见用途"></a>2.1 常见用途</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219082154.png" alt="image.png|738"></p>
<ul>
<li><strong>从FTP服务器批量下载文件</strong>：FTP允许用户从远程服务器上下载多个文件，这对于备份数据或获取大型数据集非常有用。</li>
<li><strong>批量上传网站资源到Web服务器</strong>：开发人员经常使用FTP将网站所需的资源文件（如HTML、CSS、JavaScript等）上传至Web服务器，以实现网站的更新或部署。</li>
</ul>
<h3 id="2-2-FTP-客户端和服务器之间的连接"><a href="#2-2-FTP-客户端和服务器之间的连接" class="headerlink" title="2.2 FTP 客户端和服务器之间的连接"></a>2.2 FTP 客户端和服务器之间的连接</h3><p>FTP（File Transfer Protocol）客户端和服务器之间会建立两个独立的 TCP 连接：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219082304.png" alt="image.png|793"></p>
<ol>
<li><strong>控制连接（Control Connection）</strong>：<ul>
<li><strong>用途</strong>：用于传输相关的控制命令和响应。</li>
<li><strong>端口</strong>：默认使用端口 21。</li>
<li><strong>特性</strong>：<span style="color: #9c88ff; font-weight: 550;">在整个会话期间保持打开状态，直到会话结束。</span></li>
<li><strong>命令示例</strong>：<code>USER</code>, <code>PASS</code>, <code>CWD</code>, <code>PASV</code>, <code>PORT</code>, <code>LIST</code>, <code>RETR</code>, <code>STOR</code>, <code>QUIT</code> 等。</li>
</ul>
</li>
<li><strong>数据连接（Data Connection）</strong>：<ul>
<li><strong>用途</strong>：用于实际的文件传输和目录列表的传输。</li>
<li><strong>端口</strong>：<ul>
<li><strong>主动模式</strong>：默认使用端口 20。</li>
<li><strong>被动模式</strong>：使用动态分配的端口。</li>
</ul>
</li>
<li><strong>特性</strong>：<span style="color: #9c88ff; font-weight: 550;">每次文件传输或目录列表请求时建立，传输完成后立即关闭。</span></li>
<li><strong>模式</strong>：<ul>
<li><strong>主动模式（Active Mode）</strong>：客户端向服务器发送一个端口号，服务器直接连接到这个端口号进行数据传输。</li>
<li><strong>被动模式（Passive Mode）</strong>：服务器向客户端发送一个端口号，客户端连接到这个端口号进行数据传输。被动模式更适用于防火墙环境。</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219082417.png" alt="image.png|751"></p>
<h2 id="3-邮件协议"><a href="#3-邮件协议" class="headerlink" title="3 邮件协议"></a>3 邮件协议</h2><ol>
<li>**SMTP (Simple Mail Transfer Protocol)**：<ul>
<li><strong>用途</strong>：用于发送邮件。</li>
<li><strong>工作原理</strong>：发送方的邮件客户端将邮件发送到发送方的邮件服务器，发送方的邮件服务器再将邮件传递到接收方的邮件服务器。</li>
<li><strong>端口</strong>：默认使用端口25，也可以使用端口587（提交端口）。</li>
</ul>
</li>
<li>**POP3 (Post Office Protocol version 3)**：<ul>
<li><strong>用途</strong>：用于从邮件服务器读取和下载邮件。</li>
<li><strong>工作原理</strong>：用户的邮件客户端连接到邮件服务器，下载所有新邮件到本地设备，下载后邮件通常从服务器上删除（除非配置为保留副本）。</li>
<li><strong>端口</strong>：默认使用端口110。</li>
</ul>
</li>
<li>**IMAP (Internet Message Access Protocol)**：<ul>
<li><strong>用途</strong>：用于从邮件服务器读取和管理邮件。</li>
<li><strong>工作原理</strong>：用户的邮件客户端连接到邮件服务器，查看和管理邮件，邮件保留在服务器上，客户端可以下载部分或全部内容。</li>
<li><strong>端口</strong>：默认使用端口143，加密连接使用端口993（IMAPS）。</li>
</ul>
</li>
<li>**HTTP (Hypertext Transfer Protocol)**：<ul>
<li><strong>用途</strong>：用于通过Web浏览器访问邮件服务（如Gmail、Outlook Web App等）。</li>
<li><strong>工作原理</strong>：用户通过Web浏览器登录邮件服务，使用HTTP或HTTPS协议与邮件服务器进行交互。</li>
<li><strong>端口</strong>：默认使用端口80（HTTP）或443（HTTPS）。</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219083438.png" alt="image.png"></p>
<ol>
<li><strong>发送用户代理（Mail User Agent, MUA）</strong>：<ul>
<li><strong>用途</strong>：用户通过邮件客户端（如Outlook、Gmail等）撰写和发送邮件。</li>
<li><strong>协议</strong>：使用SMTP或HTTP将邮件发送到发送邮件服务器。</li>
<li><strong>示例</strong>：用户在Outlook中撰写邮件并点击“发送”按钮。</li>
</ul>
</li>
<li><strong>发送邮件服务器（Mail Submission Agent, MSA / Mail Transfer Agent, MTA）</strong>：<ul>
<li><strong>用途</strong>：接收来自用户代理的邮件，并负责将邮件发送到接收邮件服务器。</li>
<li><strong>协议</strong>：使用SMTP将邮件发送到接收邮件服务器。</li>
<li><strong>示例</strong>：用户的邮件客户端将邮件发送到其ISP提供的邮件服务器。</li>
</ul>
</li>
<li><strong>接收邮件服务器（Mail Delivery Agent, MDA）</strong>：<ul>
<li><strong>用途</strong>：接收来自发送邮件服务器的邮件，并将其存储在用户的邮箱中。</li>
<li><strong>协议</strong>：使用SMTP接收邮件。</li>
<li><strong>示例</strong>：接收方的邮件服务器将邮件存储在用户的邮箱中，等待用户读取。</li>
</ul>
</li>
<li><strong>接收用户代理（Mail User Agent, MUA）</strong>：<ul>
<li><strong>用途</strong>：用户通过邮件客户端读取和管理邮件。</li>
<li><strong>协议</strong>：使用POP3、IMAP或HTTP从接收邮件服务器读取邮件。</li>
<li><strong>示例</strong>：用户在Outlook中查看收到的邮件。</li>
</ul>
</li>
</ol>
<h3 id="3-1-POP3-协议"><a href="#3-1-POP3-协议" class="headerlink" title="3.1 POP3 协议"></a>3.1 POP3 协议</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219083725.png" alt="image.png|477"></p>
<h3 id="3-2-IMAP-协议"><a href="#3-2-IMAP-协议" class="headerlink" title="3.2 IMAP 协议"></a>3.2 IMAP 协议</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219083815.png" alt="image.png|707"></p>
<h2 id="4-DHCP-协议"><a href="#4-DHCP-协议" class="headerlink" title="4 DHCP 协议"></a>4 DHCP 协议</h2><blockquote>
<p>DHCP（动态主机配置协议）是一种网络协议，用于自动分配IP地址和其他网络配置参数给网络中的设备。通过DHCP，管理员可以简化网络配置管理，减少手动配置错误。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219084439.png" alt="image.png|497"></p>
<h3 id="4-1-主要功能"><a href="#4-1-主要功能" class="headerlink" title="4.1 主要功能"></a>4.1 主要功能</h3><ol>
<li><strong>自动分配IP地址</strong>：DHCP服务器可以自动为网络中的设备分配IP地址，确保每个设备都有一个唯一的IP地址。</li>
<li><strong>分配其他网络参数</strong>：除了IP地址，DHCP还可以分配子网掩码、默认网关、DNS服务器地址等网络配置参数。</li>
<li><strong>租约管理</strong>：DHCP服务器可以设置IP地址的租约时间，当租约到期时，客户端可以请求续租或重新获取新的IP地址。</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219084632.png" alt="image.png|696"></p>
<h3 id="4-2-工作流程"><a href="#4-2-工作流程" class="headerlink" title="4.2 工作流程"></a>4.2 工作流程</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219085006.png" alt="image.png|689"></p>
<ol>
<li><strong>发现阶段（Discovery）</strong>：<ul>
<li><strong>客户端</strong>：客户端广播一个 <code>DHCPDISCOVER</code> 消息，请求IP地址和其他网络配置参数。</li>
<li><strong>服务器</strong>：所有接收到 <code>DHCPDISCOVER</code> 消息的DHCP服务器都会回应一个 <code>DHCPOFFER</code> 消息，提供一个可用的IP地址和其他配置参数。</li>
</ul>
</li>
<li><strong>请求阶段（Request）</strong>：<ul>
<li><strong>客户端</strong>：客户端从收到的多个 <code>DHCPOFFER</code> 消息中选择一个，然后广播一个 <code>DHCPREQUEST</code> 消息，请求选定的IP地址。</li>
<li><strong>服务器</strong>：DHCP服务器接收到 <code>DHCPREQUEST</code> 消息后，确认该IP地址的分配，并发送一个 <code>DHCPACK</code> 消息，确认IP地址和其他配置参数。</li>
</ul>
</li>
<li><strong>确认阶段（Acknowledgment）</strong>：<ul>
<li><strong>客户端</strong>：客户端接收到 <code>DHCPACK</code> 消息后，确认已成功获得IP地址和其他配置参数。</li>
<li><strong>服务器</strong>：如果服务器无法满足客户端的请求，会发送一个 <code>DHCPNAK</code> 消息，拒绝该请求。</li>
</ul>
</li>
</ol>
<h3 id="4-3-配置参数"><a href="#4-3-配置参数" class="headerlink" title="4.3 配置参数"></a>4.3 配置参数</h3><ul>
<li><strong>IP地址</strong>：分配给客户端的唯一IP地址。</li>
<li><strong>子网掩码</strong>：用于确定IP地址的网络部分和主机部分。</li>
<li><strong>默认网关</strong>：用于将数据包路由到其他网络。</li>
<li><strong>DNS服务器地址</strong>：用于域名解析。</li>
<li><strong>租约时间</strong>：IP地址的有效期，客户端在租约到期前可以请求续租。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219084526.png" alt="image.png"></p>
<h2 id="5-DNS-协议"><a href="#5-DNS-协议" class="headerlink" title="5 DNS 协议"></a>5 DNS 协议</h2><blockquote>
<p>DNS（域名系统）是一种用于将人类可读的域名（如 <code>www.imooc.com</code>）转换为计算机可识别的IP地址（如 <code>192.0.2.1</code>）的网络协议。DNS使得互联网用户可以方便地访问网站和服务，而无需记住复杂的IP地址。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219085412.png" alt="image.png|663"></p>
<p><span style="color: #badc58; font-weight: 550;">主要功能</span></p>
<ol>
<li><strong>域名解析</strong>：将域名转换成对应的IP地址。</li>
<li><strong>反向解析</strong>：将IP地址转换成对应的域名。</li>
<li><strong>资源记录管理</strong>：存储和管理各种类型的资源记录，如A记录、MX记录、CNAME记录等。</li>
</ol>
<p><span style="color: #badc58; font-weight: 550;">资源记录类型</span></p>
<ul>
<li><strong>A记录</strong>：将域名映射到IPv4地址。</li>
<li><strong>AAAA记录</strong>：将域名映射到IPv6地址。</li>
<li><strong>CNAME记录</strong>：将一个域名别名指向另一个域名。</li>
<li><strong>MX记录</strong>：指定邮件交换服务器的地址。</li>
<li><strong>NS记录</strong>：指定域名的权威DNS服务器。</li>
<li><strong>PTR记录</strong>：用于反向解析，将IP地址映射到域名。</li>
<li><strong>TXT记录</strong>：用于存储任意文本信息，常用于验证域名所有权或配置SPF记录。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">DNS协议特点</span></p>
<ol>
<li><strong>基于UDP</strong>：<ul>
<li>DNS查询通常使用UDP协议，因为UDP轻量且高效，适合短小的查询和响应。</li>
<li>UDP的默认端口号是53。</li>
<li>对于较大的响应或需要可靠传输的情况，DNS也可以使用TCP协议。</li>
</ul>
</li>
<li><strong>递归查询和迭代查询</strong>：<ul>
<li><strong>递归查询</strong>：客户端要求DNS服务器返回最终结果，如果DNS服务器不知道结果，它会继续向其他DNS服务器查询，直到找到答案。</li>
<li><strong>迭代查询</strong>：客户端每次只向DNS服务器请求一个步骤的结果，如果DNS服务器不知道结果，它会返回一个更接近的DNS服务器地址，客户端再向这个地址发送查询请求。</li>
</ul>
</li>
</ol>
<h3 id="5-1-域名"><a href="#5-1-域名" class="headerlink" title="5.1 域名"></a>5.1 域名</h3><blockquote>
<p>域名是互联网上用于标识和定位特定资源的唯一名称。域名系统（DNS）将这些人类可读的域名转换为计算机可识别的IP地址，使得用户可以方便地访问互联网上的各种服务和资源。</p>
</blockquote>
<p>域名通常由多个部分组成，每个部分之间用点（<code>.</code>）分隔。常见的域名结构如下：</p>
<ul>
<li>**顶级域 (Top-Level Domain, TLD)**：位于域名的最右侧，例如 <code>.com</code>、<code>.org</code>、<code>.net</code>、<code>.edu</code> 等。</li>
<li>**二级域 (Second-Level Domain, SLD)**：位于顶级域的左侧，例如 <code>example</code> 在 <code>example.com</code> 中。</li>
<li>**子域 (Subdomain)**：位于二级域的左侧，例如 <code>www</code> 在 <code>www.example.com</code> 中。</li>
</ul>
<p>例如，域名 <code>www.example.com</code> 的结构如下：</p>
<ul>
<li><code>www</code>：子域</li>
<li><code>example</code>：二级域</li>
<li><code>com</code>：顶级域</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219085719.png" alt="image.png"></p>
<h3 id="5-2-域名服务器"><a href="#5-2-域名服务器" class="headerlink" title="5.2 域名服务器"></a>5.2 域名服务器</h3><blockquote>
<p>域名服务器是负责将域名转换为IP地址的服务器。它们是域名系统（DNS）的核心组成部分，确保互联网用户可以通过易记的域名访问网络资源，而不需要记住复杂的IP地址。域名和IP的对应关系保存在域名服务器中，供查询。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219085846.png" alt="image.png|715"></p>
<h4 id="5-2-1-域名服务器的类型"><a href="#5-2-1-域名服务器的类型" class="headerlink" title="5.2.1 域名服务器的类型"></a>5.2.1 域名服务器的类型</h4><ol>
<li><strong>根域名服务器 (Root DNS Servers)</strong><ul>
<li>根域名服务器是DNS层次结构的最顶层，负责提供顶级域名服务器的地址。</li>
<li>全球共有13组根域名服务器，分别由不同的组织管理和维护。</li>
<li>所有域名服务器都记录了根域名服务器的IP地址，这是DNS解析的起点。</li>
</ul>
</li>
<li><strong>顶级域名服务器 (Top-Level Domain, TLD Servers)</strong><ul>
<li>顶级域名服务器负责管理特定的顶级域名（如 <code>.com</code>、<code>.org</code>、<code>.net</code> 等）。</li>
<li>根域名服务器会返回相应的顶级域名服务器的IP地址。</li>
<li>顶级域名服务器记录了下一级域名服务器（即权威域名服务器）的IP地址。</li>
</ul>
</li>
<li><strong>权威域名服务器 (Authoritative DNS Servers)</strong><ul>
<li>权威域名服务器负责管理特定域名的详细信息，包括IP地址、子域等。</li>
<li>顶级域名服务器会返回相应的权威域名服务器的IP地址。</li>
<li>权威域名服务器保存了最终的域名和IP地址的对应关系。</li>
</ul>
</li>
<li><strong>本地域名服务器 (Local DNS Servers)</strong><ul>
<li>本地域名服务器也称为递归解析器（Recursive Resolvers），是用户设备（如个人电脑、手机）和网络服务提供商（ISP）之间的中介。</li>
<li>它们负责处理用户的DNS查询请求，并通过递归查询的方式获取最终的IP地址。</li>
<li>本地域名服务器会缓存查询结果，以提高后续查询的速度。</li>
</ul>
</li>
</ol>
<h4 id="5-2-2-域名解析过程"><a href="#5-2-2-域名解析过程" class="headerlink" title="5.2.2 域名解析过程"></a>5.2.2 域名解析过程</h4><p>假设用户在浏览器中输入 <code>www.example.com</code>，以下是详细的解析过程：</p>
<ol>
<li><strong>客户端请求</strong>：<ul>
<li>浏览器向本地DNS解析器发送查询请求：<code>www.example.com</code>。</li>
</ul>
</li>
<li><strong>本地DNS解析器</strong>：<ul>
<li>本地DNS解析器检查缓存，没有找到 <code>www.example.com</code> 的IP地址，于是向根域名服务器发送查询请求。</li>
</ul>
</li>
<li><strong>根域名服务器</strong>：<ul>
<li>根域名服务器不直接提供IP地址，而是返回一个顶级域名的权威DNS服务器的地址。</li>
<li>根域名服务器返回 <code>.com</code> 顶级域名服务器的IP地址。</li>
</ul>
</li>
<li><strong>顶级域名服务器</strong>：<ul>
<li>本地DNS解析器向 <code>.com</code> 顶级域名服务器发送查询请求。</li>
<li>顶级域名服务器返回 <code>example.com</code> 的权威DNS服务器的IP地址。</li>
</ul>
</li>
<li><strong>权威域名服务器</strong>：<ul>
<li>本地DNS解析器向 <code>example.com</code> 的权威DNS服务器发送查询请求。</li>
<li>权威DNS服务器返回 <code>www.example.com</code> 的IP地址，例如 <code>192.0.2.100</code>。</li>
</ul>
</li>
<li><strong>缓存</strong>：<ul>
<li>本地DNS解析器将 <code>www.example.com</code> 和 <code>192.0.2.100</code> 的对应关系缓存起来。</li>
</ul>
</li>
<li><strong>客户端接收</strong>：<ul>
<li>浏览器从本地DNS解析器获取 <code>192.0.2.100</code>，并使用该IP地址与目标服务器建立连接。</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219090903.png" alt="image.png"></p>
<h2 id="6-HTTP-协议"><a href="#6-HTTP-协议" class="headerlink" title="6 HTTP 协议"></a>6 HTTP 协议</h2><h3 id="6-1-认识-HTTP-协议"><a href="#6-1-认识-HTTP-协议" class="headerlink" title="6.1 认识 HTTP 协议"></a>6.1 认识 HTTP 协议</h3><blockquote>
<p>HTTP 是一种用于在网络上传输超文本的应用层协议。它的最初目的是提供一种发送和接收 HTML 页面的方法。HTTP 是基于 TCP 协议的应用层协议，采用请求-响应模型进行通信。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219091911.png" alt="image.png|649"></p>
<h4 id="6-1-1-HTTP-版本"><a href="#6-1-1-HTTP-版本" class="headerlink" title="6.1.1 HTTP 版本"></a>6.1.1 HTTP 版本</h4><ol>
<li><strong>HTTP/0.9</strong>：<ul>
<li>最初的版本，非常简单，只支持 GET 方法，没有头部信息。</li>
<li>请求格式：<code>GET /path</code></li>
<li>响应格式：纯文本内容</li>
</ul>
</li>
<li><strong>HTTP/1.0</strong>：<ul>
<li>引入了更多的方法（如 POST、HEAD）和头部字段。</li>
<li>每个请求都需要建立新的 TCP 连接，导致性能问题。</li>
<li>请求格式：<code>GET /path HTTP/1.0</code></li>
<li>响应格式：<code>HTTP/1.0 200 OK\nContent-Type: text/html\n\n&lt;html&gt;...&lt;/html&gt;</code></li>
</ul>
</li>
<li><strong>HTTP/1.1</strong>：<ul>
<li>引入了持久连接（Persistent Connections），允许在一个 TCP 连接上发送多个请求和响应。</li>
<li>支持管道化（Pipelining），即客户端可以在一个连接上发送多个请求，而不需要等待每个请求的响应。</li>
<li>引入了缓存控制、分块传输编码等机制。</li>
<li>请求格式：<code>GET /path HTTP/1.1\nHost: example.com</code></li>
<li>响应格式：<code>HTTP/1.1 200 OK\nContent-Type: text/html\n\n&lt;html&gt;...&lt;/html&gt;</code></li>
</ul>
</li>
<li><strong>HTTP/2</strong>：<ul>
<li>引入了多路复用（Multiplexing），允许多个请求和响应同时在一个连接上进行，提高了性能。</li>
<li>使用二进制分帧层，减少了解析开销。</li>
<li>支持服务器推送（Server Push），服务器可以主动推送资源到客户端。</li>
<li>请求和响应格式仍然是文本，但底层传输是二进制的。</li>
</ul>
</li>
<li><strong>HTTP/3</strong>：<ul>
<li>基于 QUIC 协议，QUIC 是一种基于 UDP 的传输协议，旨在减少延迟和提高可靠性。</li>
<li>解决了 TCP 的队头阻塞问题，进一步提高了性能。</li>
<li>继承了 HTTP/2 的多路复用和服务器推送特性。</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219091934.png" alt="image.png|572"></p>
<h4 id="6-1-2-HTTP-请求-响应模型"><a href="#6-1-2-HTTP-请求-响应模型" class="headerlink" title="6.1.2 HTTP 请求-响应模型"></a>6.1.2 HTTP 请求-响应模型</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219092047.png" alt="image.png|574"></p>
<ol>
<li><strong>建立 TCP 连接</strong>：<ul>
<li>客户端和服务器之间通过 TCP 三次握手建立连接。</li>
<li>三次握手过程：<ol>
<li>客户端发送 SYN 报文段。</li>
<li>服务器回应 SYN+ACK 报文段。</li>
<li>客户端发送 ACK 报文段。</li>
</ol>
</li>
</ul>
</li>
<li><strong>发送 HTTP 请求</strong>：<ul>
<li>客户端通过已建立的 TCP 连接发送 HTTP 请求。</li>
<li>请求格式包括请求行、请求头部和请求体。</li>
</ul>
</li>
<li><strong>服务器接收请求并处理</strong>：<ul>
<li>服务器接收到请求后，解析请求行和头部信息，根据请求路径和方法进行处理。</li>
<li>处理过程中可能涉及读取文件、执行脚本、查询数据库等操作。</li>
</ul>
</li>
<li><strong>发送 HTTP 响应</strong>：<ul>
<li>服务器处理完请求后，通过已建立的 TCP 连接发送 HTTP 响应。</li>
<li>响应格式包括状态行、响应头部和响应体。</li>
</ul>
</li>
<li><strong>关闭 TCP 连接</strong>：<ul>
<li>客户端和服务器通过 TCP 四次挥手关闭连接。释放连接，客户端，服务器都可以发起的。</li>
<li>四次挥手过程：<ol>
<li>客户端发送 FIN 报文段。</li>
<li>服务器回应 ACK 报文段。</li>
<li>服务器发送 FIN 报文段。</li>
<li>客户端回应 ACK 报文段。</li>
</ol>
</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219092625.png" alt="image.png"></p>
<h3 id="6-2-HTTP-报文格式"><a href="#6-2-HTTP-报文格式" class="headerlink" title="6.2 HTTP 报文格式"></a>6.2 HTTP 报文格式</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219094529.png" alt="image.png|545"></p>
<h4 id="6-2-1-请求报文格式"><a href="#6-2-1-请求报文格式" class="headerlink" title="6.2.1 请求报文格式"></a>6.2.1 请求报文格式</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219100626.png" alt="image.png"></p>
<h4 id="6-2-2-响应报文格式"><a href="#6-2-2-响应报文格式" class="headerlink" title="6.2.2 响应报文格式"></a>6.2.2 响应报文格式</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219100650.png" alt="image.png"></p>
<h4 id="6-2-3-HTTP-使用的字符编码"><a href="#6-2-3-HTTP-使用的字符编码" class="headerlink" title="6.2.3 HTTP 使用的字符编码"></a>6.2.3 HTTP 使用的字符编码</h4><ul>
<li>HTTP 协议的首部部分包括请求行和首部行，这两部分都采用 <strong>ASCII 编码</strong>。</li>
<li>实体部分的编码方式是多种多样的，具体取决于 <code>Content-Type</code> 和 <code>Content-Encoding</code> 首部字段的设置。</li>
<li><code>Accept-Charset</code> 首部字段用于客户端告诉服务器它支持的字符集<ul>
<li>例如：<code>Accept-Charset: utf-8, iso-8859-1;q=0.5</code> 表示客户端优先支持 UTF-8，也可以接受 ISO-8859-1</li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">内容类型 (Content-Type)</span></p>
<p><code>Content-Type</code> 首部字段指定了实体部分的数据类型。常见的 <code>Content-Type</code> 包括：</p>
<ul>
<li><code>text/html</code>：HTML 文档，通常使用 UTF-8 编码。</li>
<li><code>application/json</code>：JSON 数据，通常使用 UTF-8 编码。</li>
<li><code>application/x-www-form-urlencoded</code>：表单数据，通常使用 URL 编码。</li>
<li><code>multipart/form-data</code>：用于文件上传，通常包含二进制数据。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">内容编码 (Content-Encoding)</span></p>
<p><code>Content-Encoding</code> 首部字段指定了实体部分的编码方式，用于压缩传输数据。常见的 <code>Content-Encoding</code> 包括：</p>
<ul>
<li><code>gzip</code>：使用 GZIP 压缩算法。</li>
<li><code>deflate</code>：使用 DEFLATE 压缩算法。</li>
<li><code>br</code>：使用 Brotli 压缩算法。</li>
</ul>
<h3 id="6-3-字符集和编码"><a href="#6-3-字符集和编码" class="headerlink" title="6.3 字符集和编码"></a>6.3 字符集和编码</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219101301.png" alt="image.png|680"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219101555.png" alt="image.png|693"></p>
<ul>
<li><strong>字符集</strong>定义了一组字符及其对应的唯一标识符。</li>
<li><strong>编码</strong>定义了如何将这些字符的标识符转换为二进制形式。</li>
</ul>
<h4 id="6-3-1-字符集-Character-Set"><a href="#6-3-1-字符集-Character-Set" class="headerlink" title="6.3.1 字符集 (Character Set)"></a>6.3.1 字符集 (Character Set)</h4><p>字符集是指一组字符的集合，每个字符在这个集合中都有一个唯一的标识符。常见的字符集包括：</p>
<ul>
<li><strong>ASCII</strong>：American Standard Code for Information Interchange，包含 128 个字符，主要用于英文字符的编码。</li>
<li><strong>ISO-8859-1</strong>：也称为 Latin-1，包含 256 个字符，主要用于西欧语言的编码。</li>
<li><strong>UTF-8</strong>：Unicode Transformation Format - 8-bit，是一种变长编码，可以表示 Unicode 标准中的所有字符。</li>
<li><strong>UTF-16</strong>：Unicode Transformation Format - 16-bit，也是一种变长编码，主要用于需要更高效处理多字节字符的场合。</li>
<li><strong>GBK</strong>：GB2312 的扩展，包含更多中文字符。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219101800.png" alt="image.png|755"></p>
<h4 id="6-3-2-编码-Encoding"><a href="#6-3-2-编码-Encoding" class="headerlink" title="6.3.2  编码 (Encoding)"></a>6.3.2  编码 (Encoding)</h4><p>编码是指将字符集中的字符转换为计算机可以处理的二进制形式的过程。常见的编码方式包括：</p>
<ul>
<li><strong>ASCII 编码</strong>：使用 7 位二进制数表示一个字符，共能表示 128 个字符。</li>
<li><strong>ISO-8859-1 编码</strong>：使用 8 位二进制数表示一个字符，共能表示 256 个字符。</li>
<li><strong>UTF-8 编码</strong>：使用 1 到 4 个字节表示一个字符，可以表示 Unicode 标准中的所有字符。</li>
<li><strong>UTF-16 编码</strong>：使用 2 或 4 个字节表示一个字符，主要用于需要更高效处理多字节字符的场合。</li>
<li><strong>GBK 编码</strong>：使用 2 个字节表示一个字符，主要用于中文字符的编码</li>
</ul>
<h3 id="6-4-统一编码-Unicode"><a href="#6-4-统一编码-Unicode" class="headerlink" title="6.4 统一编码 Unicode"></a>6.4 统一编码 <code>Unicode</code></h3><blockquote>
<p>Unicode 是一个国际标准，旨在为世界上所有字符提供一个统一的编码方案。它的目标是确保任何字符在任何平台上都能被一致地表示和处理。Unicode 提供了一个全面的字符集，并定义了多种编码方式来表示这些字符。</p>
</blockquote>
<h4 id="6-4-1-Unicode的特点"><a href="#6-4-1-Unicode的特点" class="headerlink" title="6.4.1 Unicode的特点"></a>6.4.1 Unicode的特点</h4><ul>
<li>全面性：Unicode 覆盖了世界上几乎所有的字符系统。</li>
<li>唯一性：每个字符在 Unicode 中都有一个唯一的编码点（Code Point）。这意味着无论在什么平台、什么程序、什么语言中，该字符的 Unicode 编码都是相同的。</li>
<li>扩展性：Unicode 设计了多种编码方案（如 UTF-8、UTF-16、UTF-32）来适应不同的存储和传输需求。</li>
<li>兼容性：Unicode 考虑到了与现有编码系统的兼容性，例如，它的前128个字符与 ASCII 码完全一致，使得 Unicode 能够与大量现有的软件和系统无缝集成。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219110516.png" alt="image.png|577"></p>
<h4 id="6-4-2-定长编码-Fixed-Length-Encoding"><a href="#6-4-2-定长编码-Fixed-Length-Encoding" class="headerlink" title="6.4.2 定长编码(Fixed-Length Encoding)"></a>6.4.2 定长编码(Fixed-Length Encoding)</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219102833.png" alt="image.png|586"></p>
<p>定长编码是指每个字符占用的字节数是固定的。常见的定长编码包括：</p>
<ul>
<li><strong>UTF-32</strong>：每个字符占用 4 个字节。</li>
<li><strong>UCS-2</strong>：每个字符占用 2 个字节（仅支持 BMP 平面）。</li>
</ul>
<p> <span style="color: #badc58; font-weight: 550;">特点</span></p>
<ul>
<li><strong>简单直接</strong>：每个字符的长度固定，解析和处理相对简单。</li>
<li><strong>内存消耗大</strong>：每个字符占用较多字节，导致内存和存储空间消耗较大。</li>
<li><strong>不经济</strong>：对于常用的 ASCII 字符，占用过多字节，浪费资源。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">示例</span></p>
<p>其中每个字符的编码以16进制表示，2位表示一个字节。</p>
<ul>
<li><strong>UTF-32</strong>：<ul>
<li><code>A</code>（U+0041）：<code>0x00000041</code></li>
<li><code>汉</code>（U+6C49）：<code>0x00006C49</code></li>
</ul>
</li>
<li><strong>UCS-2</strong>：<ul>
<li><code>A</code>（U+0041）：<code>0x0041</code></li>
<li><code>汉</code>（U+6C49）：<code>0x6C49</code></li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">应用场景</span></p>
<ul>
<li><strong>内部处理</strong>：在某些编程语言或系统中，为了简化处理逻辑，可能会使用定长编码。</li>
<li><strong>固定长度数据</strong>：在需要固定长度数据的场合，如某些数据库存储和网络协议中。</li>
</ul>
<h4 id="6-4-3-可变长编码-Variable-Length-Encoding"><a href="#6-4-3-可变长编码-Variable-Length-Encoding" class="headerlink" title="6.4.3 可变长编码 (Variable-Length Encoding)"></a>6.4.3 可变长编码 (Variable-Length Encoding)</h4><p>可变长编码是指每个字符占用的字节数不是固定的，而是根据字符的不同而变化。常见的可变长编码包括：</p>
<ul>
<li><strong>UTF-8</strong>：每个字符占用 1 到 4 个字节。</li>
<li><strong>UTF-16</strong>：每个字符占用 2 或 4 个字节。</li>
</ul>
<p> <span style="color: #badc58; font-weight: 550;">特点</span></p>
<ul>
<li><strong>节省空间</strong>：对于常用的 ASCII 字符，占用较少字节，节省内存和存储空间。</li>
<li><strong>兼容性好</strong>：UTF-8 与 ASCII 兼容，广泛应用于互联网和文件系统。</li>
<li><strong>复杂度高</strong>：解析和处理相对复杂，需要更多的计算资源</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">示例</span></p>
<p>其中每个字符的编码以16进制表示，2位表示一个字节。</p>
<ul>
<li><strong>UTF-8</strong>：<ul>
<li><code>A</code>（U+0041）：<code>0x41</code>（1 个字节）</li>
<li><code>汉</code>（U+6C49）：<code>0xE6 0xB1 0x89</code>（3 个字节）</li>
</ul>
</li>
<li><strong>UTF-16</strong>：<ul>
<li><code>A</code>（U+0041）：<code>0x0041</code>（2 个字节）</li>
<li><code>汉</code>（U+6C49）：<code>0x6C49</code>（2 个字节）</li>
<li><code>𐐷</code>（U+10437）：<code>0xD801 0xDC37</code>（4 个字节）</li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">应用场景</span></p>
<ul>
<li><strong>互联网</strong>：UTF-8 是互联网上最常用的编码方式，因为它与 ASCII 兼容且节省空间。</li>
<li><strong>文件系统</strong>：许多现代文件系统默认使用 UTF-8 编码。</li>
<li><strong>多语言支持</strong>：在需要支持多种语言的场合，可变长编码能够更有效地表示不同语言的字符。</li>
</ul>
<h4 id="6-4-4-UTF-8"><a href="#6-4-4-UTF-8" class="headerlink" title="6.4.4 UTF-8"></a>6.4.4 UTF-8</h4><p>UTF-8 是一种可变长编码方式，能够高效地表示 Unicode 字符集中的所有字符。</p>
<p>UTF-8 将 Unicode 字符集分成四个区间，每个区间内的字符使用不同数量的字节进行编码。这四个区间分别是：</p>
<ul>
<li><strong>单字节编码</strong>：<span style="color: #9c88ff; font-weight: 550;">适用于 ASCII 字符</span>，每个字符占用 1 个字节。</li>
<li><strong>双字节编码</strong>：适用于扩展的拉丁字符和其他常用字符，每个字符占用 2 个字节。</li>
<li><strong>三字节编码</strong>：适用于大部分非拉丁字符，每个字符占用 3 个字节。</li>
<li><strong>四字节编码</strong>：适用于辅助平面的字符，每个字符占用 4 个字节。</li>
</ul>
<p>UTF-8的编码规则</p>
<ul>
<li>单字节的字符，字节的第一位设为0，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8编码和 ASCII 码是相同的。</li>
<li>对于 n 字节的字符（n&gt;1），第一个字节的前 n 位都设为1，第 n+1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，则是这个符号的 Unicode 码。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219175215.png" alt="image.png|799"></p>
<p>以字符 <code>é</code> 的 Unicode 编码 <code>U+00E9</code> 为例：</p>
<ol>
<li><strong>Unicode 编码</strong>：<code>U+00E9</code> 对应的十进制值是 <code>233</code>。</li>
<li><strong>转换为二进制</strong>：<code>233</code> 转换为二进制是 <code>11101001</code>（8 位）。</li>
<li><strong>扩展为 11 位</strong>：因为 UTF-8 双字节字符需要 11 位来表示，所以在前面补零，得到 <code>0000011101001</code>（11 位）。</li>
</ol>
<p>其实这里十六进制<code>0x00E9</code>转二进制本身就是<code>0000011101001</code>，只是把前面的<code>0</code>省略了</p>
<p>现在我们有 11 位二进制数：<code>0000011101001</code></p>
<ol>
<li><strong>高五位</strong>：取前 5 位（从左到右），即 <code>00000</code>。将高五位 <code>00000</code> 放入格式<code>110xxxxx</code>中的 <code>xxxxx</code> 位置。</li>
<li><strong>低六位</strong>：取剩下的 6 位，即 <code>111010</code>。将低六位 <code>111010</code> 放入格式<code>10xxxxxx</code>中的 <code>xxxxxx</code> 位置。</li>
</ol>
<p>最终，字符 <code>é</code> 的 UTF-8 编码为 <code>C3 A9</code>。</p>
<p><span style="color: #badc58; font-weight: 550;">案例</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219172602.png" alt="image.png|733"></p>
<p>这个过程是可逆的，即编码和解码的过程</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219105546.png" alt="image.png|935"></p>
<ul>
<li>一般用什么方式编码，就要用相同的编码方式来解码，否则会出现<strong>乱码</strong></li>
</ul>
<h3 id="6-5-基于-HTTP-协议的通信"><a href="#6-5-基于-HTTP-协议的通信" class="headerlink" title="6.5 基于 HTTP 协议的通信"></a>6.5 基于 HTTP 协议的通信</h3><p>这里是之前写的 <code>基于TCP协议的通信</code>代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// net模块提供了TCP通信</span></span><br><span class="line"><span class="keyword">const</span> net = <span class="built_in">require</span>(<span class="string">&quot;net&quot;</span>); <span class="comment">// 导入node内置的net模块</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建TCP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = net.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的连接</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="function">(<span class="params">clientSocket</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// clientSocket可以理解为客户端和服务端之间的一个连接对象</span></span><br><span class="line">  <span class="comment">// 每一次连接, 服务器这边就会创建一个对象(clientSocket)来管理这个连接, 可以使用它在服务端接收和发送数据</span></span><br><span class="line">  <span class="comment">// 每一次连接, 客户端这边就会创建一个对象(client)来管理这个连接, 可以使用它在客户端接收和发送数据</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 客户端IP和端口号</span></span><br><span class="line">  <span class="keyword">const</span> &#123; remoteAddress, remotePort &#125; = clientSocket;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`新的连接:<span class="subst">$&#123;remoteAddress&#125;</span>:<span class="subst">$&#123;remotePort&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收到客户端数据</span></span><br><span class="line">  clientSocket.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`来自<span class="subst">$&#123;remoteAddress&#125;</span>:<span class="subst">$&#123;remotePort&#125;</span>的数据:\n <span class="subst">$&#123;data&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向客户端发送数据</span></span><br><span class="line">  clientSocket.<span class="title function_">write</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 监听断开连接</span></span><br><span class="line">  clientSocket.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`断开连接:<span class="subst">$&#123;remoteAddress&#125;</span>:<span class="subst">$&#123;remotePort&#125;</span>断开连接`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异常捕获</span></span><br><span class="line">  clientSocket.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;remoteAddress&#125;</span>:<span class="subst">$&#123;remotePort&#125;</span>连接异常:$<span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9111端口</span></span><br><span class="line"><span class="comment">// 在本机可以通过127.0.0.1:9111或者localhost:9111访问本服务器</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9111</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;服务器已经在127.0.0.1:9111 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>服务器端启动后，打开浏览器访问<code>127.0.0.1:9111</code></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219111541.png" alt="image.png"></p>
<p>可以得到</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219111631.png" alt="image.png"></p>
<ul>
<li>可以发现并没有对 HTTP 的请求报文进行处理和解析</li>
<li>再就是，浏览器界面并没有加载成功，一直在转圈加载</li>
</ul>
<p>故需要对如下代码进行改造，使其符合 HTTP 协议</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向客户端发送数据</span></span><br><span class="line">clientSocket.<span class="title function_">write</span>(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>改造如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 向客户端发送数据</span></span><br><span class="line">clientSocket.<span class="title function_">write</span>(<span class="string">&quot;HTTP/1.1 200 OK\r\n&quot;</span>);</span><br><span class="line">clientSocket.<span class="title function_">write</span>(<span class="string">&quot;Content-Length: 5\r\n\r\n&quot;</span>);</span><br><span class="line">clientSocket.<span class="title function_">write</span>(<span class="string">&quot;Hello&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>这样浏览器就可以获取到服务器发送的数据</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219112614.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">原理：</span></p>
<p>HTTP服务器和客户端，需要按照HTTP协议的约定，处理报文和发送报文</p>
<ul>
<li>服务器按照HTTP的响应报文格式发送数据，按照HTTP的请求报文格式接收数据</li>
<li>客户端按照HTTP的请求报文格式发送数据，按照HTTP的响应报文格式接收数据</li>
<li>如果客户端是浏览器，还需要解析接收到的主体数据(比如解析并渲染HTML)</li>
<li>接收到的都是二进制数据，但是HTTP的首部是按照ASC川方式编码的，所以按照ASCI编码就可以将二进制数据转变成字符</li>
</ul>
<p><code>NodeJS</code>已经上述原理，封装好了 http 模块</p>
<p><span style="color: #badc58; font-weight: 550;">服务器端</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 客户端请求的相关信息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">method</span>, req.<span class="property">url</span>, req.<span class="property">httpVersion</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">headers</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 无法通过这样的方式获取到请求体携带的数据</span></span><br><span class="line">  <span class="comment">// 因为当我们服务器接收到请求的时候，通过请求体携带的数据可能还没有全部传过来（比如数据很大的时候）</span></span><br><span class="line">  <span class="comment">// req.body</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式1: 接收请求体数据---拼接字符串(不推荐)</span></span><br><span class="line">  <span class="comment">// 如果确定请求体携带的都是字符数据，可以使用</span></span><br><span class="line">  <span class="comment">// 如果有的数据不是字符，强行转换成字符会破坏数据本身</span></span><br><span class="line">  <span class="comment">//   let result = &quot;&quot;;</span></span><br><span class="line">  <span class="comment">//   req.on(&quot;data&quot;, (chunk) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//     result += chunk.toString(); // 二进制转字符串</span></span><br><span class="line">  <span class="comment">//   &#125;);</span></span><br><span class="line">  <span class="comment">//   req.on(&quot;end&quot;, () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(result);</span></span><br><span class="line">  <span class="comment">//   &#125;);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 方式2: 接收请求体数据---拼接二进制(推荐)</span></span><br><span class="line">  <span class="comment">// 作为二进制处理</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 可以按需处理</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results)); <span class="comment">// eg: [ &lt;Buffer 48&gt;, &lt;Buffer 49&gt; ] =&gt; &lt;Buffer48 69&gt;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>());</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向客户端响应数据</span></span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9222端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9222</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9222 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">客户端</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向127.0.0.1:9222 发送HTTP请求</span></span><br><span class="line"><span class="keyword">const</span> req = <span class="title function_">request</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9222</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="comment">// headers: &#123;&#125;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 响应的相关信息</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">httpVersion</span>, res.<span class="property">statusCode</span>, res.<span class="property">statusMessage</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">headers</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="comment">// 数据流接收</span></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">      results.<span class="title function_">push</span>(chunk);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 数据接收完毕</span></span><br><span class="line">    res.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 可以按需处理</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>());</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向服务器发送数据</span></span><br><span class="line"><span class="comment">// req.write(&quot;Hi&quot;);</span></span><br><span class="line">req.<span class="title function_">end</span>(<span class="string">&quot;Hi&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-6-HTTP-请求方法"><a href="#6-6-HTTP-请求方法" class="headerlink" title="6.6 HTTP 请求方法"></a>6.6 HTTP 请求方法</h3><ul>
<li>HTTP请求方法表明了请求期望执行的操作</li>
<li>不同的请求方法有不同的语义</li>
<li>服务器端一般根据请求方法和请求URL等信息决定具体的操作</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219144724.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">注意</span></p>
<ul>
<li>通过 URL<code>/?username=alex&amp;age=18</code>携带少量数据，每个请求方法都可以使用这种方式，</li>
<li>只是 <code>GET</code> 只有通过这种方式才能携带少量数据</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">相关代码</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 客户端请求的相关信息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">method</span>, req.<span class="property">url</span>, req.<span class="property">httpVersion</span>);</span><br><span class="line">  <span class="comment">// console.log(req.headers);</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(url.<span class="title function_">parse</span>(req.<span class="property">url</span>).<span class="property">query</span>); <span class="comment">// username=alex&amp;age=18</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>).<span class="property">query</span>); <span class="comment">// [Object: null prototype] &#123; username: &#x27;alex&#x27;, age: &#x27;18&#x27; &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接二进制(推荐)</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results)); <span class="comment">// eg: [ &lt;Buffer 48&gt;, &lt;Buffer 49&gt; ] =&gt; &lt;Buffer48 69&gt;</span></span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果是GET请求方法, 即使请求体携带了数据, 服务器也不应该使用</span></span><br><span class="line">    <span class="comment">// console.log(&quot;不应该使用&quot;, req.body);</span></span><br><span class="line">    <span class="comment">// GET与其它方法一样，都可以通过URL携带少量数据，例如localhost:9000/?username=alex&amp;age=18</span></span><br><span class="line">    <span class="comment">// console.log(query);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以按需处理</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&quot;GET&quot;</span> &amp;&amp; (pathname === <span class="string">&quot;/&quot;</span> || pathname === <span class="string">&quot;/index.html&quot;</span>)) &#123;</span><br><span class="line">      fs.<span class="title function_">readFile</span>(<span class="string">&quot;index.html&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123; <span class="comment">// 读取index.html页面</span></span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 向客户端响应数据</span></span><br><span class="line">        res.<span class="title function_">end</span>(data);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method === <span class="string">&quot;POST&quot;</span> &amp;&amp; pathname === <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;可以使用: &quot;</span>, req.<span class="property">body</span>);</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;Login Success&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;404&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9222端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9222</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9222 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219145244.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">通过HEAD方法测试网址是否可用</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过HEAD方法测试网址是否可用</span></span><br><span class="line"><span class="comment">// www.baidu.com</span></span><br><span class="line"><span class="comment">// www.abd.com</span></span><br><span class="line"><span class="comment">// 127.0.0.1:9222</span></span><br><span class="line"><span class="keyword">const</span> req = <span class="title function_">request</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;www.abd.com&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;HEAD&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="comment">// headers: &#123;&#125;,</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 响应的相关信息</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">httpVersion</span>, res.<span class="property">statusCode</span>, res.<span class="property">statusMessage</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">headers</span>);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">req.<span class="title function_">on</span>(<span class="string">&quot;error&quot;</span>, <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;连接失效了&quot;</span>, err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向服务器发送数据</span></span><br><span class="line">req.<span class="title function_">end</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-7-RESTful-风格的-API"><a href="#6-7-RESTful-风格的-API" class="headerlink" title="6.7 RESTful 风格的 API"></a>6.7 <code>RESTful</code> 风格的 <code>API</code></h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219150645.png" alt="image.png|522"></p>
<ul>
<li>API：封装成一个对象，暴露出一些属性和方法供外界使用</li>
<li><code>RESTful</code> 风格：就是一种API的设计风格，不是强制约定</li>
</ul>
<h4 id="6-7-1-一般风格的-API"><a href="#6-7-1-一般风格的-API" class="headerlink" title="6.7.1 一般风格的 API"></a>6.7.1 一般风格的 <code>API</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219150911.png" alt="image.png|513"></p>
<h4 id="6-7-2-RESTful-风格的-API"><a href="#6-7-2-RESTful-风格的-API" class="headerlink" title="6.7.2 RESTful 风格的 API"></a>6.7.2 <code>RESTful</code> 风格的 <code>API</code></h4><p><code>RESTful</code>风格的API会<strong>配合各种请求方法</strong>，使API设计的更优雅</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219151046.png" alt="image.png|518"></p>
<h4 id="6-7-3-代码实现"><a href="#6-7-3-代码实现" class="headerlink" title="6.7.3 代码实现"></a>6.7.3 代码实现</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219160058.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">注意：</span></p>
<ul>
<li><code>pathname.startsWith(&quot;/users/&quot;)</code>判断<code>/users/id</code>是否以<code>/users/</code>开头</li>
<li>获取用户 ID 的方式不同</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="title class_">Number</span>(query.<span class="property">id</span>); <span class="comment">// 一般风格的API</span></span><br><span class="line"><span class="keyword">const</span> id = <span class="title class_">Number</span>(pathname.<span class="title function_">slice</span>(<span class="number">7</span>)); <span class="comment">// RESTful风格的API</span></span><br></pre></td></tr></table></figure>

<h3 id="6-8-URL"><a href="#6-8-URL" class="headerlink" title="6.8 URL"></a>6.8 URL</h3><h4 id="6-8-1-URI、URL和URN"><a href="#6-8-1-URI、URL和URN" class="headerlink" title="6.8.1 URI、URL和URN"></a>6.8.1 URI、URL和URN</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219160624.png" alt="image.png|491"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219160914.png" alt="image.png|473"></p>
<ul>
<li><strong>URI：统一资源标识符</strong>，是一个用于标识互联网上资源名称的字符串。<span style="color: #9c88ff; font-weight: 550;">URI 是 URL 和 URN 的超集</span>，意味着所有的 URL 和 URN 都是 URI。</li>
<li><strong>URL：统一资源定位符</strong>，是 URI 的一种，<span style="color: #9c88ff; font-weight: 550;">它不仅标识资源，还提供了如何获取该资源的信息（即位置）</span>。URL 主要用于在网络中定位和访问资源。</li>
<li><strong>URN：统一资源名称</strong>，也是 URI 的一种，但它<span style="color: #9c88ff; font-weight: 550;">侧重于资源的身份而不是位置</span>。URN 不提供具体的访问路径，故<span style="color: #9c88ff; font-weight: 550;">不具备定位的能力</span>，而是提供一种持久且独立于位置的方式来<span style="color: #9c88ff; font-weight: 550;">标识资源</span>。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219162038.png" alt="image.png|662"></p>
<p><span style="color: #badc58; font-weight: 550;">hash 举例</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219161533.png" alt="image.png"></p>
<h4 id="6-8-2-URL-编码"><a href="#6-8-2-URL-编码" class="headerlink" title="6.8.2 URL 编码"></a>6.8.2 URL 编码</h4><h5 id="一般字符"><a href="#一般字符" class="headerlink" title="一般字符"></a>一般字符</h5><ul>
<li><p>URL 本身使用 ASCII 编码</p>
</li>
<li><p>URL 中如果出现中文，会先对中文UTF-8编码，再URL编码，最后再ASCII 编码</p>
<ol>
<li><strong>UTF-8 编码</strong>：将非 ASCII 字符（如中文）转换为 UTF-8 编码的字节序列。</li>
<li><strong>URL 编码</strong>：将每个字节转换为 <code>%</code> 加上两位十六进制数的形式。</li>
<li><strong>ASCII 编码</strong>：取二进制的 ASCII 值</li>
</ol>
</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219162430.png" alt="image.png|668"></p>
<p>这里 UTF-8 编码后的<code>e4bda0</code>本身就是十六进制的</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219171521.png" alt="image.png|868"></p>
<ul>
<li>这里传过来的 <code>url</code> 还是 <code>URL</code> 编码后的结果，只是数据传输底层是ASCI|二进制的结果</li>
</ul>
<h5 id="有歧义的字符"><a href="#有歧义的字符" class="headerlink" title="有歧义的字符"></a>有歧义的字符</h5><p><strong>歧义</strong>是指<code>&amp;</code>是分隔符，还是字符串</p>
<ul>
<li>作为分隔符，则不需要编码</li>
<li>作为字符串，则需要编码</li>
</ul>
<p>URL 编码使用 <code>%</code> 符号后跟<span style="color: #9c88ff; font-weight: 550;">两位十六进制数</span>来表示每个需要编码的字符</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219163037.png" alt="image.png|748"></p>
<p>这里 <code>&amp;</code> 的 ASCII 的值是取的十六进制的</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219164020.png" alt="image.png"></p>
<h5 id="浏览器的行为"><a href="#浏览器的行为" class="headerlink" title="浏览器的行为"></a>浏览器的行为</h5><p>当使用浏览器发送请求时，浏览器会自动对 URL 中的非 ASCII 字符进行 URL 编码。</p>
<p>例如，如果您在浏览器地址栏中输入 <code>https://example.com/你好</code>，浏览器会将其转换为 <code>https://example.com/%E4%BD%A0%E5%A5%BD</code>。</p>
<p>浏览器仅仅是对非 ASCII 字符进行 URL 编码，对于有歧义的字符，并没有进行 URL 编码，因为是否有歧义需要主观判断</p>
<h5 id="JS-提供的-URL编码方法"><a href="#JS-提供的-URL编码方法" class="headerlink" title="JS 提供的 URL编码方法"></a>JS 提供的 URL编码方法</h5><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219172018.png" alt="image.png|580"></p>
<ul>
<li>哪个字符需要编码，就使用<code>encodeURIComponent</code></li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">encodeURI</span></p>
<p><code>encodeURI</code> 通常用于对整个 URI 进行编码，确保 URI 中的特殊字符被正确编码，但不会编码 URI 中已经合法的字符（如 <code>/</code>, <code>?</code>, <code>#</code> 等），以保持 URI 的结构完整性。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219170013.png" alt="image.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="built_in">encodeURI</span>(<span class="string">&quot;https://example.com/path?name=张三&amp;age=18&quot;</span>));</span><br><span class="line"><span class="comment">// 输出: https://example.com/path?name=%E5%BC%A0%E4%B8%89&amp;age=18</span></span><br></pre></td></tr></table></figure>

<p>这里<code>&amp;</code>没有被编码，也符合这里对 <code>name</code> 和 <code>age</code> 分割的需求</p>
<p><span style="color: #badc58; font-weight: 550;">encodeURIComponent</span></p>
<p><code>encodeURIComponent</code> 通常用于对 URI 的某个组件（如查询参数、路径片段等）进行编码，确保该组件中的所有特殊字符都被正确编码，包括分隔符。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241219170053.png" alt="image.png"></p>
<p>如果 <code>msg</code> 中包含<code>&amp;</code>，这时需要对<code>&amp;</code>进行编码，以消除<code>&amp;</code>是分隔符还是字符串的歧义</p>
<ul>
<li>编码的就是字符串</li>
<li>没编码的就是分隔符</li>
</ul>
<p>可以使用<code>encodeURIComponent</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`https://example.com/path?msg=张三<span class="subst">$&#123;<span class="built_in">encodeURIComponent</span>(<span class="string">&quot;&amp;&quot;</span>)&#125;</span>Tom`</span>);</span><br><span class="line"><span class="comment">// 输出: https://example.com/path?msg=张三%26Tom</span></span><br></pre></td></tr></table></figure>

<h3 id="6-9-HTTP-响应状态码"><a href="#6-9-HTTP-响应状态码" class="headerlink" title="6.9 HTTP 响应状态码"></a>6.9 HTTP 响应状态码</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220092022.png" alt="image.png|538"></p>
<h4 id="6-9-1-1xx"><a href="#6-9-1-1xx" class="headerlink" title="6.9.1 1xx"></a>6.9.1 <code>1xx</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220092919.png" alt="image.png|560"></p>
<ul>
<li><strong>100</strong>：例如大文件上传，先发一个请求验证是否可以上传，可以的话再发一个请求用于上传</li>
<li><strong>101</strong>：用于切换协议的，比如切换到 websocket</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220092903.png" alt="image.png|612"></p>
<h4 id="6-9-2-2xx"><a href="#6-9-2-2xx" class="headerlink" title="6.9.2 2xx"></a>6.9.2 <code>2xx</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220094558.png" alt="image.png|754"></p>
<ul>
<li><strong>206</strong>：客户端请求资源的一部分，例如<strong>断点续传</strong>，<strong>播放视频</strong>的场景</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220101451.png" alt="image.png|735"></p>
<p><span style="color: #badc58; font-weight: 550;">使用数据流的方式读取文件</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用数据流的方式读取文件(推荐)</span></span><br><span class="line"><span class="keyword">const</span> rs = fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>); <span class="comment">// 创建可读流</span></span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">write</span>(chunk);</span><br><span class="line">&#125;);</span><br><span class="line">rs.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">end</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">可以使用管道操作代替上面的代码</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br></pre></td></tr></table></figure>

<h4 id="6-9-3-3xx"><a href="#6-9-3-3xx" class="headerlink" title="6.9.3 3xx"></a>6.9.3 <code>3xx</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220101643.png" alt="image.png|603"></p>
<p><span style="color: #badc58; font-weight: 550;">案例</span></p>
<p><code>http</code> 重定向到 <code>https</code></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220101958.png" alt="image.png|646"></p>
<p>拿到 <code>location</code>后浏览器接着会重新请求一次</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220102030.png" alt="image.png|847"></p>
<p><strong>301</strong>：会被客户端持久缓存，除非用户手动清除客户端缓存</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 域名改了，不再是之前的了</span></span><br><span class="line">res.<span class="title function_">writeHead</span>(<span class="number">301</span>, &#123;</span><br><span class="line">  <span class="comment">// 会被客户端持久缓存，除非用户手动清除客户端缓存</span></span><br><span class="line">  <span class="comment">// Location:&#x27;https://www.imooc.com&#x27;</span></span><br><span class="line">  <span class="title class_">Location</span>: <span class="string">&quot;https://www.baidu.com&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line">res.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure>

<p><strong>302</strong>：如果没有登录，就重定向到登录页面的场景</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接二进制</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 可以按需处理</span></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&quot;GET&quot;</span> &amp;&amp; (pathname === <span class="string">&quot;/&quot;</span> || pathname === <span class="string">&quot;/index.html&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 如果没有登录,就重定向到登录页面</span></span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">302</span>, &#123;</span><br><span class="line">        <span class="title class_">Location</span>: <span class="string">&quot;/login.html&quot;</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      res.<span class="title function_">end</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method === <span class="string">&quot;GET&quot;</span> &amp;&amp; pathname === <span class="string">&quot;/login.html&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 使用数据流的方式读取文件(推荐)</span></span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;login.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&quot;404&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9222端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9222</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9222 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220103640.png" alt="image.png"></p>
<h4 id="6-9-4-4xx"><a href="#6-9-4-4xx" class="headerlink" title="6.9.4 4xx"></a>6.9.4 <code>4xx</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220104028.png" alt="image.png|561"></p>
<p><strong>400</strong>：比如传的参数不对</p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通用的客户端错误，表示问题出在客户端，比如传的参数不对</span></span><br><span class="line"><span class="keyword">if</span> (!query.<span class="property">id</span>) &#123;</span><br><span class="line">  res.<span class="property">statusCode</span> = <span class="number">400</span>;</span><br><span class="line">  res.<span class="title function_">end</span>(</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">1001</span>, <span class="comment">// 这个code是人为规定, 可以用来指出具体什么错误</span></span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;未传入用户id&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>针对返回的 <code>msg</code> 乱码，可以给请求头添加<code>&quot;Content-Type&quot;</code>字段，标识编码的方法，这样客户端才能正确编码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置编码, 防止乱码</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json, charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>对于<code>html</code>，应该设置为如下代码，这样才能正确渲染 <code>html</code> 页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>对于 <code>css</code>, 应该设置为</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于CSS文件 </span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/css; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>403</strong>：权限问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假如id=1是超级管理员，你没有权限删除</span></span><br><span class="line"><span class="keyword">if</span> (query.<span class="property">id</span> == <span class="number">1</span>) &#123;</span><br><span class="line">  <span class="comment">// 服务器知道客户端的身份，但是没有相关权限</span></span><br><span class="line">  res.<span class="property">statusCode</span> = <span class="number">403</span>;</span><br><span class="line">  res.<span class="title function_">end</span>(</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">1002</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;您没有权限删除超级管理员&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>404</strong>：服务器请求不到资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取文件状态，可用于判断文件是否存在</span></span><br><span class="line">fs.<span class="title function_">stat</span>(<span class="string">`.<span class="subst">$&#123;pathname&#125;</span>`</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 文件不存在</span></span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./404.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">200</span>;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">`.<span class="subst">$&#123;pathname&#125;</span>`</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>405</strong>：不需要使用 GET 方法登录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pathname === <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (method === <span class="string">&quot;GET&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过Alow首部字段告诉客户端可以访问的请求方式</span></span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">405</span>, &#123; <span class="title class_">Allow</span>: <span class="string">&quot;POST&quot;</span> &#125;);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">code</span>: <span class="number">405</span>, <span class="attr">msg</span>: <span class="string">&quot;不允许使用GET请求&quot;</span> &#125;));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-9-5-5xx"><a href="#6-9-5-5xx" class="headerlink" title="6.9.5 5xx"></a>6.9.5 <code>5xx</code></h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220111926.png" alt="image.png|631"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220112631.png" alt="image.png|632"></p>
<p><strong>500</strong>：服务器遇到了不知道如何处理的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;数据库错误&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  res.<span class="property">statusCode</span> = <span class="number">500</span>;</span><br><span class="line">  res.<span class="title function_">end</span>(</span><br><span class="line">    <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">      <span class="comment">//一般不需要把问题说的太清楚</span></span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&quot;500服务器内部错误&quot;</span>,</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>501</strong>：服务器无法处理该请求方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模拟支持的方法</span></span><br><span class="line"><span class="keyword">const</span> methods = [<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, <span class="string">&quot;HEAD&quot;</span>];</span><br><span class="line"><span class="comment">// 判断服务器是否能够处理该方法</span></span><br><span class="line"><span class="keyword">if</span> (!methods.<span class="title function_">includes</span>(method)) &#123;</span><br><span class="line">  res.<span class="property">statusCode</span> = <span class="number">501</span>;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json,charset=utf-8&quot;</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">code</span>: <span class="number">501</span>, <span class="attr">message</span>: <span class="string">&quot;不支持该请求方法&quot;</span> &#125;));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-10-代理服务器和-VPN"><a href="#6-10-代理服务器和-VPN" class="headerlink" title="6.10 代理服务器和 VPN"></a>6.10 代理服务器和 VPN</h3><blockquote>
<p>代理服务器是一种位于客户端和目标服务器之间的中间服务器，它接收来自客户端的请求，并将这些请求转发给目标服务器，然后将目标服务器的响应返回给客户端。</p>
</blockquote>
<ul>
<li>处于客户端和目标服务器之间，转发上下游的请求和响应</li>
<li>分为正向代理和反向代理</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220142001.png" alt="image.png"></p>
<h4 id="6-10-1-正向代理"><a href="#6-10-1-正向代理" class="headerlink" title="6.10.1 正向代理"></a>6.10.1 正向代理</h4><p>正向代理代理的对象是客户端</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220142135.png" alt="image.png"></p>
<ul>
<li><strong>作用</strong>：突破访问限制、隐藏客户端身份、过滤内容等</li>
<li><strong>场景</strong>：企业内部员工通过公司代理服务器访问互联网。</li>
</ul>
<h4 id="6-10-2-反向代理"><a href="#6-10-2-反向代理" class="headerlink" title="6.10.2 反向代理"></a>6.10.2 反向代理</h4><p>反向代理代理的对象是服务端</p>
<ul>
<li>比如可以用来作<strong>负载均衡</strong>：哪个服务器比较空闲，就请求哪一台服务器处理</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220142207.png" alt="image.png"></p>
<ul>
<li><strong>作用</strong>：负载均衡、隐藏服务器身份等。</li>
<li><strong>场景</strong>：Web应用使用Nginx作为反向代理来分发请求到多个应用服务器。</li>
</ul>
<h4 id="6-10-3-代码实现"><a href="#6-10-3-代码实现" class="headerlink" title="6.10.3 代码实现"></a>6.10.3 代码实现</h4><p><span style="color: #badc58; font-weight: 550;">代理服务器</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建代理服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;有新的HTTP请求&quot;</span>);</span><br><span class="line">  <span class="comment">// 接收到源客户端的请求后，向目标服务器发送新的请求;</span></span><br><span class="line">  http</span><br><span class="line">    .<span class="title function_">request</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">host</span>: req.<span class="property">headers</span>.<span class="property">host</span>, <span class="comment">// 源请求的域名</span></span><br><span class="line">        <span class="attr">path</span>: req.<span class="property">url</span>, <span class="comment">// 源请求的请求路径</span></span><br><span class="line">        <span class="attr">method</span>: req.<span class="property">method</span>, <span class="comment">// 源请求的请求方法</span></span><br><span class="line">        <span class="comment">// 可以根据需要添加头信息</span></span><br><span class="line">        <span class="attr">headers</span>: &#123;</span><br><span class="line">          ...req.<span class="property">headers</span>,</span><br><span class="line">          <span class="attr">referer</span>: <span class="string">&quot;https://www.bilibili.com&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 接收到目标服务器的响应后，将响应数据发送给源客户端</span></span><br><span class="line">        res.<span class="title function_">writeHead</span>(response.<span class="property">statusCode</span>, response.<span class="property">headers</span>);</span><br><span class="line">        <span class="comment">// 将目标服务器的响应数据发送给源客户端 response.pipe(res)是指response写入到res里</span></span><br><span class="line">        response.<span class="title function_">pipe</span>(res); <span class="comment">/// 这里res是向客户端发送数据, response是从目标服务器接收的数据</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">目标服务器</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建静态服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接二进制</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./404.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9333端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9333</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9333 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要将本机代理设置为上面的代理服务器的端口</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220145224.png" alt="image.png|338"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220145250.png" alt="image.png|595"></p>
<h4 id="6-10-4-VPN"><a href="#6-10-4-VPN" class="headerlink" title="6.10.4 VPN"></a>6.10.4 VPN</h4><ul>
<li>虚拟私人网络<strong>Vi</strong>rtual <strong>P</strong>rivate <strong>N</strong>etwork</li>
<li>在公共网络上建立专用网络，加密通信</li>
<li>因为是加密通信，其他人无法知道通信内容，故常用来躲避监管</li>
<li>一般需要专门的VPN软件来完成通信</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220152434.png" alt="image.png"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220152548.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">VPN 的作用</span></p>
<ul>
<li>提高上网安全</li>
<li>隐藏用户身份 -&gt; 因为中间有代理</li>
<li>突破访问限制</li>
<li>…..</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">VPN 和代理服务器的对比</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220152903.png" alt="image.png"></p>
<h3 id="6-11-HTTP-首部字段"><a href="#6-11-HTTP-首部字段" class="headerlink" title="6.11 HTTP 首部字段"></a>6.11 HTTP 首部字段</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220153255.png" alt="image.png"></p>
<ul>
<li><p><strong>请求首部字段</strong>：附加了请求的额外信息：客户端身份信息、期待获取的资源信息等<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221100236.png"></p>
</li>
<li><p><strong>响应首部字段</strong>：附加了响应的额外信息：服务器的身份信息、客户端该如何处理内容等<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221100255.png" alt="image.png"></p>
</li>
<li><p><strong>通用首部字段</strong><br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221100330.png" alt="image.png"></p>
</li>
</ul>
<h4 id="6-11-1-Host"><a href="#6-11-1-Host" class="headerlink" title="6.11.1 Host"></a>6.11.1 Host</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220155809.png" alt="image.png|718"></p>
<h5 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h5><ul>
<li><strong>客户端请求</strong>：客户端在发送HTTP请求时，会在请求头中包含一个<code>Host</code>字段，明确指定请求的目标站点。</li>
<li><strong>服务器处理</strong>：Web服务器接收到请求后，通过解析<code>Host</code>字段来确定请求的目标站点，并将请求路由到相应的网站。</li>
</ul>
<h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><p>假设有一个Web服务器，其IP地址为<code>192.168.1.1</code>，上面托管了两个网站：<code>example.com</code>和<code>test.com</code>。</p>
<p><span style="color: #badc58; font-weight: 550;">1、DNS解析</span></p>
<ul>
<li><strong>客户端发起DNS查询</strong>：<ul>
<li>当用户在浏览器中输入 <code>http://example.com</code> 或直接访问 <code>example.com</code> 时，浏览器会向本地DNS解析器（通常是操作系统或路由器提供的）发送一个DNS查询请求。</li>
</ul>
</li>
<li><strong>DNS递归解析</strong>：<ul>
<li>本地DNS解析器如果缓存中有 <code>example.com</code> 的记录，则直接返回结果；否则，它会向根DNS服务器、顶级域名（TLD）服务器以及权威DNS服务器逐级查询，直到找到 <code>example.com</code> 对应的IP地址。</li>
</ul>
</li>
<li><strong>DNS响应</strong>：<ul>
<li>权威DNS服务器返回 <code>example.com</code> 的A记录，指示该域名对应的IP地址是 <code>192.168.1.1</code>。</li>
<li>本地DNS解析器将这个IP地址缓存一段时间（根据TTL设置），并返回给客户端。</li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">2、客户端请求</span></p>
<ul>
<li><strong>建立TCP连接</strong>：<ul>
<li>客户端使用DNS解析得到的IP地址 <code>192.168.1.1</code> 和默认HTTP端口80（或HTTPS端口443）建立TCP连接。</li>
<li>如果URL中指定了端口号（如 <code>example.com:8080</code>），则使用该端口号。</li>
</ul>
</li>
<li><strong>发送HTTP请求</strong>：<ul>
<li>连接建立后，客户端发送HTTP请求到服务器。</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /index.html HTTP/1.1</span><br><span class="line">Host: example.com</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">3、服务器响应</span></p>
<ol>
<li><strong>接收请求并解析<code>Host</code>字段</strong>：<ul>
<li>Web服务器接收到请求后，首先解析HTTP请求头中的<code>Host</code>字段，发现目标站点是<code>example.com</code>。</li>
</ul>
</li>
<li><strong>路由到对应网站目录</strong>：<ul>
<li>根据虚拟主机配置，服务器确定 <code>example.com</code> 对应的网站目录是 <code>/var/www/example.com</code>。</li>
</ul>
</li>
<li><strong>读取文件并生成响应</strong>：<ul>
<li>服务器从 <code>/var/www/example.com</code> 目录中读取 <code>index.html</code> 文件，并将其内容构建成HTTP响应。</li>
</ul>
</li>
<li><strong>发送响应给客户端</strong>：<ul>
<li>服务器将生成的HTTP响应发送回客户端。</li>
</ul>
</li>
</ol>
<h5 id="Nginx-配置"><a href="#Nginx-配置" class="headerlink" title="Nginx 配置"></a>Nginx 配置</h5><ul>
<li><strong>Nginx 不仅仅是虚拟主机配置工具</strong>：虽然虚拟主机配置是Nginx的重要功能之一，但它还提供了反向代理、负载均衡、缓存、SSL终止等多种强大的功能。</li>
<li><strong>虚拟主机配置</strong>：Nginx支持基于名称和基于IP的虚拟主机配置，允许在同一台服务器上托管多个网站。</li>
</ul>
<p>在Nginx服务器中，也可以通过类似的配置来实现多域名共享同一个IP地址。以下是一个简单的示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name example.<span class="property">com</span>;</span><br><span class="line">    root /<span class="keyword">var</span>/www/example.<span class="property">com</span>;</span><br><span class="line">    index index.<span class="property">html</span>;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen <span class="number">80</span>;</span><br><span class="line">    server_name test.<span class="property">com</span>;</span><br><span class="line">    root /<span class="keyword">var</span>/www/test.<span class="property">com</span>;</span><br><span class="line">    index index.<span class="property">html</span>;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =<span class="number">404</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="代码案例"><a href="#代码案例" class="headerlink" title="代码案例"></a>代码案例</h5><p><span style="color: #badc58; font-weight: 550;">网站A</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;我是网站A&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9001端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9001</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9001 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">网站B</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/plain;charset=utf-8&quot;</span>);</span><br><span class="line">  res.<span class="title function_">end</span>(<span class="string">&quot;我是网站B&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9002端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9002</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9002 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动上述服务，只能通过<code>127.0.0.1:9001</code>或<code>127.0.0.1:9002</code>访问</p>
<p>需对本地 hosts 进行配置</p>
<p><span style="color: #badc58; font-weight: 550;">本地 hosts 配置</span></p>
<p>管理员模式运行<strong>记事本</strong>，打开如下目录中的 <code>hosts</code> 文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\System32\drivers\etc</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220161718.png" alt="image.png|702"></p>
<p>添加如下映射，当本地访问<code>www.a.com</code>或<code>www.b.com</code>，会将其解析为<code>127.0.0.1</code>，然后保存即可</p>
<ul>
<li><span style="color: #9c88ff; font-weight: 550;">多个域名可以映射到一个 IP 上</span></li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220161927.png" alt="image.png|639"></p>
<p>这样就可以通过<code>www.a.com:9001</code>和<code>www.b.com:9002</code>分别访问网站 A 和 B</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220162759.png" alt="image.png"></p>
<p>但是此时还得加上端口，故需要添加一个代理服务器，将<code>www.a.com</code> 和 <code>127.0.01:9001</code>建立映射</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 去C:\Windows\System32\drivers\etc/hosts配置一下</span></span><br><span class="line"><span class="comment">// 创建一个映射关系</span></span><br><span class="line"><span class="keyword">const</span> hosts = &#123;</span><br><span class="line">  <span class="string">&quot;www.a.com&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9001</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;www.b.com&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9002</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">代理服务器</span></p>
<p>接收到源客户端的请求后, 拿到映射后的<code>127.0.01:9001</code>发送新的请求给指定服务器进程</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建代理服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 去C:\Windows\System32\drivers\etc/hosts配置一下</span></span><br><span class="line"><span class="comment">// 创建一个映射关系</span></span><br><span class="line"><span class="keyword">const</span> hosts = &#123;</span><br><span class="line">  <span class="string">&quot;www.a.com&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9001</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;www.b.com&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9002</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取host字段</span></span><br><span class="line">  <span class="keyword">const</span> host = hosts[req.<span class="property">headers</span>.<span class="property">host</span>];</span><br><span class="line">  <span class="keyword">if</span> (!host) &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">404</span>);</span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&quot;Host Not Found&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 接收到源客户端的请求后, 发送新的请求给指定服务器进程</span></span><br><span class="line">  http</span><br><span class="line">    .<span class="title function_">request</span>(</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">host</span>: host.<span class="property">hostname</span>,</span><br><span class="line">        <span class="attr">port</span>: host.<span class="property">port</span>,</span><br><span class="line">        <span class="attr">method</span>: req.<span class="property">method</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 接收到目标服务器的响应后，将响应数据发送给源客户端</span></span><br><span class="line">        res.<span class="title function_">writeHead</span>(response.<span class="property">statusCode</span>, response.<span class="property">headers</span>);</span><br><span class="line">        <span class="comment">// 将目标服务器的响应数据发送给源客户端 response.pipe(res)是指response写入到res里</span></span><br><span class="line">        response.<span class="title function_">pipe</span>(res); <span class="comment">/// 这里res是向客户端发送数据, response是从目标服务器接收的数据</span></span><br><span class="line">      &#125;</span><br><span class="line">    )</span><br><span class="line">    .<span class="title function_">end</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的80端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:80 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样就可能直接访问<code>www.a.com</code>访问到网站了</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220165146.png" alt="image.png"></p>
<ul>
<li>HTTP 协议的默认端口是 80。这意味着当用户在浏览器中输入 URL 时，如果没有显式指定端口号，默认会使用 80 端口进行连接</li>
<li>而我们的代理服务器是跑在80端口的，这样当用户输入<code>www.a.com</code>，便会访问到代理服务器</li>
<li>然后代理服务器再根据请求头里的<code>host</code>字段选择对应的映射<code>127.0.0.1:9001</code>去访问目标服务器，最后再把结果返回给客户端</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220165434.png" alt="image.png|1037"></p>
<h4 id="6-11-2-Referer"><a href="#6-11-2-Referer" class="headerlink" title="6.11.2 Referer"></a>6.11.2 Referer</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220170659.png" alt="image.png|693"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220170609.png" alt="image.png"></p>
<h5 id="Referer-实现防盗链"><a href="#Referer-实现防盗链" class="headerlink" title="Referer 实现防盗链"></a>Referer 实现防盗链</h5><p><span style="color: #badc58; font-weight: 550;">自己的网站</span></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>自己的网站<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1:9000/01.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">本地服务</span></p>
<p>当请求<code>http://127.0.0.1:9000/01.jpg</code>时，判断其请求头内<code>referer</code>字段是否在白名单里即可</p>
<ul>
<li>因为<code>referer</code>代表这个请求是从哪里链接过来的</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建静态服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单</span></span><br><span class="line"><span class="keyword">const</span> allowList = [<span class="string">&quot;http://127.0.0.1:9000/&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接二进制</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(pathname);</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./me.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/01.jpg&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 在白名单中，允许访问图片</span></span><br><span class="line">      <span class="keyword">if</span> (allowList.<span class="title function_">includes</span>(req.<span class="property">headers</span>.<span class="property">referer</span>)) &#123;</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./01.jpg&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 不在白名单中，不允许访问图片</span></span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">403</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;不允许访问图片&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220173032.png" alt="image.png"></p>
<p>使用 <code>live-server</code>插件打开如下<code>html</code>，会发现无法访问图片</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>他人的网站<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1:9000/01.jpg&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为他是从<code>http://127.0.0.1:5500/</code>链接过来的，不在防盗链白名单内</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220173406.png" alt="image.png|565"></p>
<h4 id="6-11-3-Location"><a href="#6-11-3-Location" class="headerlink" title="6.11.3 Location"></a>6.11.3 Location</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220174223.png" alt="image.png|769"></p>
<h4 id="6-11-4-Conten-Disposition"><a href="#6-11-4-Conten-Disposition" class="headerlink" title="6.11.4 Conten-Disposition"></a>6.11.4 Conten-Disposition</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220174512.png" alt="image.png|600"></p>
<h4 id="6-11-5-实现图片下载功能"><a href="#6-11-5-实现图片下载功能" class="headerlink" title="6.11.5 实现图片下载功能"></a>6.11.5 实现图片下载功能</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://127.0.0.1:9000/01.jpg&quot;</span>&gt;</span>图片下载<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">本地服务</span></p>
<p><code>res.setHeader(&quot;Content-Disposition&quot;, &quot;attachment;filename=01.jpg&quot;);</code></p>
<ul>
<li>响应内容作为附件的形式下载, 这里的<code>filename</code>是下载时的文件名</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建静态服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 拼接二进制</span></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/01.jpg&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 默认值inline, 响应内容作为页面的一部分展示</span></span><br><span class="line">      <span class="comment">// res.setHeader(&quot;Content-Disposition&quot;, &quot;inline&quot;);</span></span><br><span class="line">      <span class="comment">// 响应内容作为附件的形式下载, 这里的filename是下载时的文件名</span></span><br><span class="line">      res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=01.jpg&quot;</span>);</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./01.jpg&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">结果如下：</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-12-20-18-00-35.gif" alt="2024-12-20-18-00-35.gif"></p>
<p><span style="color: #badc58; font-weight: 550;">首部格式如下：</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220180230.png" alt="image.png|818"></p>
<h4 id="6-11-6-Allow"><a href="#6-11-6-Allow" class="headerlink" title="6.11.6 Allow"></a>6.11.6 Allow</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220180353.png" alt="image.png|856"></p>
<h4 id="6-11-7-User-Agent"><a href="#6-11-7-User-Agent" class="headerlink" title="6.11.7 User-Agent"></a>6.11.7 User-Agent</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220191011.png" alt="image.png|650"></p>
<ul>
<li>可以用来统计<strong>访问网站的客户端</strong></li>
<li>可以判断发送请求的是<strong>PC端还是移动端</strong>，从而响应不同的内容</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220191244.png" alt="image.png|530"></p>
<h5 id="移动端-、PC-端显示不同页面"><a href="#移动端-、PC-端显示不同页面" class="headerlink" title="移动端 、PC 端显示不同页面"></a>移动端 、PC 端显示不同页面</h5><p><span style="color: #badc58; font-weight: 550;">两个页面放一个服务器上</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是移动端</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isMobile</span> = (<span class="params">req</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ua = req.<span class="property">headers</span>[<span class="string">&quot;user-agent&quot;</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android|IPhone|Mobile/i</span>.<span class="title function_">test</span>(ua); <span class="comment">// 正则表达式判断ua是否包含Android或者IPhone或者mobile</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isMobile</span>(req)) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./mobile.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./pc.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">两个页面分两个站点</span></p>
<p>通过 <code>location</code> 重定向即可</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断是否是移动端</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">isMobile</span> = (<span class="params">req</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> ua = req.<span class="property">headers</span>[<span class="string">&quot;user-agent&quot;</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="regexp">/Android|IPhone|Mobile/i</span>.<span class="title function_">test</span>(ua); <span class="comment">// 正则表达式判断ua是否包含Android或者IPhone或者mobile</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isMobile</span>(req)) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./mobile.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    res.<span class="title function_">writeHead</span>(<span class="number">302</span>, &#123; <span class="title class_">Location</span>: <span class="string">&quot;http://127.0.0.1:9002&quot;</span> &#125;); <span class="comment">// 重定向</span></span><br><span class="line">    res.<span class="title function_">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9001端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9001</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9001 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220193255.png" alt="image.png|765"></p>
<h4 id="6-11-8-连接管理"><a href="#6-11-8-连接管理" class="headerlink" title="6.11.8 连接管理"></a>6.11.8 连接管理</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220193624.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">Connection</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220194401.png" alt="image.png"></p>
<ul>
<li>**<code>Connection: keep-alive</code>**：<ul>
<li><strong>一次TCP连接，多次请求和响应</strong>：使用 <code>keep-alive</code> 时，客户端和服务器之间的TCP连接在完成一次请求/响应后不会立即关闭。这个连接可以被复用，用于后续的多个HTTP请求和响应。这种方式减少了每次请求都需要重新建立TCP连接的时间开销，提高了性能，尤其是在需要发送多个请求的情况下。</li>
</ul>
</li>
<li>**<code>Connection: close</code>**：<ul>
<li><strong>一次TCP连接，一次请求和响应</strong>：使用 <code>close</code> 时，客户端和服务器之间的TCP连接在完成一次请求/响应后会立即关闭。下次再有新的HTTP请求时，需要重新建立一个新的TCP连接。这种方式适用于单次请求场景或需要及时释放资源的情况。</li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">TCP 连接次数的限制</span></p>
<ul>
<li><strong>现代浏览器</strong>：大多数现代浏览器对单个域名的并发TCP连接数有默认限制。例如：<ul>
<li>Chrome、Firefox 和 Safari 等浏览器通常允许每个域名最多6到10个并发TCP连接。</li>
<li>如果超过这个数量，额外的请求会被排队，直到有空闲的连接可用。</li>
</ul>
</li>
<li><strong>操作系统限制</strong>：操作系统本身也对可以建立的最大TCP连接数有限制。这通常由系统资源（如文件描述符）和内核参数决定。<ul>
<li>在Linux中，可以通过调整<code>/proc/sys/net/core/somaxconn</code>来设置监听队列的最大长度。</li>
<li>同时，每个进程可打开的最大文件描述符数量（<code>ulimit -n</code>）也会影响最大TCP连接数</li>
</ul>
</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">Keep-Alive</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241220194742.png" alt="image.png|647"></p>
<h4 id="6-11-9-Content-Length"><a href="#6-11-9-Content-Length" class="headerlink" title="6.11.9 Content-Length"></a>6.11.9 Content-Length</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221082251.png" alt="image.png|855"></p>
<ul>
<li>**使用<code>Buffer.byteLength</code>**：<code>resData.length</code>返回的是<span style="color: #9c88ff; font-weight: 550;">字符串中的字符数，而不是字节数</span>。对于包含多字节字符的字符串，应该使用<code>Buffer.byteLength(postData)</code>来计算字节数。</li>
<li><strong>避免不正确的长度设置</strong>：<ul>
<li>如果<code>Content-Length</code>设置得比实际内容少，接收方只会接收到部分内容。</li>
<li>如果<code>Content-Length</code>设置得比实际内容多，接收方会等待接收剩余的数据，这可能<span style="color: #9c88ff; font-weight: 550;">导致请求挂起或超时</span>。</li>
</ul>
</li>
</ul>
<h4 id="6-11-10-Transfer-Encoding"><a href="#6-11-10-Transfer-Encoding" class="headerlink" title="6.11.10 Transfer-Encoding"></a>6.11.10 Transfer-Encoding</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221083415.png" alt="image.png|816"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221083735.png" alt="image.png|805"></p>
<p>只有能确定主体的全部长度，才可以使用<code>Content-Length</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Content-Length</span></span><br><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;index.html&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">end</span>(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>如果无法确定主体的全部长度，可以使用<code>Transfer-Encoding:chunked</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// chunked</span></span><br><span class="line">fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221084353.png" alt="image.png"></p>
<h4 id="6-11-11-内容协商"><a href="#6-11-11-内容协商" class="headerlink" title="6.11.11 内容协商"></a>6.11.11 内容协商</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221084609.png" alt="image.png|752"></p>
<h4 id="6-11-12-Content-Type"><a href="#6-11-12-Content-Type" class="headerlink" title="6.11.12 Content-Type"></a>6.11.12 Content-Type</h4><h5 id="作为响应首部字段"><a href="#作为响应首部字段" class="headerlink" title="作为响应首部字段"></a>作为响应首部字段</h5><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221084847.png" alt="image.png|611"></p>
<p>针对返回的 <code>msg</code> 中文乱码，可以给请求头添加<code>&quot;Content-Type&quot;</code>字段，标识编码的方法，这样客户端才能正确编码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置编码, 防止乱码</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json, charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>对于<code>html</code>，应该设置为如下代码，这样才能正确渲染 <code>html</code> 页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>对于 <code>css</code>, 应该设置为，这样才能正确解析 <code>CSS</code>，而不是当成文本直接显示在网页上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对于CSS文件 </span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/css; charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<h5 id="作为请求首部字段"><a href="#作为请求首部字段" class="headerlink" title="作为请求首部字段"></a>作为请求首部字段</h5><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221085955.png" alt="image.png|784"></p>
<h4 id="6-11-13-媒体类型"><a href="#6-11-13-媒体类型" class="headerlink" title="6.11.13 媒体类型"></a>6.11.13 媒体类型</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221085428.png" alt="image.png|932"></p>
<p>详情见：<a target="_blank" rel="noopener" href="https://www.iana.org/assignments/media-types/media-types.xhtml">Media Types</a></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析如下格式的数据, query参数的格式也是这样的</span></span><br><span class="line"><span class="comment">// username=Alex&amp;age=18 -&gt; (username:&#x27;Alex&#x27;, age:18&#125;</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&quot;querystring&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这个解析的是url上的query参数</span></span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册页</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/reg.html&quot;</span>) &#123;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./reg.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 登录页</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/login.html&quot;</span>) &#123;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./login.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册接口</span></span><br><span class="line">    <span class="keyword">if</span> (pathname === <span class="string">&quot;/reg&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> contentType = req.<span class="property">headers</span>[<span class="string">&quot;content-type&quot;</span>];</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(contentType);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据content-type决定如何处理</span></span><br><span class="line">      <span class="keyword">if</span> (contentType === <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 这个解析的请求体携带的query参数格式的数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>, querystring.<span class="title function_">parse</span>(req.<span class="property">body</span>)); <span class="comment">// username=Alex&amp;age=18 -&gt; (username:&#x27;Alex&#x27;, age:18&#125;</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (contentType === <span class="string">&quot;application/json&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// 解析JSON格式的数据</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">body</span>, <span class="title class_">JSON</span>.<span class="title function_">parse</span>(req.<span class="property">body</span>));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* 将数据写入数据库, 完成注册 */</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 方式1：重定向自动实现跳转</span></span><br><span class="line">      <span class="comment">// res.statusCode = 302</span></span><br><span class="line">      <span class="comment">// res.setHeader(&quot;Location&quot;, &quot;/login.html&quot;)</span></span><br><span class="line">      <span class="comment">// res.end()</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 方式2：用户手动点击实现跳转</span></span><br><span class="line">      res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">      res.<span class="title function_">end</span>(<span class="string">&#x27;注册成功, 请登录&lt;a href=&quot;/login.html&quot;&gt;登录&lt;/a&gt;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-11-14-内容压缩"><a href="#6-11-14-内容压缩" class="headerlink" title="6.11.14 内容压缩"></a>6.11.14 内容压缩</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221094541.png" alt="image.png|921"></p>
<p><span style="color: #badc58; font-weight: 550;">server</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="comment">// 用来做gzip,deflate或br压缩和解压缩</span></span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&quot;zlib&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析如query参数格式的数据</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&quot;querystring&quot;</span>); <span class="comment">// username=Alex&amp;age=18 -&gt; (username:&#x27;Alex&#x27;, age:18&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 这个解析的是url上的query参数</span></span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> results = [];</span><br><span class="line">  <span class="comment">// 数据流接收</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">    results.<span class="title function_">push</span>(chunk);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 数据接收完毕</span></span><br><span class="line">  req.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    req.<span class="property">body</span> = <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results).<span class="title function_">toString</span>(); <span class="comment">// 把数据存储在req.body中</span></span><br><span class="line">    <span class="keyword">const</span> acceptEncoding = req.<span class="property">headers</span>[<span class="string">&quot;accept-encoding&quot;</span>];</span><br><span class="line">    <span class="keyword">if</span> (acceptEncoding.<span class="title function_">includes</span>(<span class="string">&quot;gzip&quot;</span>)) &#123;</span><br><span class="line">      res.<span class="title function_">writeHead</span>(<span class="number">200</span>, &#123; <span class="string">&quot;Content-Encoding&quot;</span>: <span class="string">&quot;gzip&quot;</span> &#125;);</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(zlib.<span class="title function_">createGzip</span>()).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (acceptEncoding.<span class="title function_">includes</span>(<span class="string">&quot;deflate&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 使用deflate压缩算法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (acceptEncoding.<span class="title function_">includes</span>(<span class="string">&quot;br&quot;</span>)) &#123;</span><br><span class="line">      <span class="comment">// 使用br压缩算法</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 不压缩</span></span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221100008.png"></p>
<p><span style="color: #badc58; font-weight: 550;">client</span></p>
<p>客户端如何解压缩的逻辑</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用来做gzip,deflate或br压缩和解压缩</span></span><br><span class="line"><span class="keyword">const</span> zlib = <span class="built_in">require</span>(<span class="string">&quot;zlib&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向127.0.0.1:9222 发送HTTP请求</span></span><br><span class="line"><span class="keyword">const</span> req = <span class="title function_">request</span>(</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&quot;accept-encoding&quot;</span>: <span class="string">&quot;gzip, deflate, br&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (res.<span class="property">headers</span>[<span class="string">&quot;content-encoding&quot;</span>] === <span class="string">&quot;gzip&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 输出gzip解压缩后的内容到终端</span></span><br><span class="line">      res.<span class="title function_">pipe</span>(zlib.<span class="title function_">createGunzip</span>()).<span class="title function_">pipe</span>(process.<span class="property">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求结束</span></span><br><span class="line">req.<span class="title function_">end</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-12-文件上传"><a href="#6-12-文件上传" class="headerlink" title="6.12 文件上传"></a>6.12 文件上传</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221102143.png" alt="image.png|649"></p>
<h4 id="6-12-1-multipart-form-data"><a href="#6-12-1-multipart-form-data" class="headerlink" title="6.12.1 multipart/form-data"></a>6.12.1 multipart/form-data</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221110637.png" alt="image.png|522"></p>
<ol>
<li><strong>确定边界分隔符</strong>：<code>multipart/form-data</code> 请求体中的每个部分由一个唯一的边界分隔符分隔。边界分隔符通常在请求头中指定，例如：<br>   <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221102940.png" alt="image.png|643"></li>
<li><strong>计算每个部分的字节长度</strong>：<ul>
<li><strong>边界分隔符</strong>：每个部分的开头和结尾都需要边界分隔符，格式为 <code>--boundary</code>。</li>
<li><strong>内容描述头</strong>：每个部分的内容描述头，例如 <code>Content-Disposition</code> 和 <code>Content-Type</code>。</li>
<li><strong>内容数据</strong>：实际的数据内容，需要计算其字节长度。</li>
</ul>
</li>
<li><strong>使用 <code>Buffer.byteLength</code> 计算字节长度</strong>：对于包含多字节字符的数据，使用 <code>Buffer.byteLength</code> 来计算字节长度。</li>
<li><strong>添加结束边界</strong>：请求体的最后需要一个结束边界，格式为 <code>--boundary--</code>。</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221102538.png" alt="image.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> boundary = <span class="string">&#x27;------WebKitFormBoundary6kqoxnb4ddIph7pQ&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> part1 = <span class="string">`--<span class="subst">$&#123;boundary&#125;</span>\r\nContent-Disposition: form-data; name=&quot;username&quot;\r\n\r\nAlex\r\n`</span>;</span><br><span class="line"><span class="keyword">const</span> part2 = <span class="string">`--<span class="subst">$&#123;boundary&#125;</span>\r\nContent-Disposition: form-data; name=&quot;file&quot;; filename=&quot;reg.html&quot;\r\nContent-Type: text/html\r\n\r\n&lt;!DOCTYPE html&gt;\r\n&lt;html lang=&quot;en&quot;&gt;\r\n&lt;/html&gt;\r\n`</span>;</span><br><span class="line"><span class="keyword">const</span> endBoundary = <span class="string">`--<span class="subst">$&#123;boundary&#125;</span>--\r\n`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> postData = part1 + part2 + endBoundary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> contentLength = <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(postData);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Content-Length:&#x27;</span>, contentLength);</span><br></pre></td></tr></table></figure>

<ul>
<li><code>part1</code> 是 <code>username</code> 字段的部分。</li>
<li><code>part2</code> 是 <code>file</code> 字段的部分，包含 <code>reg.html</code> 文件的内容。</li>
<li><code>endBoundary</code> 是请求体的结束边界。</li>
<li><code>postData</code> 是完整的请求体字符串。</li>
<li><code>contentLength</code> 是使用 <code>Buffer.byteLength</code> 计算的请求体的字节长度。</li>
</ul>
<h4 id="6-12-2-代码案例"><a href="#6-12-2-代码案例" class="headerlink" title="6.12.2 代码案例"></a>6.12.2 代码案例</h4><p>这里需要使用第三方库<code>busboy</code></p>
<blockquote>
<p><code>busboy</code> 是一个用于解析 <code>multipart/form-data</code> 请求的 Node.js 库。它主要用于处理文件上传和表单数据的解析。</p>
</blockquote>
<p><span style="color: #badc58; font-weight: 550;">整体结构</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221110319.png" alt="image.png"></p>
<ul>
<li><code>upload</code> 文件夹用于存放上传的文件</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">表单页</span></p>
<ul>
<li><code>enctype=&quot;multipart/form-data&quot;</code></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/reg&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">      用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      头像:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;注册&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">服务器</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 解析query参数格式的数据</span></span><br><span class="line"><span class="comment">// username=Alex&amp;age=18 -&gt; (username:&#x27;Alex&#x27;, age:18&#125;</span></span><br><span class="line"><span class="keyword">const</span> querystring = <span class="built_in">require</span>(<span class="string">&quot;querystring&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用于解析form-data格式的数据</span></span><br><span class="line"><span class="keyword">const</span> busboy = <span class="built_in">require</span>(<span class="string">&quot;busboy&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/reg.html&quot;</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./reg.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 注册接口</span></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/reg&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 保存上传的文件</span></span><br><span class="line">    <span class="keyword">const</span> results = [];</span><br><span class="line">    <span class="comment">// 保存文件以外的其他字段</span></span><br><span class="line">    <span class="keyword">const</span> fields = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 主要是从请求的headers中拿到Content-Type里的boundary字段</span></span><br><span class="line">    <span class="keyword">const</span> bb = <span class="title function_">busboy</span>(&#123; <span class="attr">headers</span>: req.<span class="property">headers</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每发现一个新文件触发一次</span></span><br><span class="line">    bb.<span class="title function_">on</span>(<span class="string">&quot;file&quot;</span>, <span class="function">(<span class="params">name, file, info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// name是表单字段名，file是文件流，info是文件信息</span></span><br><span class="line">      <span class="comment">// 方式1:二进制读取上传</span></span><br><span class="line">      file</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          results.<span class="title function_">push</span>(data);</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件读取完毕&quot;</span>);</span><br><span class="line">          <span class="comment">// 上传</span></span><br><span class="line">          fs.<span class="title function_">writeFile</span>(</span><br><span class="line">            <span class="string">`./upload/<span class="subst">$&#123;info.filename&#125;</span>`</span>,</span><br><span class="line">            <span class="title class_">Buffer</span>.<span class="title function_">concat</span>(results),</span><br><span class="line">            <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (err) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;文件写入成功&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">          );</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">      <span class="comment">// 方式2:把文件流保存到本地</span></span><br><span class="line">      <span class="comment">// file.pipe(fs.createWriteStream(`./upload/$&#123;info.filename&#125;`));</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 每发现一个新的字段触发一次</span></span><br><span class="line">    bb.<span class="title function_">on</span>(<span class="string">&quot;field&quot;</span>, <span class="function">(<span class="params">name, val, info</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// name是表单字段名，val是字段值，info是字段信息</span></span><br><span class="line">      fields[name] = val;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// form-data 数据解析完毕触发</span></span><br><span class="line">    bb.<span class="title function_">on</span>(<span class="string">&quot;close&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;form-data解析完毕&quot;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(fields);</span><br><span class="line">      res.<span class="title function_">end</span>();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将请求体数据提交给bb解析</span></span><br><span class="line">    req.<span class="title function_">pipe</span>(bb);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221110516.png" alt="image.png|525"></p>
<h3 id="6-13-断点续传"><a href="#6-13-断点续传" class="headerlink" title="6.13 断点续传"></a>6.13 断点续传</h3><h4 id="6-13-1-断点续传原理"><a href="#6-13-1-断点续传原理" class="headerlink" title="6.13.1 断点续传原理"></a>6.13.1 断点续传原理</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221110840.png" alt="image.png"></p>
<h4 id="6-13-2-涉及到的首部字段"><a href="#6-13-2-涉及到的首部字段" class="headerlink" title="6.13.2 涉及到的首部字段"></a>6.13.2 涉及到的首部字段</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221111017.png" alt="image.png"></p>
<ul>
<li>服务器响应状态码应设置为<code>206</code>，表示目前响应的是部分字节</li>
</ul>
<h4 id="6-13-3-代码实现"><a href="#6-13-3-代码实现" class="headerlink" title="6.13.3 代码实现"></a>6.13.3 代码实现</h4><p><span style="color: #badc58; font-weight: 550;">文件结构</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221113638.png" alt="image.png"></p>
<h2 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a><span style="color: #badc58; font-weight: 550;">客户端</span></h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> &#123; request &#125; = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> start = <span class="number">0</span>; <span class="comment">// 请求起始位置</span></span><br><span class="line"><span class="keyword">let</span> step = <span class="number">100</span>; <span class="comment">// 每次请求步长</span></span><br><span class="line"><span class="keyword">let</span> pause = <span class="literal">false</span>; <span class="comment">// 暂停标志</span></span><br><span class="line"><span class="keyword">let</span> total; <span class="comment">// 文件总长度(字节)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建可写流，将下载的文件内容保存到download/data.txt中</span></span><br><span class="line"><span class="keyword">const</span> ws = fs.<span class="title function_">createWriteStream</span>(<span class="string">&quot;download/data.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下载函数</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">download</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 请求资源</span></span><br><span class="line">  <span class="keyword">const</span> req = <span class="title function_">request</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">hostname</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">      <span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">      <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">      <span class="attr">path</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">      <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="attr">range</span>: <span class="string">`bytes=<span class="subst">$&#123;start&#125;</span>-<span class="subst">$&#123;start + step - <span class="number">1</span>&#125;</span>`</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// total还没有值</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> total !== <span class="string">&quot;number&quot;</span>) &#123;</span><br><span class="line">        <span class="comment">// content-range格式: 0-4/10</span></span><br><span class="line">        total = <span class="built_in">parseInt</span>(res.<span class="property">headers</span>[<span class="string">&quot;content-range&quot;</span>].<span class="title function_">split</span>(<span class="string">&quot;/&quot;</span>)[<span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 读取响应数据, 即要下载的数据</span></span><br><span class="line">      res.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">chunk</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 写入可写流, 将下载的文件内容写入download/data.txt</span></span><br><span class="line">        ws.<span class="title function_">write</span>(chunk);</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      res.<span class="title function_">on</span>(<span class="string">&quot;end&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 递归进行下一次请求</span></span><br><span class="line">        <span class="keyword">if</span> (!pause &amp;&amp; start &lt; total) &#123;</span><br><span class="line">          <span class="title function_">download</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (start &gt;= total) &#123;</span><br><span class="line">          <span class="comment">// 下载完成</span></span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;下载完成&quot;</span>);</span><br><span class="line">          <span class="comment">// 退出</span></span><br><span class="line">          process.<span class="title function_">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 维护下次的start值</span></span><br><span class="line">  start += step;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 请求结束</span></span><br><span class="line">  req.<span class="title function_">end</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听用户输入</span></span><br><span class="line">process.<span class="property">stdin</span>.<span class="title function_">on</span>(<span class="string">&quot;data&quot;</span>, <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 获取用户输入的指令</span></span><br><span class="line">  <span class="keyword">let</span> ins = data.<span class="title function_">toString</span>().<span class="title function_">trim</span>();</span><br><span class="line">  <span class="keyword">switch</span> (ins) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;s&quot;</span>:</span><br><span class="line">      pause = <span class="literal">false</span>;</span><br><span class="line">      <span class="title function_">download</span>();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;p&quot;</span>:</span><br><span class="line">      pause = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;输入有误&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">服务器</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 拿到请求中的rang字段</span></span><br><span class="line">  <span class="keyword">const</span> range = req.<span class="property">headers</span>[<span class="string">&quot;range&quot;</span>];</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(range); <span class="comment">// bytes=0-4</span></span><br><span class="line">	</span><br><span class="line">  <span class="comment">// 如果有这个字段，则分段下载</span></span><br><span class="line">  <span class="keyword">if</span> (range) &#123;</span><br><span class="line">    <span class="comment">// 范围请求</span></span><br><span class="line">    <span class="keyword">const</span> [start, end] = range.<span class="title function_">replace</span>(<span class="string">&quot;bytes=&quot;</span>, <span class="string">&quot;&quot;</span>).<span class="title function_">split</span>(<span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="comment">// 读取文件状态, 判断要下载的文件是否存在</span></span><br><span class="line">    fs.<span class="title function_">stat</span>(<span class="string">&quot;./data.txt&quot;</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 告诉客户端响应的是部分内容</span></span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">206</span>;</span><br><span class="line">      <span class="comment">// 设置相关响应头部</span></span><br><span class="line">      res.<span class="title function_">setHeader</span>(<span class="string">&quot;Accept-Ranges&quot;</span>, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">      res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Range&quot;</span>, <span class="string">`bytes <span class="subst">$&#123;start&#125;</span>-<span class="subst">$&#123;end&#125;</span>/<span class="subst">$&#123;stat.size&#125;</span>`</span>);</span><br><span class="line">      <span class="comment">// 将资源响应给客户端</span></span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./data.txt&quot;</span>, &#123;</span><br><span class="line">        <span class="attr">start</span>: <span class="built_in">parseInt</span>(start),</span><br><span class="line">        <span class="attr">end</span>: <span class="built_in">parseInt</span>(end),</span><br><span class="line">      &#125;).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 如果没有传递Range字段，服务器将会返回200OK,并返回完整的请求资源</span></span><br><span class="line">    res.<span class="property">statusCode</span> = <span class="number">200</span>;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./data.txt&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">实现效果</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/2024-12-21-11-41-30.gif" alt="2024-12-21-11-41-30.gif|742"></p>
<h3 id="6-14-视频播放"><a href="#6-14-视频播放" class="headerlink" title="6.14 视频播放"></a>6.14 视频播放</h3><h4 id="6-14-1-原理"><a href="#6-14-1-原理" class="headerlink" title="6.14.1 原理"></a>6.14.1 原理</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221141533.png" alt="image.png"></p>
<h4 id="6-14-2-涉及到的首部字段"><a href="#6-14-2-涉及到的首部字段" class="headerlink" title="6.14.2 涉及到的首部字段"></a>6.14.2 涉及到的首部字段</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221111017.png" alt="image.png"></p>
<ul>
<li>服务器响应状态码应设置为<code>206</code>，表示目前响应的是部分字节</li>
</ul>
<h4 id="6-14-3-代码案例"><a href="#6-14-3-代码案例" class="headerlink" title="6.14.3 代码案例"></a>6.14.3 代码案例</h4><p><span style="color: #badc58; font-weight: 550;">文件结构</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221144348.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">客户端</span></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">&quot;video&quot;</span> <span class="attr">controls</span> <span class="attr">muted</span> <span class="attr">width</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">&quot;/media/1.mp4&quot;</span> <span class="attr">type</span>=<span class="string">&quot;video/mp4&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">服务器</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(req.<span class="property">url</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 首页</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 视频接口</span></span><br><span class="line">  <span class="keyword">if</span> (req.<span class="property">url</span> === <span class="string">&quot;/media/1.mp4&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// 拿到请求中的rang字段</span></span><br><span class="line">    <span class="keyword">const</span> &#123; range &#125; = req.<span class="property">headers</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(range); <span class="comment">// eg: bytes=0-4</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置视频资源路径</span></span><br><span class="line">    <span class="keyword">const</span> path = <span class="string">&quot;./media/1.mp4&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存在range字段，返回范围请求的数据</span></span><br><span class="line">    <span class="keyword">if</span> (range) &#123;</span><br><span class="line">      <span class="keyword">let</span> [, start, end] = range.<span class="title function_">match</span>(<span class="regexp">/(\d*)-(\d*)/</span>);</span><br><span class="line">      <span class="comment">// 读取文件状态, 判断要下载的文件是否存在</span></span><br><span class="line">      fs.<span class="title function_">stat</span>(path, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">          res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">          res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 文件总字节数</span></span><br><span class="line">        <span class="keyword">const</span> total = stat.<span class="property">size</span>;</span><br><span class="line">        <span class="comment">// 处理请求头中范围参数不传的问题</span></span><br><span class="line">        start = start ? <span class="built_in">parseInt</span>(start) : <span class="number">0</span>;</span><br><span class="line">        end = end ? <span class="built_in">parseInt</span>(end) : total - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(start, end, total);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 告诉客户端响应的是部分内容</span></span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">206</span>;</span><br><span class="line">        <span class="comment">// 设置相关响应头部</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Accept-Ranges&quot;</span>, <span class="string">&quot;bytes&quot;</span>);</span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Range&quot;</span>, <span class="string">`bytes <span class="subst">$&#123;start&#125;</span>-<span class="subst">$&#123;end&#125;</span>/<span class="subst">$&#123;total&#125;</span>`</span>);</span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;video/mp4&quot;</span>);</span><br><span class="line">        <span class="comment">// 将资源响应给客户端</span></span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(path, &#123;</span><br><span class="line">          start,</span><br><span class="line">          end,</span><br><span class="line">        &#125;).<span class="title function_">pipe</span>(res);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 如果没有传递Range字段，服务器将会返回200,并返回完整的请求资源</span></span><br><span class="line">      res.<span class="property">statusCode</span> = <span class="number">200</span>;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(path).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">结果</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221144510.png" alt="image.png"></p>
<h3 id="6-15-单向散列函数"><a href="#6-15-单向散列函数" class="headerlink" title="6.15 单向散列函数"></a>6.15 单向散列函数</h3><blockquote>
<p>单向散列函数（One-way Hash Function），也被称为加密哈希函数，</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221144741.png" alt="image.png|733"></p>
<ul>
<li><strong>不可逆性</strong>：从输出的哈希值很难推算出输入的信息。</li>
<li><strong>定长输出</strong>：无论输入数据的长度如何，输出的哈希值长度是固定的。</li>
<li><strong>雪崩效应</strong>：输入信息的微小变化会导致输出的哈希值发生巨大变化。</li>
<li><strong>抗碰撞性</strong>：找到两个不同的输入产生相同输出哈希值在计算上是不可行的。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221145002.png" alt="image.png"></p>
<h4 id="6-15-1-使用散列函数加密密码"><a href="#6-15-1-使用散列函数加密密码" class="headerlink" title="6.15.1 使用散列函数加密密码"></a>6.15.1 使用散列函数加密密码</h4><p><code>&quot;hex&quot;</code>表示以16进制显示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用于创建hash函数</span></span><br><span class="line"><span class="keyword">const</span> &#123; createHash &#125; = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;md5:&quot;</span>, <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>).<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span>).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sha1:&quot;</span>, <span class="title function_">createHash</span>(<span class="string">&quot;sha1&quot;</span>).<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span>).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;sha256:&quot;</span>, <span class="title function_">createHash</span>(<span class="string">&quot;sha256&quot;</span>).<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span>).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>));</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">md5</span>: e10adc3949ba59abbe56e057f20f883e</span><br><span class="line"><span class="attr">sha1</span>: 7c4a8d09ca3762af61e59520943dc26494f8941b</span><br><span class="line"><span class="attr">sha256</span>: 8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92</span><br></pre></td></tr></table></figure>

<p><strong>密码明文</strong></p>
<ul>
<li>密码明文存储很危险，很多用户在各个网站的账号和密码都是一样的, 一个网站的数据库泄露，就会导致很严重的后果</li>
<li>用户注册时输入密码123456，经过加密后保存到数据库中</li>
<li>用户登录时输入密码123456，经过加密后和数据库中的密码比对</li>
</ul>
<p><strong>暴力破解</strong></p>
<ul>
<li>通过代码大量生成散列值, 将原始数据和散列值保存到数据库中<code>1-&gt;xxx, 2-&gt;yyy, 3-&gt;zzz, 123456-&gt;aaa</code></li>
<li>想要破解时, 通过散列值去数据库中查询, 查到了就破解成功, 查不到就破解失败</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">使用散列函数加盐加密密码</span></p>
<ul>
<li>加点盐，是指加点杂质进去</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> salt = <span class="string">&quot;qwemkgvfijrtplcmlkpw&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&quot;md5加盐:&quot;</span>,</span><br><span class="line">  <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">    .<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span> + salt)</span><br><span class="line">    .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">加盐+多次散列</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> res = <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">  .<span class="title function_">update</span>(<span class="string">&quot;123456&quot;</span> + salt)</span><br><span class="line">  .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> salt2 = <span class="string">&quot;uoinhcviowoonmkxc&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="string">&quot;md5加盐+多次散列:&quot;</span>,</span><br><span class="line">  <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">    .<span class="title function_">update</span>(res + salt)</span><br><span class="line">    .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="6-15-2-通过散列值判断文件内容是否发生了改变"><a href="#6-15-2-通过散列值判断文件内容是否发生了改变" class="headerlink" title="6.15.2 通过散列值判断文件内容是否发生了改变"></a>6.15.2 通过散列值判断文件内容是否发生了改变</h4><ul>
<li>对比index.css修改前和修改后的散列值判断文件是否发生了变化</li>
<li><strong>缺点</strong>：需要将文件内容一次性全部读取到内存中，不适合大文件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">readFile</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>).<span class="title function_">update</span>(data).<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">对于大文件</span></p>
<ul>
<li>不方便对全部内容计算散列值</li>
<li>可以用文件的大小、修改时间、开头、或某一段生成一个散列值判断文件内容是否发生了改变</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">stat</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, stats</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(stats.<span class="property">size</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 用文件修改时间和大小生成一个散列值判断文件内容是否发生了改变</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">    <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">      .<span class="title function_">update</span>(stats.<span class="property">mtime</span>.<span class="title function_">toString</span>() + stats.<span class="property">size</span>)</span><br><span class="line">      .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="6-16-HTTP-缓存"><a href="#6-16-HTTP-缓存" class="headerlink" title="6.16 HTTP 缓存"></a>6.16 HTTP 缓存</h3><blockquote>
<p>HTTP 缓存是提高Web应用程序性能和减少服务器负载的重要机制。通过合理配置HTTP缓存，可以显著提升用户体验并优化网络资源的使用。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221152352.png" alt="image.png|611"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221152457.png" alt="image.png|714"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221152606.png" alt="image.png|395"></p>
<h4 id="6-16-1-浏览器缓存策略"><a href="#6-16-1-浏览器缓存策略" class="headerlink" title="6.16.1 浏览器缓存策略"></a>6.16.1 浏览器缓存策略</h4><ul>
<li><strong>强制缓存</strong>：当<code>Cache-Control</code>或<code>Expires</code>指示资源未过期时，直接使用缓存，不发起新的请求。</li>
<li><strong>协商缓存</strong>：当缓存过期时，浏览器会发起请求但附带验证信息（如<code>If-None-Match</code>或<code>If-Modified-Since</code>）。如果资源未更改，则使用缓存；否则下载新资源。</li>
</ul>
<h5 id="缓存不存在"><a href="#缓存不存在" class="headerlink" title="缓存不存在"></a>缓存不存在</h5><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221152959.png" alt="image.png"></p>
<h5 id="缓存过期了"><a href="#缓存过期了" class="headerlink" title="缓存过期了"></a>缓存过期了</h5><p><span style="color: #badc58; font-weight: 550;">资源发生修改了</span></p>
<ul>
<li>修改了，则服务器再发一遍</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221153057.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">资源没发生修改</span></p>
<ul>
<li>没被修改，只是过期了，则服务器对其进行更新，延长使用时间</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221153309.png" alt="image.png"></p>
<h4 id="6-16-2-相关的首部字段"><a href="#6-16-2-相关的首部字段" class="headerlink" title="6.16.2 相关的首部字段"></a>6.16.2 相关的首部字段</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221153857.png" alt="image.png|826"></p>
<ul>
<li><strong>Cache-Control</strong>：定义了请求或响应的缓存机制。<ul>
<li><code>no-cache</code>：强制客户端在使用缓存前必须验证资源是否是最新的。</li>
<li><code>no-store</code>：禁止缓存任何内容。</li>
<li><code>max-age=&lt;seconds&gt;</code>：指定资源的最大新鲜度时间（以秒为单位）。</li>
<li><code>public</code>：允许中间代理缓存响应。</li>
<li><code>private</code>：仅允许浏览器缓存，不允许中间代理缓存。</li>
</ul>
</li>
<li><strong>Expires</strong>：指定一个过期日期或时间，之后缓存不再有效。已被<code>Cache-Control</code>取代，但在不支持<code>Cache-Control</code>的老式浏览器中仍然有用。</li>
<li><strong>Pragma</strong>：主要用于向后兼容HTTP/1.0中的<code>no-cache</code>指令。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221154120.png" alt="image.png|824"></p>
<ul>
<li><strong>Last-Modified</strong>：服务器提供资源最后修改的时间戳。<span style="color: #9c88ff; font-weight: 550;">这个时间戳最小单位是秒，针对毫秒级的修改处理不了</span></li>
<li><strong>ETag</strong>：服务器生成的一个唯一标识符，用于表示资源的特定版本。<span style="color: #9c88ff; font-weight: 550;">高精度，能够精确反映资源的任何微小变化（包括毫秒级）。</span></li>
<li><strong>If-Modified-Since</strong>：客户端发送此头部字段，包含上次接收到的<code>Last-Modified</code>时间戳。如果资源自那时起未被修改，服务器返回304状态码。</li>
<li><strong>If-None-Match</strong>：客户端发送此头部字段，包含从服务器接收到的ETag值。如果资源未更改，服务器返回304状态码（Not Modified），否则返回新资源。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221155513.png" alt="image.png|925"></p>
<h4 id="6-16-3-ETag"><a href="#6-16-3-ETag" class="headerlink" title="6.16.3 ETag"></a>6.16.3 ETag</h4><h5 id="工作原理-1"><a href="#工作原理-1" class="headerlink" title="工作原理"></a>工作原理</h5><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221160148.png" alt="image.png|698"></p>
<ol>
<li><p><strong>生成ETag</strong>：</p>
<ul>
<li><strong>基于内容的哈希值</strong>：服务器可以使用单向散列函数（如MD5、SHA-1等）对资源的二进制内容进行哈希计算，生成一个固定长度的字符串作为ETag。</li>
<li><strong>弱ETag</strong>：有时服务器会使用一些非内容敏感的信息（如文件名、时间戳等）来生成ETag，称为弱ETag。弱ETag以<code>W/</code>开头，表示它不是严格的内容标识。<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221160256.png" alt="image.png|562"></li>
</ul>
</li>
<li><p><strong>返回ETag</strong>：</p>
<ul>
<li>当客户端首次请求资源时，服务器在响应头中包含<code>ETag</code>字段，例如：<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221160110.png" alt="image.png"></li>
</ul>
</li>
<li><p><strong>验证ETag</strong>：</p>
<ul>
<li>客户端在后续请求中通过<code>If-None-Match</code>头部发送上次接收到的ETag值，例如：<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221160131.png" alt="image.png"></li>
<li>如果资源未更改，服务器返回<code>304 Not Modified</code>状态码，并且不会返回资源主体，从而节省带宽。</li>
<li>如果资源已更改，服务器返回新的资源和新的ETag值。</li>
</ul>
</li>
</ol>
<h5 id="ETag-和-Last-Modified"><a href="#ETag-和-Last-Modified" class="headerlink" title="ETag 和 Last-Modified"></a>ETag 和 Last-Modified</h5><ul>
<li><strong><code>Last-Modified</code></strong> 提供了简单的时间戳验证，但精度有限，适用于对时间敏感度要求不高的场景。</li>
<li><strong><code>ETag</code></strong> 提供了高精度的内容验证，适用于需要精确判断资源变化的场景。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221160407.png" alt="|722"></p>
<h4 id="6-16-4-代码案例"><a href="#6-16-4-代码案例" class="headerlink" title="6.16.4 代码案例"></a>6.16.4 代码案例</h4><p><span style="color: #badc58; font-weight: 550;">文档结构</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221162017.png" alt="image.png"></p>
<h5 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h5><p><span style="color: #badc58; font-weight: 550;">Cache-Control 配置的区别</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要求客户端缓存，但每次都需要发送请求到服务器验证缓存是否可用</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>); <span class="comment">// 需配合其他字段一起使用, 这样服务器才能够验证资源是否修改</span></span><br><span class="line"><span class="comment">// 要求客户端缓存，但有时间限制</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=5&quot;</span>);</span><br><span class="line"><span class="comment">// 要求客户端不缓存, 每次都要向服务器请求资源</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&#x27;Cache-Control&#x27;</span>,<span class="string">&#x27;no-store&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">使用Last-Modified</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">stat</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取请求头中的If-Modified-Since字段</span></span><br><span class="line">      <span class="keyword">const</span> ifModifiedSince = req.<span class="property">headers</span>[<span class="string">&quot;if-modified-since&quot;</span>];</span><br><span class="line">      <span class="comment">// 获取文件最后修改时间</span></span><br><span class="line">      <span class="keyword">const</span> lastModified = stat.<span class="property">mtime</span>.<span class="title function_">toGMTString</span>();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断资源是否被修改</span></span><br><span class="line">      <span class="keyword">if</span> (ifModifiedSince &amp;&amp; ifModifiedSince === lastModified) &#123;</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">304</span>; <span class="comment">// 状态码304表示资源未修改</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Last-Modified&quot;</span>, lastModified);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 第一次请求或者资源被修改了</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Last-Modified&quot;</span>, lastModified);</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.css&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">使用 ETag</span></p>
<figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">stat</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取请求头中的if-none-match字段</span></span><br><span class="line">      <span class="keyword">const</span> ifNoneMatch = req.<span class="property">headers</span>[<span class="string">&quot;if-none-match&quot;</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据本地文件计算ETag</span></span><br><span class="line">      <span class="keyword">const</span> etag = <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">        .<span class="title function_">update</span>(stat.<span class="property">mtime</span>.<span class="title function_">toString</span>() + stat.<span class="property">size</span>)</span><br><span class="line">        .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断资源是否被修改</span></span><br><span class="line">      <span class="keyword">if</span> (ifNoneMatch &amp;&amp; ifNoneMatch === etag) &#123;</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">304</span>; <span class="comment">// 状态码304表示资源未修改</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 第一次请求或者资源被修改了</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.css&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="服务端全部代码"><a href="#服务端全部代码" class="headerlink" title="服务端全部代码"></a>服务端全部代码</h5><figure class="highlight js"><figcaption><span>fold</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; createHash &#125; = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 首页</span></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 静态资源——需要缓存的</span></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/index.css&quot;</span>) &#123;</span><br><span class="line">    <span class="comment">// Cache-Control 配置的区别</span></span><br><span class="line">    <span class="comment">// 1、要求客户端缓存，但每次都需要发送请求到服务器验证缓存是否可用</span></span><br><span class="line">    <span class="comment">// res.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;); // 需配合其他字段一起使用, 这样服务器才能够验证资源是否修改</span></span><br><span class="line">    <span class="comment">// 2、要求客户端缓存，但有时间限制</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=1000&quot;</span>);</span><br><span class="line">    <span class="comment">// 3、要求客户端不缓存, 每次都要向服务器请求资源</span></span><br><span class="line">    <span class="comment">// res.setHeader(&#x27;Cache-Control&#x27;,&#x27;no-store&#x27;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式1: 使用Last-Modified</span></span><br><span class="line">    <span class="comment">// fs.stat(&quot;./index.css&quot;, (err, stat) =&gt; &#123;</span></span><br><span class="line">    <span class="comment">//   if (err) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log(err);</span></span><br><span class="line">    <span class="comment">//     res.statusCode = 404;</span></span><br><span class="line">    <span class="comment">//     res.end(&quot;Not Found&quot;);</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//   // 获取请求头中的If-Modified-Since字段</span></span><br><span class="line">    <span class="comment">//   const ifModifiedSince = req.headers[&quot;if-modified-since&quot;];</span></span><br><span class="line">    <span class="comment">//   // 获取文件最后修改时间</span></span><br><span class="line">    <span class="comment">//   const lastModified = stat.mtime.toGMTString();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//   // 判断资源是否被修改</span></span><br><span class="line">    <span class="comment">//   if (ifModifiedSince &amp;&amp; ifModifiedSince === lastModified) &#123;</span></span><br><span class="line">    <span class="comment">//     res.statusCode = 304; // 状态码304表示资源未修改</span></span><br><span class="line">    <span class="comment">//     res.setHeader(&quot;Last-Modified&quot;, lastModified);</span></span><br><span class="line">    <span class="comment">//     res.end();</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">//   &#125; else &#123;</span></span><br><span class="line">    <span class="comment">//     // 第一次请求或者资源被修改了</span></span><br><span class="line">    <span class="comment">//     res.setHeader(&quot;Last-Modified&quot;, lastModified);</span></span><br><span class="line">    <span class="comment">//     fs.createReadStream(&quot;./index.css&quot;).pipe(res);</span></span><br><span class="line">    <span class="comment">//     return;</span></span><br><span class="line">    <span class="comment">//   &#125;</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式2: 使用ETag</span></span><br><span class="line">    fs.<span class="title function_">stat</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取请求头中的if-none-match字段</span></span><br><span class="line">      <span class="keyword">const</span> ifNoneMatch = req.<span class="property">headers</span>[<span class="string">&quot;if-none-match&quot;</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据本地文件计算ETag</span></span><br><span class="line">      <span class="keyword">const</span> etag = <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">        .<span class="title function_">update</span>(stat.<span class="property">mtime</span>.<span class="title function_">toString</span>() + stat.<span class="property">size</span>)</span><br><span class="line">        .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断资源是否被修改</span></span><br><span class="line">      <span class="keyword">if</span> (ifNoneMatch &amp;&amp; ifNoneMatch === etag) &#123;</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">304</span>; <span class="comment">// 状态码304表示资源未修改</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 第一次请求或者资源被修改了</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.css&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/index.js&quot;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=5&quot;</span>);</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.js&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/1.jpeg&quot;</span>) &#123;</span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=5&quot;</span>);</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./1.jpeg&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-16-5-主动让缓存失效"><a href="#6-16-5-主动让缓存失效" class="headerlink" title="6.16.5 主动让缓存失效"></a>6.16.5 主动让缓存失效</h4><p><span style="color: #badc58; font-weight: 550;">问题：</span></p>
<p>如果<code>Cache-Control</code>设置如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 要求客户端缓存，但有时间限制</span></span><br><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=1000&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>那么客户端在缓存到期之前，都会一直使用本地缓存的<code>index.css</code>资源，这时如果服务器对应的<code>index.css</code>资源发生了改变，如何主动让客户端缓存失效？</p>
<p><span style="color: #badc58; font-weight: 550;">解决方案：</span></p>
<ul>
<li><span style="color: #9c88ff; font-weight: 550;">不缓存HTML</span>，通过添加<code>query</code>参数的方式改变<code>HTML</code>中请求的<code>URL</code></li>
<li>因为是<code>url</code> 和具体的数据做映射，改变 <code>query</code> 等于改变了 <code>url</code>，但是 <code>pathname</code> 没改变</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">客户端</span></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加query参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/index.css?v1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/1.jpeg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;1000&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/index.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">服务端</span></p>
<p>记得通过<code>const &#123; pathname, query &#125; = url.parse(req.url, true);</code> 将 <code>url</code> 拆分为 <code>pathname</code> 和 <code>query</code></p>
<p>这样只需要在 <code>html</code>里更改 <code>v1</code>便可以让客户端重新加载新的<code>index.css</code>，即使本地缓存还没到期</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line"> <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line"> <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line"> </span><br><span class="line"> <span class="comment">// 静态资源——需要缓存的</span></span><br><span class="line"> <span class="keyword">if</span> (pathname === <span class="string">&quot;/index.css&quot;</span>) &#123; </span><br><span class="line">    <span class="comment">// 2、要求客户端缓存，但有时间限制</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=1000&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 方式2: 使用ETag</span></span><br><span class="line">    fs.<span class="title function_">stat</span>(<span class="string">&quot;./index.css&quot;</span>, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        res.<span class="title function_">end</span>(<span class="string">&quot;Not Found&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取请求头中的if-none-match字段</span></span><br><span class="line">      <span class="keyword">const</span> ifNoneMatch = req.<span class="property">headers</span>[<span class="string">&quot;if-none-match&quot;</span>];</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 根据本地文件计算ETag</span></span><br><span class="line">      <span class="keyword">const</span> etag = <span class="title function_">createHash</span>(<span class="string">&quot;md5&quot;</span>)</span><br><span class="line">        .<span class="title function_">update</span>(stat.<span class="property">mtime</span>.<span class="title function_">toString</span>() + stat.<span class="property">size</span>)</span><br><span class="line">        .<span class="title function_">digest</span>(<span class="string">&quot;hex&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断资源是否被修改</span></span><br><span class="line">      <span class="keyword">if</span> (ifNoneMatch &amp;&amp; ifNoneMatch === etag) &#123;</span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">304</span>; <span class="comment">// 状态码304表示资源未修改</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        res.<span class="title function_">end</span>();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 第一次请求或者资源被修改了</span></span><br><span class="line">        res.<span class="title function_">setHeader</span>(<span class="string">&quot;Etag&quot;</span>, etag);</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./index.css&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>; </span><br><span class="line"> &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="6-16-6-总结"><a href="#6-16-6-总结" class="headerlink" title="6.16.6 总结"></a>6.16.6 总结</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221170044.png" alt="image.png"></p>
<h3 id="6-17-CDN"><a href="#6-17-CDN" class="headerlink" title="6.17 CDN"></a>6.17 CDN</h3><blockquote>
<p>CDN是一种分布式的服务器网络，旨在将网站的内容（如网页、图片、视频等）缓存到离用户最近的服务器节点上，以提高访问速度和可用性。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221170417.png" alt="image.png|649"></p>
<h4 id="6-17-1-工作原理"><a href="#6-17-1-工作原理" class="headerlink" title="6.17.1 工作原理"></a>6.17.1 工作原理</h4><ol>
<li>用户请求资源时，CDN会根据用户的地理位置，选择最优的服务器节点响应请求。<ul>
<li>当用户的浏览器尝试访问一个使用了 CDN 的网站时，它会向域名系统 (DNS) 发出请求以解析该网站的 IP 地址。</li>
<li>CDN 提供商会利用智能 DNS 技术，根据发起请求的 IP 地址、网络状况等信息判断用户的大致地理位置，并将域名解析为离用户最近或最适合的 CDN 节点的 IP 地址。<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221172100.png" alt="image.png|550"></li>
</ul>
</li>
<li>如果该节点没有所需资源，则从源站获取并缓存，以便后续请求可以快速响应。</li>
</ol>
<p><span style="color: #9c88ff; font-weight: 550;">就是把目标服务器数据，缓存在缓存服务器，由它响应客户端请求，缓存服务器没有再从目标服务器获取并缓存</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221171031.png" alt="image.png"></p>
<p>这里的缓存服务器，可能并不是直接和目标服务器相连，中间可能还要几层，比如这里的父服务器</p>
<p><span style="color: #badc58; font-weight: 550;">CDN 多层架构</span></p>
<ol>
<li><strong>边缘节点（Edge Nodes / PoP - Points of Presence）</strong>：<ul>
<li>这些是离最终用户最近的服务器，负责处理大部分用户的请求。</li>
<li>边缘节点通常分布在世界各地的主要城市或互联网交换点（IXP），以确保低延迟响应。</li>
</ul>
</li>
<li><strong>区域聚合节点（Regional Aggregation Nodes）</strong>：<ul>
<li>边缘节点会将未命中的请求转发给更靠近源站的区域聚合节点。</li>
<li>区域聚合节点负责管理和协调多个边缘节点之间的内容同步，并且可以作为第二级缓存。</li>
</ul>
</li>
<li><strong>中心节点（Central Origin Server）</strong>：<ul>
<li>也称为源站或原始服务器，存放着所有原始内容。</li>
<li>当内容在任何层级的缓存中都未能命中时，最终会从源站获取最新版本的内容。</li>
</ul>
</li>
</ol>
<h4 id="6-17-2-CDN-的好处"><a href="#6-17-2-CDN-的好处" class="headerlink" title="6.17.2 CDN 的好处"></a>6.17.2 CDN 的好处</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221171953.png" alt="image.png|649"></p>
<h3 id="6-18-静态资源和动态资源"><a href="#6-18-静态资源和动态资源" class="headerlink" title="6.18 静态资源和动态资源"></a>6.18 静态资源和动态资源</h3><h4 id="6-18-1-区别"><a href="#6-18-1-区别" class="headerlink" title="6.18.1 区别"></a>6.18.1 区别</h4><p><span style="color: #badc58; font-weight: 550;">静态资源</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221172405.png" alt="image.png|650"></p>
<p><span style="color: #badc58; font-weight: 550;">动态资源</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241221172428.png" alt="image.png|658"></p>
<h4 id="6-18-2-代码案例"><a href="#6-18-2-代码案例" class="headerlink" title="6.18.2 代码案例"></a>6.18.2 代码案例</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222130955.png" alt="image.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 可用于HTTP通信</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">// 用于处理URL</span></span><br><span class="line"><span class="keyword">const</span> url = <span class="built_in">require</span>(<span class="string">&quot;url&quot;</span>);</span><br><span class="line"><span class="comment">// 用于读取文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>); <span class="comment">// 文件存在于服务器的磁盘中</span></span><br><span class="line"><span class="comment">// 创建HTTP服务器</span></span><br><span class="line"><span class="keyword">const</span> server = http.<span class="title function_">createServer</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有新的HTTP请求时，会触发request事件</span></span><br><span class="line">server.<span class="title function_">on</span>(<span class="string">&quot;request&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; method &#125; = req;</span><br><span class="line">  <span class="keyword">const</span> &#123; pathname, query &#125; = url.<span class="title function_">parse</span>(req.<span class="property">url</span>, <span class="literal">true</span>);</span><br><span class="line">  <span class="comment">// 首页</span></span><br><span class="line">  <span class="keyword">if</span> (pathname === <span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./public/index.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 静态资源路径</span></span><br><span class="line">    <span class="keyword">const</span> path = <span class="string">`./public<span class="subst">$&#123;pathname&#125;</span>`</span>; <span class="comment">// 实际开发中，应该使用绝对路径</span></span><br><span class="line">    <span class="comment">// 读取静态资源目录下的文件状态，用来判断文件是否存在</span></span><br><span class="line">    fs.<span class="title function_">stat</span>(path, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// 静态资源不存在</span></span><br><span class="line">        res.<span class="property">statusCode</span> = <span class="number">404</span>;</span><br><span class="line">        fs.<span class="title function_">createReadStream</span>(<span class="string">&quot;./public/404.html&quot;</span>).<span class="title function_">pipe</span>(res);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      fs.<span class="title function_">createReadStream</span>(path).<span class="title function_">pipe</span>(res);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听本机的9000端口</span></span><br><span class="line">server.<span class="title function_">listen</span>(<span class="number">9000</span>, <span class="string">&quot;127.0.0.1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;HTTP服务器已经在127.0.0.1:9000 启动成功&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-19-前后端分离"><a href="#6-19-前后端分离" class="headerlink" title="6.19 前后端分离"></a>6.19 前后端分离</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222131157.png" alt="image.png|852"></p>
<h4 id="6-19-1-前后端未分离"><a href="#6-19-1-前后端未分离" class="headerlink" title="6.19.1 前后端未分离"></a>6.19.1 前后端未分离</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222131341.png" alt="image.png|885"></p>
<blockquote>
<p>SEO 是指通过优化网站内容和技术结构，使其在搜索引擎结果页面（SERP）中获得更高的自然排名。</p>
</blockquote>
<h4 id="6-19-2-前后端部分分离"><a href="#6-19-2-前后端部分分离" class="headerlink" title="6.19.2 前后端部分分离"></a>6.19.2 前后端部分分离</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222131457.png" alt="image.png|820"></p>
<h4 id="6-19-3-前后端完全分离"><a href="#6-19-3-前后端完全分离" class="headerlink" title="6.19.3 前后端完全分离"></a>6.19.3 前后端完全分离</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222131630.png" alt="image.png|818"></p>
<h3 id="6-20-跨域"><a href="#6-20-跨域" class="headerlink" title="6.20 跨域"></a>6.20 跨域</h3><blockquote>
<p><strong>跨域</strong>（Cross-Origin）指的是一个源的网页试图访问另一个源的资源。</p>
</blockquote>
<p>例如，一个网页 <code>https://example.com</code> 尝试通过 AJAX 请求访问 <code>https://api.example.org</code> 的数据。由于这两个域名不同，浏览器会认为这是跨域请求。</p>
<p>跨域问题主要<span style="color: #9c88ff; font-weight: 550;">由浏览器的安全机制引起的</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222132919.png" alt="image.png|798"></p>
<h4 id="6-20-1-CORS"><a href="#6-20-1-CORS" class="headerlink" title="6.20.1 CORS"></a>6.20.1 CORS</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222133032.png" alt="image.png|564"></p>
<h4 id="6-20-2-简单跨域请求"><a href="#6-20-2-简单跨域请求" class="headerlink" title="6.20.2 简单跨域请求"></a>6.20.2 简单跨域请求</h4><p><span style="color: #badc58; font-weight: 550;">特征</span></p>
<ol>
<li><strong>HTTP 方法</strong>：<ul>
<li>只能使用以下方法：<ul>
<li><code>GET</code></li>
<li><code>HEAD</code></li>
<li><code>POST</code></li>
</ul>
</li>
</ul>
</li>
<li><strong>请求头</strong>：<ul>
<li>只能包含以下标准头信息：<ul>
<li><code>Accept</code></li>
<li><code>Accept-Language</code></li>
<li><code>Content-Language</code></li>
<li><code>Content-Type</code>（仅限于 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code> 和 <code>text/plain</code>）</li>
</ul>
</li>
<li>不能包含自定义头信息。</li>
</ul>
</li>
<li><strong>请求体</strong>：<ul>
<li>对于 <code>POST</code> 请求，请求体只能是上述三种 <code>Content-Type</code> 中的一种。</li>
</ul>
</li>
</ol>
<p><strong>注意</strong>：这里是对请求头限制，而非响应头<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222133138.png" alt="image.png|587"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222134540.png" alt="image.png|749"></p>
<p><span style="color: #badc58; font-weight: 550;">服务器端</span></p>
<p>1、允许所有来源的请求跨域</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>2、允许特来源的请求跨域</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> allowLists = [<span class="string">&quot;http://127.0.0.1:8080&quot;</span>, <span class="string">&quot;http://127.0.0.1:9000&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (allowLists.<span class="title function_">includes</span>(req.<span class="property">headers</span>.<span class="property">origin</span>)) &#123;</span><br><span class="line">  res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, req.<span class="property">headers</span>.<span class="property">origin</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-20-3-预检请求"><a href="#6-20-3-预检请求" class="headerlink" title="6.20.3 预检请求"></a>6.20.3 预检请求</h4><blockquote>
<p>预检请求是一种 OPTIONS 请求，浏览器会在发送实际请求之前自动发送这个 OPTIONS 请求，以询问服务器是否允许即将发出的实际请求。预检请求的目的是确保服务器能够处理实际请求中的自定义头、非简单 HTTP 方法（如 PUT、DELETE）或非简单 <code>Content-Type</code>（如 <code>application/json</code></p>
</blockquote>
<ul>
<li>当发起某些类型的跨域请求（如带有自定义头信息的 POST 请求）时，浏览器会先发送一个 OPTIONS 请求。这个请求用于询问服务器是否允许即将发出的实际请求。</li>
<li>预检请求的结果可以在客户端缓存一段时间，在此期间内，相同的跨域请求可以直接发出，而无需再次进行预检。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">预检请求的流程</span></p>
<ol>
<li><strong>浏览器发送预检请求</strong>：<ul>
<li>浏览器会自动发送一个 OPTIONS 请求到目标服务器。</li>
<li>请求头中包含以下信息：<ul>
<li><code>Origin</code>：请求的源（即发起请求的域名）。</li>
<li><code>Access-Control-Request-Method</code>：实际请求的 HTTP 方法。</li>
<li><code>Access-Control-Request-Headers</code>：实际请求中包含的所有自定义头信息。</li>
</ul>
</li>
</ul>
</li>
<li><strong>服务器响应预检请求</strong>：<ul>
<li>服务器需要在响应头中包含以下信息：<ul>
<li><code>Access-Control-Allow-Origin</code>：允许的源。</li>
<li><code>Access-Control-Allow-Methods</code>：允许的 HTTP 方法。</li>
<li><code>Access-Control-Allow-Headers</code>：允许的自定义头信息。</li>
<li><code>Access-Control-Max-Age</code>（可选）：预检请求结果的缓存时间（以秒为单位）。</li>
</ul>
</li>
</ul>
</li>
<li><strong>浏览器处理响应</strong>：<ul>
<li>如果服务器响应中包含允许的源、方法和头信息，则浏览器会发送实际请求。</li>
<li>如果服务器不允许，则浏览器会阻止实际请求，并抛出错误。</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222133645.png" alt="image.png|688"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222135639.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">客户端</span></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">&quot;login&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;password&quot;</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> $login = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;login&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> $username = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;username&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> $password = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;password&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $login.<span class="title function_">addEventListener</span>(<span class="string">&quot;submit&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      e.<span class="title function_">preventDefault</span>(); <span class="comment">// 阻止表单的默认行为：自动向服务器发送请求, 导致强制刷新页面</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> username = $username.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> password = $password.<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">open</span>(<span class="string">&quot;POST&quot;</span>, <span class="string">&quot;http://127.0.0.1:9000/login&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">console</span>.<span class="title function_">log</span>(xhr.<span class="property">response</span>);</span></span><br><span class="line"><span class="language-javascript">      &#125;);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 设置请求头</span></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 预检跨域请求</span></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">setRequestHeader</span>(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="comment">// 发送请求的同时携带数据</span></span></span><br><span class="line"><span class="language-javascript">      xhr.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; username, password &#125;));</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><span style="color: #badc58; font-weight: 550;">服务器端</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (pathname === <span class="string">&quot;/login&quot;</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;登录请求&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> (allowLists.<span class="title function_">includes</span>(req.<span class="property">headers</span>.<span class="property">origin</span>)) &#123;</span><br><span class="line">    <span class="comment">// 只允许特定来源的请求跨域</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Origin&quot;</span>, req.<span class="property">headers</span>.<span class="property">origin</span>);</span><br><span class="line">    <span class="comment">// 设置响应头字段Content--Type,告诉客户端如何处理响应数据</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Headers&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>);</span><br><span class="line">    <span class="comment">// 允许的请求方式</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Allow-Methods&quot;</span>, <span class="string">&quot;POST,GET,PUT&quot;</span>);</span><br><span class="line">    <span class="comment">// 预检请求的缓存时间</span></span><br><span class="line">    res.<span class="title function_">setHeader</span>(<span class="string">&quot;Access-Control-Max-Age&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    res.<span class="title function_">end</span>(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222152225.png" alt="image.png|722"></p>
<h4 id="6-20-4-跨域-代理服务器"><a href="#6-20-4-跨域-代理服务器" class="headerlink" title="6.20.4 跨域-代理服务器"></a>6.20.4 跨域-代理服务器</h4><p>跨域问题主要<span style="color: #9c88ff; font-weight: 550;">由浏览器的安全机制引起</span>，具体来说是浏览器的同源策略（Same-Origin Policy）</p>
<ul>
<li>浏览器的同源策略是为了防止跨站脚本攻击（XSS）、跨站请求伪造（CSRF）等安全问题。</li>
<li>通过限制跨域请求，浏览器可以保护用户数据不被恶意网站窃取或滥用。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222141934.png" alt="image.png"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20241222142638.png" alt="image.png|705"></p>
<p>这里<code>/api开头</code>就是<span style="color: #9c88ff; font-weight: 550;">用来区分哪些请求需要走代理，哪些请求不需要走代理</span></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现代理功能</span></span><br><span class="line"> <span class="keyword">if</span> (pathname.<span class="title function_">startsWith</span>(<span class="string">&quot;/api&quot;</span>)) &#123;</span><br><span class="line">   <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;代理请求&quot;</span>);</span><br><span class="line">   <span class="comment">// 接收到源客户端的请求后，向目标服务器发送新的请求</span></span><br><span class="line">   http.<span class="title function_">request</span>(</span><br><span class="line">     &#123;</span><br><span class="line">       <span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">       <span class="attr">port</span>: <span class="number">9000</span>, <span class="comment">// 目标服务器的端口号</span></span><br><span class="line">       <span class="attr">path</span>: pathname.<span class="title function_">slice</span>(<span class="number">4</span>), <span class="comment">// 去掉前缀 /api</span></span><br><span class="line">       <span class="attr">method</span>: req.<span class="property">method</span>,</span><br><span class="line">       <span class="attr">headers</span>: req.<span class="property">headers</span>,</span><br><span class="line">     &#125;,</span><br><span class="line">     <span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="comment">// 接收到目标服务器的响应后，将响应数据发送给源客户端</span></span><br><span class="line">       res.<span class="title function_">writeHead</span>(response.<span class="property">statusCode</span>, response.<span class="property">headers</span>);</span><br><span class="line">       response.<span class="title function_">pipe</span>(res);</span><br><span class="line">     &#125;</span><br><span class="line">   );</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>请求的 <code>url</code> 上 <code>/api</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 添加query参数 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>推荐商品<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;products&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="comment">// 通过Ajax(Asynchronous JavaScript And XML)从服务器获取数据</span></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">open</span>(<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;http://127.0.0.1:9000/api/products&quot;</span>, <span class="literal">true</span>);</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">addEventListener</span>(<span class="string">&quot;load&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> products = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">response</span>).<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">const</span> ul = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;products&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">for</span> (<span class="keyword">const</span> product <span class="keyword">of</span> products) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> li = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;li&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        li.<span class="property">innerText</span> = product.<span class="property">name</span>;</span></span><br><span class="line"><span class="language-javascript">        ul.<span class="title function_">appendChild</span>(li);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript">    xhr.<span class="title function_">send</span>();</span></span><br><span class="line"><span class="language-javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://VernalScenery.github.io">Scenery</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://vernalscenery.github.io/2024/12/18/%E8%AE%A1%E7%BD%91/05_%E8%AE%A1%E7%BD%91_%E5%BA%94%E7%94%A8%E5%B1%82_01/">https://vernalscenery.github.io/2024/12/18/%E8%AE%A1%E7%BD%91/05_%E8%AE%A1%E7%BD%91_%E5%BA%94%E7%94%A8%E5%B1%82_01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://VernalScenery.github.io" target="_blank">春和景明的记事本</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BD%91/">计网</a></div><div class="post_share"><div class="social-share" data-image="/./img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/12/18/JS/18_JSLearn_%E9%98%B2%E6%8A%96%E3%80%81%E8%8A%82%E6%B5%81%E5%87%BD%E6%95%B0/" title="18_JSLearn_防抖、节流函数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">18_JSLearn_防抖、节流函数</div></div></a></div><div class="next-post pull-right"><a href="/2024/12/17/JS/17_JSLearn_BOM%E3%80%81DOM/" title="15_JSLearn_BOM、DOM"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">15_JSLearn_BOM、DOM</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/12/16/%E8%AE%A1%E7%BD%91/01_%E8%AE%A1%E7%BD%91_%E5%88%9D%E8%AF%86%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" title="01_计网_初识计算机网络"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-16</div><div class="title">01_计网_初识计算机网络</div></div></a></div><div><a href="/2024/12/16/%E8%AE%A1%E7%BD%91/02_%E8%AE%A1%E7%BD%91_%E7%89%A9%E7%90%86%E5%B1%82%E5%92%8C%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82/" title="02_计网_物理层和数据链路层"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-16</div><div class="title">02_计网_物理层和数据链路层</div></div></a></div><div><a href="/2024/12/16/%E8%AE%A1%E7%BD%91/03_%E8%AE%A1%E7%BD%91_%E7%BD%91%E7%BB%9C%E5%B1%82/" title="03_计网_网络层"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-16</div><div class="title">03_计网_网络层</div></div></a></div><div><a href="/2024/12/18/%E8%AE%A1%E7%BD%91/04_%E8%AE%A1%E7%BD%91_%E8%BF%90%E8%BE%93%E5%B1%82/" title="04_计网_运输层"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-18</div><div class="title">04_计网_运输层</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Scenery</div><div class="author-info__description">今天不想跑，所以才去跑</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">82</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">15</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/chjm0121" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1595718686@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E6%A6%82%E8%A7%88"><span class="toc-text">1 概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-FTP-%E5%8D%8F%E8%AE%AE"><span class="toc-text">2 FTP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%B8%B8%E8%A7%81%E7%94%A8%E9%80%94"><span class="toc-text">2.1 常见用途</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-FTP-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BF%9E%E6%8E%A5"><span class="toc-text">2.2 FTP 客户端和服务器之间的连接</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E9%82%AE%E4%BB%B6%E5%8D%8F%E8%AE%AE"><span class="toc-text">3 邮件协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-POP3-%E5%8D%8F%E8%AE%AE"><span class="toc-text">3.1 POP3 协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-IMAP-%E5%8D%8F%E8%AE%AE"><span class="toc-text">3.2 IMAP 协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-DHCP-%E5%8D%8F%E8%AE%AE"><span class="toc-text">4 DHCP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%B8%BB%E8%A6%81%E5%8A%9F%E8%83%BD"><span class="toc-text">4.1 主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">4.2 工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-text">4.3 配置参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-DNS-%E5%8D%8F%E8%AE%AE"><span class="toc-text">5 DNS 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E5%9F%9F%E5%90%8D"><span class="toc-text">5.1 域名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">5.2 域名服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">5.2.1 域名服务器的类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-text">5.2.2 域名解析过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-HTTP-%E5%8D%8F%E8%AE%AE"><span class="toc-text">6 HTTP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E8%AE%A4%E8%AF%86-HTTP-%E5%8D%8F%E8%AE%AE"><span class="toc-text">6.1 认识 HTTP 协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-HTTP-%E7%89%88%E6%9C%AC"><span class="toc-text">6.1.1 HTTP 版本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-HTTP-%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94%E6%A8%A1%E5%9E%8B"><span class="toc-text">6.1.2 HTTP 请求-响应模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-HTTP-%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-text">6.2 HTTP 报文格式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-text">6.2.1 请求报文格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-text">6.2.2 响应报文格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-3-HTTP-%E4%BD%BF%E7%94%A8%E7%9A%84%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81"><span class="toc-text">6.2.3 HTTP 使用的字符编码</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E7%BC%96%E7%A0%81"><span class="toc-text">6.3 字符集和编码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-%E5%AD%97%E7%AC%A6%E9%9B%86-Character-Set"><span class="toc-text">6.3.1 字符集 (Character Set)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-%E7%BC%96%E7%A0%81-Encoding"><span class="toc-text">6.3.2  编码 (Encoding)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E7%BB%9F%E4%B8%80%E7%BC%96%E7%A0%81-Unicode"><span class="toc-text">6.4 统一编码 Unicode</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-Unicode%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-text">6.4.1 Unicode的特点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-%E5%AE%9A%E9%95%BF%E7%BC%96%E7%A0%81-Fixed-Length-Encoding"><span class="toc-text">6.4.2 定长编码(Fixed-Length Encoding)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-3-%E5%8F%AF%E5%8F%98%E9%95%BF%E7%BC%96%E7%A0%81-Variable-Length-Encoding"><span class="toc-text">6.4.3 可变长编码 (Variable-Length Encoding)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-4-UTF-8"><span class="toc-text">6.4.4 UTF-8</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%9F%BA%E4%BA%8E-HTTP-%E5%8D%8F%E8%AE%AE%E7%9A%84%E9%80%9A%E4%BF%A1"><span class="toc-text">6.5 基于 HTTP 协议的通信</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-HTTP-%E8%AF%B7%E6%B1%82%E6%96%B9%E6%B3%95"><span class="toc-text">6.6 HTTP 请求方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-RESTful-%E9%A3%8E%E6%A0%BC%E7%9A%84-API"><span class="toc-text">6.7 RESTful 风格的 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-1-%E4%B8%80%E8%88%AC%E9%A3%8E%E6%A0%BC%E7%9A%84-API"><span class="toc-text">6.7.1 一般风格的 API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-2-RESTful-%E9%A3%8E%E6%A0%BC%E7%9A%84-API"><span class="toc-text">6.7.2 RESTful 风格的 API</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-7-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.7.3 代码实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-URL"><span class="toc-text">6.8 URL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-1-URI%E3%80%81URL%E5%92%8CURN"><span class="toc-text">6.8.1 URI、URL和URN</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-8-2-URL-%E7%BC%96%E7%A0%81"><span class="toc-text">6.8.2 URL 编码</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E5%AD%97%E7%AC%A6"><span class="toc-text">一般字符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%89%E6%AD%A7%E4%B9%89%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="toc-text">有歧义的字符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84%E8%A1%8C%E4%B8%BA"><span class="toc-text">浏览器的行为</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#JS-%E6%8F%90%E4%BE%9B%E7%9A%84-URL%E7%BC%96%E7%A0%81%E6%96%B9%E6%B3%95"><span class="toc-text">JS 提供的 URL编码方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-HTTP-%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">6.9 HTTP 响应状态码</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-1-1xx"><span class="toc-text">6.9.1 1xx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-2-2xx"><span class="toc-text">6.9.2 2xx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-3-3xx"><span class="toc-text">6.9.3 3xx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-4-4xx"><span class="toc-text">6.9.4 4xx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-9-5-5xx"><span class="toc-text">6.9.5 5xx</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C-VPN"><span class="toc-text">6.10 代理服务器和 VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-1-%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">6.10.1 正向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-2-%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-text">6.10.2 反向代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.10.3 代码实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-10-4-VPN"><span class="toc-text">6.10.4 VPN</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-HTTP-%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">6.11 HTTP 首部字段</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-1-Host"><span class="toc-text">6.11.1 Host</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-text">示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Nginx-%E9%85%8D%E7%BD%AE"><span class="toc-text">Nginx 配置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-text">代码案例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-2-Referer"><span class="toc-text">6.11.2 Referer</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Referer-%E5%AE%9E%E7%8E%B0%E9%98%B2%E7%9B%97%E9%93%BE"><span class="toc-text">Referer 实现防盗链</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-3-Location"><span class="toc-text">6.11.3 Location</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-4-Conten-Disposition"><span class="toc-text">6.11.4 Conten-Disposition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-5-%E5%AE%9E%E7%8E%B0%E5%9B%BE%E7%89%87%E4%B8%8B%E8%BD%BD%E5%8A%9F%E8%83%BD"><span class="toc-text">6.11.5 实现图片下载功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-6-Allow"><span class="toc-text">6.11.6 Allow</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-7-User-Agent"><span class="toc-text">6.11.7 User-Agent</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E7%AB%AF-%E3%80%81PC-%E7%AB%AF%E6%98%BE%E7%A4%BA%E4%B8%8D%E5%90%8C%E9%A1%B5%E9%9D%A2"><span class="toc-text">移动端 、PC 端显示不同页面</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-8-%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-text">6.11.8 连接管理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-9-Content-Length"><span class="toc-text">6.11.9 Content-Length</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-10-Transfer-Encoding"><span class="toc-text">6.11.10 Transfer-Encoding</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-11-%E5%86%85%E5%AE%B9%E5%8D%8F%E5%95%86"><span class="toc-text">6.11.11 内容协商</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-12-Content-Type"><span class="toc-text">6.11.12 Content-Type</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E5%93%8D%E5%BA%94%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">作为响应首部字段</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E4%B8%BA%E8%AF%B7%E6%B1%82%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">作为请求首部字段</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-13-%E5%AA%92%E4%BD%93%E7%B1%BB%E5%9E%8B"><span class="toc-text">6.11.13 媒体类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-11-14-%E5%86%85%E5%AE%B9%E5%8E%8B%E7%BC%A9"><span class="toc-text">6.11.14 内容压缩</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-12-%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-text">6.12 文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-12-1-multipart-form-data"><span class="toc-text">6.12.1 multipart&#x2F;form-data</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-12-2-%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-text">6.12.2 代码案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0"><span class="toc-text">6.13 断点续传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-13-1-%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0%E5%8E%9F%E7%90%86"><span class="toc-text">6.13.1 断点续传原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-13-2-%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">6.13.2 涉及到的首部字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-13-3-%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.13.3 代码实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="toc-text">客户端</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-14-%E8%A7%86%E9%A2%91%E6%92%AD%E6%94%BE"><span class="toc-text">6.14 视频播放</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-14-1-%E5%8E%9F%E7%90%86"><span class="toc-text">6.14.1 原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-14-2-%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">6.14.2 涉及到的首部字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-14-3-%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-text">6.14.3 代码案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-15-%E5%8D%95%E5%90%91%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0"><span class="toc-text">6.15 单向散列函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-15-1-%E4%BD%BF%E7%94%A8%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B0%E5%8A%A0%E5%AF%86%E5%AF%86%E7%A0%81"><span class="toc-text">6.15.1 使用散列函数加密密码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-15-2-%E9%80%9A%E8%BF%87%E6%95%A3%E5%88%97%E5%80%BC%E5%88%A4%E6%96%AD%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9%E6%98%AF%E5%90%A6%E5%8F%91%E7%94%9F%E4%BA%86%E6%94%B9%E5%8F%98"><span class="toc-text">6.15.2 通过散列值判断文件内容是否发生了改变</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-16-HTTP-%E7%BC%93%E5%AD%98"><span class="toc-text">6.16 HTTP 缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-1-%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="toc-text">6.16.1 浏览器缓存策略</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="toc-text">缓存不存在</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%BF%87%E6%9C%9F%E4%BA%86"><span class="toc-text">缓存过期了</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-2-%E7%9B%B8%E5%85%B3%E7%9A%84%E9%A6%96%E9%83%A8%E5%AD%97%E6%AE%B5"><span class="toc-text">6.16.2 相关的首部字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-3-ETag"><span class="toc-text">6.16.3 ETag</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1"><span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ETag-%E5%92%8C-Last-Modified"><span class="toc-text">ETag 和 Last-Modified</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-4-%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-text">6.16.4 代码案例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E7%82%B9"><span class="toc-text">关键点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%85%A8%E9%83%A8%E4%BB%A3%E7%A0%81"><span class="toc-text">服务端全部代码</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-5-%E4%B8%BB%E5%8A%A8%E8%AE%A9%E7%BC%93%E5%AD%98%E5%A4%B1%E6%95%88"><span class="toc-text">6.16.5 主动让缓存失效</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-16-6-%E6%80%BB%E7%BB%93"><span class="toc-text">6.16.6 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-17-CDN"><span class="toc-text">6.17 CDN</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-17-1-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">6.17.1 工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-17-2-CDN-%E7%9A%84%E5%A5%BD%E5%A4%84"><span class="toc-text">6.17.2 CDN 的好处</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-18-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E5%92%8C%E5%8A%A8%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-text">6.18 静态资源和动态资源</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-18-1-%E5%8C%BA%E5%88%AB"><span class="toc-text">6.18.1 区别</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-18-2-%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="toc-text">6.18.2 代码案例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-19-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="toc-text">6.19 前后端分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-19-1-%E5%89%8D%E5%90%8E%E7%AB%AF%E6%9C%AA%E5%88%86%E7%A6%BB"><span class="toc-text">6.19.1 前后端未分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-19-2-%E5%89%8D%E5%90%8E%E7%AB%AF%E9%83%A8%E5%88%86%E5%88%86%E7%A6%BB"><span class="toc-text">6.19.2 前后端部分分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-19-3-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%AE%8C%E5%85%A8%E5%88%86%E7%A6%BB"><span class="toc-text">6.19.3 前后端完全分离</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-20-%E8%B7%A8%E5%9F%9F"><span class="toc-text">6.20 跨域</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-20-1-CORS"><span class="toc-text">6.20.1 CORS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-20-2-%E7%AE%80%E5%8D%95%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82"><span class="toc-text">6.20.2 简单跨域请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-20-3-%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82"><span class="toc-text">6.20.3 预检请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-20-4-%E8%B7%A8%E5%9F%9F-%E4%BB%A3%E7%90%86%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">6.20.4 跨域-代理服务器</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/26/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/10_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" title="10_机器学习_集成学习">10_机器学习_集成学习</a><time datetime="2025-07-26T01:58:53.000Z" title="发表于 2025-07-26 09:58:53">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/25/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/09_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/" title="09_机器学习_朴素贝叶斯">09_机器学习_朴素贝叶斯</a><time datetime="2025-07-25T03:08:47.000Z" title="发表于 2025-07-25 11:08:47">2025-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/24/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/08_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%94%AF%E6%8C%81%E5%90%91%E9%87%8F%E6%9C%BA/" title="08_机器学习_支持向量机">08_机器学习_支持向量机</a><time datetime="2025-07-23T18:31:48.000Z" title="发表于 2025-07-24 02:31:48">2025-07-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/23/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/07_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E5%A4%9A%E5%B1%82%E6%84%9F%E7%9F%A5%E6%9C%BA(MLP)/" title="07_机器学习_多层感知机(MLP)">07_机器学习_多层感知机(MLP)</a><time datetime="2025-07-22T22:46:33.000Z" title="发表于 2025-07-23 06:46:33">2025-07-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/22/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/04_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5/" title="04_机器学习_基础概念">04_机器学习_基础概念</a><time datetime="2025-07-22T03:20:30.000Z" title="发表于 2025-07-22 11:20:30">2025-07-22</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Scenery</div><div class="footer_custom_text"><div>波澜不惊</div><div class="footer-div"><img class="footer-icon" src="./img/备案图标.png"><a class="footer-a" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">皖ICP备2021016944号-1</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>