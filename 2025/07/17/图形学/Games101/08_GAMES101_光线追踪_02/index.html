<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>08_GAMES101_光线追踪_02 | 春和景明的记事本</title><meta name="author" content="Scenery"><meta name="copyright" content="Scenery"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="基于物理渲染的基础知识1 辐射度量学1.1 概览首先，想一想到目前为止我们对光线亮度的定义是什么？只是简单的用 3 维 (R,G,B) 向量来描述，但却没有任何的单位，如果想要一个完全正确的模型，这显然是不应该的，必须用合适的物理量来描述光线！ 以经典的 Whited-style 光线追踪为例，它存"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vernalscenery.github.io/2025/07/17/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/08_GAMES101_%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_02/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '08_GAMES101_光线追踪_02',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-05 14:17:12'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">73</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/1.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="春和景明的记事本"><span class="site-name">春和景明的记事本</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">08_GAMES101_光线追踪_02</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-16T21:46:11.000Z" title="发表于 2025-07-17 05:46:11">2025-07-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-05T06:17:12.000Z" title="更新于 2025-08-05 14:17:12">2025-08-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="08_GAMES101_光线追踪_02"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="基于物理渲染的基础知识"><a href="#基于物理渲染的基础知识" class="headerlink" title="基于物理渲染的基础知识"></a>基于物理渲染的基础知识</h1><h2 id="1-辐射度量学"><a href="#1-辐射度量学" class="headerlink" title="1 辐射度量学"></a>1 辐射度量学</h2><h3 id="1-1-概览"><a href="#1-1-概览" class="headerlink" title="1.1 概览"></a>1.1 概览</h3><p>首先，想一想到目前为止我们对光线亮度的定义是什么？只是简单的用 3 维 (R,G,B) 向量来描述，但却没有任何的单位，如果想要一个完全正确的模型，这显然是不应该的，必须用合适的物理量来描述光线！</p>
<p>以经典的 <strong>Whited-style 光线追踪</strong>为例，它存在两个主要问题：</p>
<ul>
<li><strong>忽略漫反射追踪</strong>: 它不会递归地追踪物体表面漫反射出去的光线，而是直接返回一个预设的颜色，这不符合能量在场景中传播的规律。</li>
<li><strong>使用经验模型</strong>: 它在计算光源直射效果时依赖于 <strong>Blinn-Phong</strong> 等模型。这类模型只是为了得到一个“看起来还行”的效果，是基于经验的，并非基于物理现实。</li>
</ul>
<p>以上所有问题都可以通过<strong>辐射度量学</strong>得到完美解决，因为它提供了一套完整、自洽的物理量和单位来描述光能的传输。</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>英文 (符号)</th>
<th>核心定义</th>
<th>视角</th>
<th>单位</th>
<th>花洒类比</th>
</tr>
</thead>
<tbody><tr>
<td><strong>辐射能量</strong></td>
<td>Radiant Energy (Q)</td>
<td>总能量</td>
<td>整体</td>
<td><strong>J</strong> (焦耳)</td>
<td>水箱里所有的水</td>
</tr>
<tr>
<td><strong>辐射通量</strong></td>
<td>Radiant Flux (Φ)</td>
<td>功率 (能量/时间)</td>
<td>整体</td>
<td><strong>W</strong> (瓦特)</td>
<td>每秒喷出多少水</td>
</tr>
<tr>
<td><strong>辐射强度</strong></td>
<td>Radiant Intensity (I)</td>
<td>功率/立体角</td>
<td><strong>从点光源发出</strong></td>
<td><strong>W/sr</strong></td>
<td>某个方向喷出的水流密度</td>
</tr>
<tr>
<td><strong>辐照度</strong></td>
<td>Irradiance (E)</td>
<td>功率/面积</td>
<td><strong>照射到表面</strong></td>
<td><strong>W/m²</strong></td>
<td>地面单位面积有多湿</td>
</tr>
<tr>
<td><strong>辐射率</strong></td>
<td>Radiance (L)</td>
<td>功率/(立体角·投影面积)</td>
<td><strong>一束光本身</strong></td>
<td><strong>W/(sr·m²)</strong></td>
<td>你眼中“那束水流”的亮度</td>
</tr>
</tbody></table>
<h3 id="1-2-辐射能量-Radiant-Energy-Q-和-辐射通量-Radiant-Flux-Φ"><a href="#1-2-辐射能量-Radiant-Energy-Q-和-辐射通量-Radiant-Flux-Φ" class="headerlink" title="1.2 辐射能量 (Radiant Energy, Q) 和 辐射通量 (Radiant Flux, Φ)"></a>1.2 辐射能量 (Radiant Energy, Q) 和 辐射通量 (Radiant Flux, Φ)</h3><p><span style="color: #badc58; font-weight: 550;">辐射能量 (Radiant Energy, Q)</span></p>
<ul>
<li><strong>核心思想</strong>: 这是最基础的量，代表电磁辐射（光）所包含的<strong>总能量</strong>。</li>
<li><strong>花洒类比</strong>: 花洒水箱里<strong>所有水</strong>的总量。</li>
<li><strong>定义</strong>: 以电磁波形式发射或传播的总能量。</li>
<li><strong>单位</strong>: **焦耳 (Joule, J)**。</li>
</ul>
<p>这个概念比较绝对，但在实际应用中，我们更关心能量传输的“效率”，也就是功率。</p>
<p><span style="color: #badc58; font-weight: 550;">辐射通量 (Radiant Flux, Φ)</span></p>
<ul>
<li><strong>核心思想</strong>: 单位时间内的能量，也就是**功率 (Power)**。</li>
<li><strong>花洒类比</strong>: 花洒<strong>每秒钟喷出多少水</strong>。这是衡量花洒“出水量”的核心指标。</li>
<li><strong>定义</strong>: 单位时间内流过的辐射能量。</li>
<li><strong>公式</strong>:<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716174409.png" alt="image.png"></li>
<li><strong>单位</strong>: **瓦特 (Watt, W)**，即 焦耳/秒 (J/s)。</li>
</ul>
<p>我们常说的“100 瓦的灯泡”，指的就是它的辐射通量（功率）是 100W。</p>
<h3 id="1-3-辐射强度-Radiant-Intensity-I"><a href="#1-3-辐射强度-Radiant-Intensity-I" class="headerlink" title="1.3 辐射强度 (Radiant Intensity, I)"></a>1.3 辐射强度 (Radiant Intensity, I)</h3><h4 id="1-3-1-定义"><a href="#1-3-1-定义" class="headerlink" title="1.3.1 定义"></a>1.3.1 定义</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716174846.png" alt="image.png"></p>
<ul>
<li><strong>核心思想</strong>: 描述一个<strong>点光源</strong>在<strong>特定方向</strong>上发射光的能力有多强。</li>
<li><strong>花洒类比</strong>: 从花洒的中心点看，<strong>某个方向上（比如正下方）喷出的水流有多密集</strong>。</li>
<li><strong>定义</strong>: 从点光源发出，单位<strong>立体角 (Solid Angle)</strong> 内的辐射通量（功率）。</li>
<li><strong>公式</strong>:<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716180310.png" alt="image.png|145"></li>
<li><strong>单位</strong>: **瓦特/球面度 (W/sr)**。</li>
</ul>
<p>这个概念专门用于<strong>点光源</strong>，它不关心你离光源有多远，只关心那个方向上的“发射强度”。</p>
<h4 id="1-3-2-立体角-Solid-Angle"><a href="#1-3-2-立体角-Solid-Angle" class="headerlink" title="1.3.2 立体角 (Solid Angle)"></a>1.3.2 立体角 (Solid Angle)</h4><p>立体角 (Solid Angle) 其实就是对应二维空间中圆的弧度在三维空间中球上的拓展。 首先看在二维计算弧度公式如下</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716175257.png" alt="image.png|691"></p>
<p>那么对应在三维上的球的弧度 (立体角)，只需进行一个简单的扩展如下：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716175330.png" alt="image.png"></p>
<p>三维空间中的<strong>立体角 (Solid Angle, Ω)</strong> 被定义为球面上的**截取面积 (A) / 半径的平方 (r²)**。整个球面的立体角是 <code>4π</code> 球面度 (steradians)。</p>
<h4 id="1-3-3-微分立体角-dω"><a href="#1-3-3-微分立体角-dω" class="headerlink" title="1.3.3 微分立体角 dω"></a>1.3.3 微分立体角 dω</h4><p>那么对于 Radiant intensity 的定义当中，微分立体角 dω 计算如下：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716175553.png" alt="image.png|786"></p>
<p>首先确定空间中一个方向 (通过 $θ,ϕ$)，在这两个角度上分别增加一个微分值，则可以计算出如图中所示的对应到球上的投影面积。其中 $rdθ$ 就是微分面积元的高，$rsinθdϕ$ 是微分面积元的宽，二者相乘，自然就是面积了，再根据立体角的定义除以 $r^2$ 即可得到微分立体角了。</p>
<p>$$<br>dω=sinθdθdϕ<br>$$</p>
<p>此还可以验证下，对 dω 在整个球上积分：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716175808.png" alt="image.png"></p>
<p>与之前所讲的球的立体角为 4π一致。</p>
<h4 id="1-3-4-辐射强度-Radiant-Intensity-的本质"><a href="#1-3-4-辐射强度-Radiant-Intensity-的本质" class="headerlink" title="1.3.4 辐射强度 (Radiant Intensity) 的本质"></a>1.3.4 辐射强度 (Radiant Intensity) 的本质</h4><p>辐射强度 (Radiant Intensity) 就是衡量一个光源在某个特定方向上“有多亮”的物理量。</p>
<ul>
<li><strong>第一步：确定一个方向 <code>(ω)</code></strong><ul>
<li>所有计算都始于在空间中选定一个<strong>精确的方向</strong>。这个方向在球坐标中由一对角度 <code>(θ, φ)</code> 来唯一确定。我们称这个方向向量为 <code>ω</code>。</li>
</ul>
</li>
<li><strong>第二步：围绕该方向构建一个微小的“锥体” <code>(dω)</code></strong><ul>
<li>“微分立体角 <code>dω</code>” 并不是凭空产生的，而是在我们已选定的方向 <code>ω</code> 基础上，通过对角度 <code>θ</code> 和 <code>φ</code> 进行微小的扰动 <code>dθ</code> 和 <code>dφ</code> 而形成的一个<strong>极小的立体角锥体</strong>。</li>
<li>这个 <code>dω</code> 就代表了环绕着我们关心方向 <code>ω</code> 的一小片“视野范围”。</li>
</ul>
</li>
<li><strong>第三步：连接物理量——功率</strong><ul>
<li><strong>辐射强度 (Radiant Intensity, I)</strong> 正是回答了这样一个问题：“光源向这个微小的立体角锥体 <code>dω</code> 内，发射了多少功率 <code>dΦ</code>？”</li>
<li>因此，它的定义 <code>I = dΦ / dω</code>（单位立体角的功率）的物理含义就非常清晰了。</li>
</ul>
</li>
</ul>
<h4 id="1-3-5-各向同性点光源-Isotropic-Point-Source"><a href="#1-3-5-各向同性点光源-Isotropic-Point-Source" class="headerlink" title="1.3.5 各向同性点光源 (Isotropic Point Source)"></a>1.3.5 各向同性点光源 (Isotropic Point Source)</h4><ul>
<li><strong>点光源 (Point Source)</strong>: 一个理想化的、没有体积的光源。</li>
<li><strong>各向同性 (Isotropic)</strong>: 意味着这个光源向<strong>所有方向</strong>发射光线都是<strong>完全均匀</strong>的，即所有方向上的亮度都与方向无关。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716180839.png" alt="image.png"></p>
<p>一个光源的总功率（总辐射通量 <code>Φ</code>）等于它在所有方向上的辐射强度 <code>I</code> 的总和。</p>
<p>在数学上，“所有方向的总和”就是对整个球面的立体角（<code>S²</code>）进行积分。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181053.png" alt="image.png"></p>
<p>这里 <code>I(ω)</code> 表示辐射强度是方向 <code>ω</code> 的函数。</p>
<p>因为我们处理的是一个<strong>各向同性</strong>光源，所以它的辐射强度 <code>I</code> 在所有方向 <code>ω</code> 上都是<strong>相同的</strong>，即 <code>I</code> 是一个<strong>常数</strong>，故可以从积分符号中提取出来</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181203.png" alt="image.png"></p>
<p><code>∫ dω</code> 的物理意义是“将球面上所有微小的立体角都加起来”。其结果就是整个球体的总立体角，这是一个常数：<strong>4π</strong> 球面度 (steradians)。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181223.png" alt="image.png"></p>
<p>通过简单的代数变换，我们就能得到各向同性点光源的辐射强度 <code>I</code> 的计算公式：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181241.png" alt="image.png"></p>
<h3 id="1-4-辐照度-Irradiance-E"><a href="#1-4-辐照度-Irradiance-E" class="headerlink" title="1.4 辐照度 (Irradiance, E)"></a>1.4 辐照度 (Irradiance, E)</h3><h4 id="1-4-1-定义"><a href="#1-4-1-定义" class="headerlink" title="1.4.1 定义"></a>1.4.1 定义</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181441.png" alt="image.png"></p>
<ul>
<li><strong>核心定义</strong>: 辐照度是指<strong>入射到物体表面某一点</strong>的<strong>单位面积</strong>的功率（辐射通量）。</li>
<li><strong>通俗理解</strong>: 它衡量的是一个表面被光“照得有多亮”，描述的是<strong>接收端</strong>的情况。</li>
<li><strong>数学公式</strong>:<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181353.png" alt="image.png"></li>
<li><strong>单位</strong>: 瓦特/平方米 (<code>W/m²</code>)。其对应的光度学单位是 <code>lux</code> (勒克斯)。</li>
</ul>
<h4 id="1-4-2-影响因素一：入射角度-Lambert’s-Law"><a href="#1-4-2-影响因素一：入射角度-Lambert’s-Law" class="headerlink" title="1.4.2 影响因素一：入射角度 (Lambert’s Law)"></a>1.4.2 影响因素一：入射角度 (Lambert’s Law)</h4><p>同样一束光，当它<strong>倾斜照射</strong>到一个表面时，会比<strong>垂直照射</strong>时散布在<strong>更大的面积</strong>上，因此单位面积接收到的能量（即辐照度）就变小了。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181652.png" alt="image.png"></p>
<ul>
<li>如图所示，一束截面积为 <code>A₁</code> 的光束，当它垂直照射时，辐照度为 <code>E₁ = Φ / A₁</code>。</li>
<li>当该光束以与法线呈 <code>θ</code> 角倾斜照射时，它会覆盖更大的表面积 <code>A₂</code>。它们之间的几何关系是 <code>A₂ = A₁ / cosθ</code>。</li>
<li>因此，倾斜表面上的辐照度 <code>E₂</code> 为：<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181714.png" alt="image.png"></li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">结论：</span>辐照度的大小与<strong>入射光方向</strong>和<strong>表面法线</strong>之间夹角 <code>θ</code> 的<strong>余弦 <code>cosθ</code></strong> 成正比。这也就是计算机图形学中 <strong>Lambert’s Law (朗伯定律)</strong> 的物理基础。</p>
<h4 id="1-4-3-影响因素二：距离-Irradiance-Falloff"><a href="#1-4-3-影响因素二：距离-Irradiance-Falloff" class="headerlink" title="1.4.3 影响因素二：距离 (Irradiance Falloff)"></a>1.4.3 影响因素二：距离 (Irradiance Falloff)</h4><p>一个点光源发出的总功率 <code>Φ</code> 是固定的。这股能量会均匀地散布在以光源为中心的球面上。离光源越远，这个球面的面积就越大，能量就被稀释得越厉害。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181841.png" alt="image.png|836"></p>
<p><span style="color: #badc58; font-weight: 550;">结论：</span>辐照度的大小与距离 <code>r</code> 的<strong>平方成反比</strong>。这就是著名的**平方反比定律 (Inverse-Square Law)**。当距离变成 2 倍时，辐照度就衰减为原来的 1/4。</p>
<p>但在半径越大，辐射强度是不变的，因为：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716182145.png" alt="image.png"></p>
<p>其中立体角的定义是：球体上截取的<strong>面积 (A)</strong> 与 <strong>半径的平方 (r²)</strong> 的比值。</p>
<p>现在，我们来看图中的情况：光源在中心，光向四周均匀辐射。我们讨论的是<strong>整个球面</strong>所对应的立体角。</p>
<ul>
<li>一个球的表面积 <strong>A</strong> 是 $4πr^2$。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716182416.png" alt="image.png|261"></p>
<p>无论半径 <code>r</code> 是 1、10 还是 1000，分子中的 <code>r²</code> 和分母中的 <code>r²</code> 都会<strong>相互抵消</strong>。因此，从中心点看，任何一个完整的球面所张开的立体角**恒为 4π 球面度 (steradians)**。它是一个与半径无关的常数。</p>
<h3 id="1-5-辐射率-Radiance-L"><a href="#1-5-辐射率-Radiance-L" class="headerlink" title="1.5 辐射率 (Radiance, L)"></a>1.5 辐射率 (Radiance, L)</h3><h4 id="1-5-1-定义"><a href="#1-5-1-定义" class="headerlink" title="1.5.1 定义"></a>1.5.1 定义</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716182519.png" alt="image.png"></p>
<ul>
<li><strong>核心思想</strong>: 这是<strong>最全面、最根本</strong>的物理量，描述了<strong>一束光本身有多亮</strong>。</li>
<li><strong>花洒类比</strong>: 你站在地面上，抬头<strong>看向花洒的某一个方向</strong>，你感知到的“那束水流”的亮度。</li>
<li><strong>定义</strong>: 辐射率是指一个表面发射、反射、传输或接收的，在特定方向上<strong>单位立体角</strong>、<strong>单位投影面积</strong>的**功率 (Power)**。</li>
<li><strong>公式</strong>:<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716182547.png" alt="image.png"></li>
<li><strong>单位</strong>: 瓦特 / (球面度 · 平方米) 即 **W/(sr·m²)**。这个单位也被称为“尼特 (nit)”。</li>
</ul>
<p>Radiance 结合了前面概念的精髓：</p>
<ul>
<li>它和 <strong>Intensity</strong> 一样，是<strong>有方向的</strong>（单位立体角）。</li>
<li>它和 <strong>Irradiance</strong> 一样，是和<strong>面积相关的</strong>（单位面积）。</li>
</ul>
<h4 id="1-5-2-核心区别：实际面积-vs-投影面积-cosθ-的由来"><a href="#1-5-2-核心区别：实际面积-vs-投影面积-cosθ-的由来" class="headerlink" title="1.5.2 核心区别：实际面积 vs. 投影面积 (cosθ 的由来)"></a>1.5.2 核心区别：实际面积 vs. 投影面积 (<code>cosθ</code> 的由来)</h4><p>这是理解辐射率的关键，也是它与辐照度的根本不同之处。</p>
<ul>
<li><strong>Irradiance (辐照度)</strong>: 关心的是落在<strong>实际表面积</strong> ($dA$) 上的总功率。</li>
<li><strong>Radiance (辐射率)</strong>: 关心的是沿着特定光线方向的性质，所以它衡量的不是实际表面积，而是垂直于光线方向的<strong>投影面积</strong> ($dA^⊥$)。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716182700.png" alt="image.png"></p>
<p>图中的 <strong>实际表面积</strong> ($dA$) 是 <code>irradiance</code> 中定义所对应的，而垂直于光线方向的<strong>投影面积</strong> ($dA^⊥$) 才是 <code>radiance</code> 中所定义的面积。</p>
<p>二者之间的关系为 :</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716183329.png" alt="image.png"></p>
<p>我们用“投影面积”而不是“实际面积”，是为了创造一个能够描述物体表面<strong>内在亮度</strong>的物理量，这个量不应该随着我们的观察角度而改变。<code>cosθ</code> 这个因子就是用来抵消因视角变化带来的能量变化，从而得到一个更加本质和恒定的物理量——**辐射率 (Radiance)**。</p>
<p><span style="color: #badc58; font-weight: 550;">第一部分：理解“内在亮度”和“视角变化”</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716210732.png" alt="image.png"></p>
<p><span style="color: #badc58; font-weight: 550;">第二部分：<code>cosθ</code> 如何“抵消”影响</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716210811.png" alt="image.png"></p>
<p>这句话的意思就是：通过在定义中<strong>人为地</strong>加入一个 <code>cosθ</code>（通过使用投影面积），我们成功地抵消了物理世界中因视角变化而产生的另一个 <code>cosθ</code> 效应。这样一“除”，我们就得到了一个不依赖于视角、能够真正代表物体表面“内在亮度”的、干净纯粹的物理量。</p>
<h4 id="1-5-3-辐射率-Radiance-L-和-辐照度-Irradiance-E-的关系"><a href="#1-5-3-辐射率-Radiance-L-和-辐照度-Irradiance-E-的关系" class="headerlink" title="1.5.3 辐射率 (Radiance, L) 和 辐照度 (Irradiance, E) 的关系"></a>1.5.3 辐射率 (Radiance, L) 和 辐照度 (Irradiance, E) 的关系</h4><p>既然辐射率描述了来自<strong>单一方向</strong>的光有多亮，那么一个表面感受到的<strong>总亮度</strong>（即辐照度）就是<strong>所有方向</strong>射入的辐射率的总和。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716191615.png" alt="image.png"></p>
<ul>
<li><strong>第一步：来自一个方向的贡献</strong><ul>
<li>来自单个微小方向 <code>dω</code> 的入射光 <code>Lᵢ</code> 对表面产生的辐照度贡献 <code>dE</code> 为：<br>  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716191503.png" alt="image.png"></li>
<li>这里的 <code>Lᵢ</code> 指的是入射的辐射率 (incident radiance)。这个公式是 radiance 定义式的直接变体。</li>
</ul>
</li>
<li><strong>第二步：对所有方向积分</strong><ul>
<li>为了得到 <code>p</code> 点的总辐照度 <code>E(p)</code>，我们需要将来自上方<strong>整个半球 (H²)</strong> 所有方向的贡献进行积分：<br>  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716191548.png" alt="image.png"></li>
</ul>
</li>
</ul>
<p>这个积分公式是<strong>渲染方程 (Rendering Equation)</strong> 的基础，其物理意义非常直观：</p>
<ul>
<li>一个点 (微分面积元) 所接收到的<strong>总光照 (Irradiance)<strong>，等于所有从其上方半球射入的光线</strong>亮度 (Radiance)</strong> 的<strong>加权总和</strong>。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250716181652.png" alt="image.png|425"></p>
<p><strong><code>cosθ</code> 的角色</strong>: 这个因子在这里充当<strong>权重</strong>。</p>
<ul>
<li>当光线<strong>垂直射入</strong>表面 (θ = 0°, cosθ = 1) 时，它对总光照的<strong>贡献最大</strong>。</li>
<li>当光线以<strong>掠射角度</strong>射入 (θ → 90°, cosθ → 0) 时，它的<strong>贡献趋近于零</strong>。</li>
</ul>
<p>这完美地解释了为什么一个表面被正对方向的光照射时最亮，而当光从侧面照射时则较暗。</p>
<h2 id="2-双向反射分布函数-BRDF"><a href="#2-双向反射分布函数-BRDF" class="headerlink" title="2 双向反射分布函数 (BRDF)"></a>2 双向反射分布函数 (BRDF)</h2><h3 id="2-1-概览"><a href="#2-1-概览" class="headerlink" title="2.1 概览"></a>2.1 概览</h3><p>简单来说，BRDF 是一个数学函数，它描述了光线在到达一个不透明物体表面后，会如何向<strong>各个不同方向</strong>反射。</p>
<blockquote>
<p> 它描述的不是光只被反射到一个方向，而是被<strong>分布</strong>到出射方向的整个半球空间。它告诉我们，在所有可能的出射方向上，光线能量是如何分布的。</p>
</blockquote>
<p>它的核心作用是回答下面这个问题：</p>
<ul>
<li>对于从<strong>某个特定方向 (<code>ωᵢ</code>)</strong> 射入的<strong>单位能量</strong>的光，有多少比例的能量会被反射到**另一个特定方向 (<code>ωₒ</code>)**？</li>
</ul>
<p>举个例子：</p>
<ul>
<li>对于一个<strong>完美的镜子</strong>，如果你从 A 方向用手电筒照射，BRDF 会告诉你 100% 的光都会被反射到 B 方向（镜面反射方向），而其他任何方向的反射光能量都为 0。</li>
<li>对于一块<strong>理想的白墙（漫反射表面）</strong>，BRDF 会告诉你，无论光从哪个方向来，它都会被均匀地反射到所有方向。所以你从任何角度看这面墙，它的亮度都差不多。</li>
<li>对于一个<strong>有光泽的塑料球</strong>，BRDF 会告诉你，大部分光会被均匀反射（漫反射），但在一小片区域（高光区域），会有非常强的镜面反射。</li>
</ul>
<h3 id="2-2-核心思想：两步能量转换过程"><a href="#2-2-核心思想：两步能量转换过程" class="headerlink" title="2.2 核心思想：两步能量转换过程"></a>2.2 核心思想：两步能量转换过程</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717101024.png" alt="image.png|661"></p>
<p>将一个点上的反射过程分解为两个基本步骤：</p>
<ul>
<li><strong>能量的接收</strong>: 入射的光（以<strong>辐射率 Radiance</strong> 形式存在）到达物体表面，其能量被表面吸收，转化成了表面的**辐照度 (Irradiance)**。</li>
<li><strong>能量的再分配</strong>: 表面接收到的能量（辐照度）又会作为“新光源”，向外反射出去，形成出射的**辐射率 (Radiance)**。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">具体步骤解析：</span></p>
<p><span style="color: #9c88ff; font-weight: 550;">第一步：</span>入射 (Incoming) - 从 “光线亮度” 到 “表面照度”</p>
<ul>
<li>一束光从方向 <code>ωᵢ</code> 射向物体表面的一个点 <code>x</code>。这束光本身具有**辐射率 (Radiance)**，记为 <code>L(ωᵢ)</code>。</li>
<li>当这束光照射到表面时，它为该点贡献了一小部分能量。这个单位面积接收到的能量，就是**微分辐照度 (Differential Irradiance)**，记为 <code>dE(ωᵢ)</code>。</li>
<li>它们之间的关系由以下公式给出：<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717101519.png" alt="image.png"></li>
</ul>
<p>这个公式的意义是：从 <code>ωᵢ</code> 方向来的光，对表面的辐照度贡献，取决于光本身的亮度 <code>L(ωᵢ)</code> 以及它的入射角度（由 <code>cosθᵢ</code> 体现）。</p>
<p><span style="color: #9c88ff; font-weight: 550;">第二步：</span>出射 (Exiting) - 从 “表面照度” 到 “反射光亮度”</p>
<ul>
<li>刚刚接收到的那一小部分能量 <code>dE(ωᵢ)</code>，现在将作为动力，向外反射出去。</li>
<li>反射出去的光，在观察方向 <code>ωᵣ</code> 上，形成了一个**微分出射辐射率 (Differential Exiting Radiance)**，记为 <code>dLᵣ(ωᵣ)</code>。</li>
<li><strong>因果关系</strong>: <code>dLᵣ(ωr)</code> 的产生，完全是由于 <code>dE(ωᵢ)</code> 的贡献。</li>
</ul>
<p>这里就会产生一个问题：<strong>输入 (<code>dE</code>) 和输出 (<code>dL</code>) 之间的比例关系是什么？</strong></p>
<h3 id="2-3-核心定义"><a href="#2-3-核心定义" class="headerlink" title="2.3 核心定义"></a>2.3 核心定义</h3><p>BRDF 是一个函数，它描述了**从任意一个入射方向 <code>ωᵢ</code> 射入的光，会如何被一个表面反射到任意一个出射方向 <code>ωᵣ</code>**。简单来说，它定义了材质的反射特性。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717102150.png" alt="image.png|637"></p>
<ul>
<li><strong>Lᵢ(x, ωᵢ)</strong>: 从 <code>ωᵢ</code> 方向入射的**辐射率 (Radiance)**，代表入射光的“亮度”。</li>
<li><strong>dLᵣ(x, ωᵣ)</strong>: 被反射到 <code>ωᵣ</code> 方向的**微分辐射率 (Differential Radiance)**，代表反射光的“亮度”。</li>
</ul>
<p>BRDF 的数学定义是<strong>出射辐射率</strong>与<strong>入射辐照度</strong>的比值</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717102719.png" alt="image.png"></p>
<ul>
<li><strong>dLr​(ωr​) (分子)</strong>: 这是<strong>输出</strong>。它代表从表面反射到 <code>ωᵣ</code> 方向的光的微分辐射率，即我们<strong>观察到的亮度</strong>。</li>
<li><strong>dEi​(ωi​) (分母)</strong>: 这是<strong>输入</strong>。它代表从 <code>ωᵢ</code> 方向入射的光在表面上产生的微分辐照度，即<strong>表面接收到的能量</strong>。</li>
<li><strong>单位</strong>: BRDF 的单位是 <strong>1/sr</strong> (每球面度)。这表明它不是一个简单的 0-1 之间的比例，而是一个<strong>密度</strong>函数。</li>
</ul>
<h2 id="3-反射方程-The-Reflection-Equation"><a href="#3-反射方程-The-Reflection-Equation" class="headerlink" title="3 反射方程 (The Reflection Equation)"></a>3 反射方程 (The Reflection Equation)</h2><p>反射方程用一个非常优雅的数学形式，描述了一个非常直观的物理事实：</p>
<ul>
<li>我们从某个方向看到一个点有多亮（出射辐射率 Radiance），等于<strong>所有</strong>可能方向射入的光线（入射辐射率 Radiance），经过该点材质反射（BRDF）之后，汇集到我们观察方向的总和。</li>
</ul>
<p>简单来说，一个点的最终颜色，是它接收到的<strong>所有光照</strong>的总效果。</p>
<ul>
<li>在 <code>ωᵣ</code> 方向的总亮度，等于来自<strong>所有</strong>入射方向 <code>ωᵢ</code> 的光所贡献的亮度之和。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717103308.png" alt="image.png|623"></p>
<p>下面是该方程中各参数详解：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717105011.png" alt="image.png|671"></p>
<p>这里要注意一点：</p>
<ul>
<li>方程中的入射光 $L_r$ 本身也是场景中其他物体的出射光 $L_r$，类似“鸡生蛋，蛋生鸡”，这使得该方程是一个无法直接求解的<strong>递归积分方程</strong>。如何用数值方法近似求解它，正是<strong>路径追踪 (Path Tracing)</strong> 等现代渲染算法要解决的核心问题。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717105858.png" alt="image.png"></p>
<h2 id="4-渲染方程-Rendering-Equation"><a href="#4-渲染方程-Rendering-Equation" class="headerlink" title="4 渲染方程 (Rendering Equation)"></a>4 渲染方程 (Rendering Equation)</h2><p>反射方程只能描述一个点<strong>反射</strong>的光，无法描述一个点<strong>自身发光</strong>的情况。例如，它能描述一张木桌如何反射光，但无法描述一个亮着的灯泡灯丝。</p>
<p>为了让方程变得通用，能够描述宇宙中任何物体（无论是反光体还是发光体）的表面光照情况，我们必须为其增加一个<strong>发光项</strong>。</p>
<ul>
<li><strong>出射光 = 自身发光 + 反射光</strong></li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717110304.png" alt="image.png|787"></p>
<ul>
<li>$(n⋅ω_i​)$: 这是 <code>cosθᵢ</code> 的向量表示法，通过表面法线 <code>n</code> 和入射光方向 <code>ωᵢ</code> 的点积来计算，两者都是单位向量时结果等价。</li>
</ul>
<p>这个方程的物理意义非常清晰，它说明了<strong>从一个点 <code>p</code> 沿 <code>ωₒ</code> 方向出射的总光线</strong>由两部分组成：</p>
<ol>
<li>$L_e​(p,ω_o​)$ (<strong>自身发光部分</strong>)<ul>
<li>这是**发光项 (Emission term)**。它代表点 <code>p</code> 自己作为光源，向 <code>ωₒ</code> 方向发射的辐射率。</li>
<li>对于绝大多数不发光的物体（如桌子、墙壁、椅子），这一项为 0。</li>
<li>对于光源本身（如灯丝、火焰、发光的屏幕），这一项是一个非零值，代表了它自身的亮度。</li>
</ul>
</li>
<li>$∫Ω+​…$ (<strong>反射部分</strong>)<ul>
<li>这是我们熟悉的<strong>反射积分项</strong>。它代表所有来自上半球 <code>Ω+</code> (即 <code>H²</code>) 的入射光 <code>Lᵢ</code>，经过点 <code>p</code> 表面材质 (BRDF, <code>$f_r$</code>) 的反射后，汇集到 <code>ωₒ</code> 方向的总和。</li>
</ul>
</li>
</ol>
<p>下来从一个点光源和单个物体的场景开始理解渲染方程：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717110747.png" alt="image.png|787"></p>
<blockquote>
<p> 点光源对一个点来说自然只有一个方向有入射光，所以这里没有了积分</p>
</blockquote>
<p>多个点光源一个物体的情况：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717110839.png" alt="image.png|805"></p>
<blockquote>
<p> 将这些所有的点光源的贡献全部求和即可</p>
</blockquote>
<p>那么如果点光源变成了面光源呢？如下图所示：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717110917.png" alt="image.png|758"></p>
<blockquote>
<p> 其实面光源就相当于无穷多个点光源的集合，只需要对面光源所在的立体角范围进行积分，并且能够确定不同立体角方向的面光源的入射光 radiance 即可。</p>
</blockquote>
<p>那么更进一步的，再在场景当中加入其它物体，使得物体之间发生光线交互之后是什么情况呢：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717111224.png" alt="image.png"></p>
<blockquote>
<p> 这里 -ωᵢ 是因为我们指定了ωᵢ的方向为 x-&gt;x’</p>
</blockquote>
<p>一个点 <code>x</code> 接收到的光，并不仅仅来自场景中的<strong>直接光源</strong>（比如图中的太阳），还来自<strong>其他物体表面反射过来的光</strong>。</p>
<p>为了计算这种“二手光”或“间接光”，我们必须把<strong>场景中的每一个物体都看作是一个潜在的面光源</strong>，对其所占立体角进行积分即可。</p>
<p>只不过对其它物体的立体角积分不像是面光源所有入射方向都有 radiance，物体的立体角可能只有个别几个方向有入射的 radiance (即多次物体间光线反射之后恰好照射到着色点 x)，其它方向没有，但本质上都可以视作是面光源。</p>
<ul>
<li><strong>主动光源 (Active Light Source)</strong><ul>
<li>这就是我们传统意义上的灯泡或太阳。</li>
<li>它的特点是<strong>自身发光</strong>（<code>Lₑ</code> 项不为零），并且通常会向其周围的<strong>所有方向</strong>辐射能量。</li>
</ul>
</li>
<li><strong>被动光源 (Passive Light Source)</strong><ul>
<li>这就是“其它物体”。比如，一面红色的墙。</li>
<li>它自身不发光（<code>Lₑ</code> 项为零）。它能成为“光源”，完全是<strong>因为它反射了来自别处的光</strong>。</li>
<li>它<strong>不会像灯泡那样向所有方向发光</strong>。它只会从<strong>接收到光的方向</strong>，再将光反射出去。</li>
</ul>
</li>
</ul>
<p>观察一下图中的渲染方程可以发现除了两个 radiance，其它所有项都是知道的</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717112954.png" alt="image.png|642"></p>
<p>我们可以把这个积分看作一个整体的“动作”或“操作”。这个操作的作用是什么呢？</p>
<ul>
<li>它的<strong>输入</strong>是：一个入射光场 $L_r$ (即场景中当前所有的光照分布)。</li>
<li>它的<strong>动作</strong>是：将输入的 $L_r$，在半球 <code>Ω+</code> 上的所有方向进行积分，并且在积分的每一步都乘上 BRDF (<code>fᵣ</code>) 和 <code>cosθ</code>。</li>
<li>它的<strong>输出</strong>是：经过这番计算后，得到的<strong>所有反射光的总和</strong>。</li>
</ul>
<p>我们就把这个复杂的“动作”打包起来，给它起一个名字，叫做**光线传输算子 (Light Transport Operator)**，用大写字母 <strong><code>K</code></strong> 表示。</p>
<p>所以，算子 <code>K</code> 的定义就是：</p>
<ul>
<li><code>K</code> 是一个“机器”，你把一个<strong>光照分布函数</strong>（比如 <code>L</code>）喂给它，它就会吐出这个光照分布经过场景中所有表面进行一次反射之后，形成的<strong>新光照分布</strong>。</li>
</ul>
<p>故可以将上式进一步写成如下所示的式子：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717113006.png" alt="image.png|555"></p>
<p>其中 </p>
<ul>
<li>等式左侧 L 就是想要求得的<strong>新光照分布函数</strong></li>
<li>等式右侧，E 就是光源的自发光项，KL 即对 <strong>旧光照分布函数</strong> 进行算子操作</li>
</ul>
<p>每迭代一次，我们都把前一次的结果当作“旧”的输入，计算出更精确的“新”的输出。这个过程，在物理上就等于模拟了光线在场景中一次又一次的弹射。</p>
<p>当“新”的结果和“旧”的结果差别非常非常小，几乎不再变化时，我们就认为迭代收敛了，此时的 <code>L</code> 就满足了 <code>L = E + KL</code> 这个平衡状态，也就是我们要求的最终解。</p>
<ul>
<li>想象一下，当场景中的光线经过了无穷次的反弹，最终稳定了下来。这时，整个场景的光照分布就是 <code>L</code>。</li>
<li>在这个<strong>已经稳定</strong>的最终时刻：<ul>
<li>等式左边的 <code>L</code> 是指这个最终的光照分布。</li>
<li>等式右边的 <code>L</code> 也是指<strong>同一个</strong>最终的光照分布。</li>
</ul>
</li>
</ul>
<p>因为我们是在描述<strong>同一个未知量 <code>L</code></strong> 在一个平衡等式中的关系，所以左边的 <code>L</code> 和右边的 <code>L</code> 是<strong>完全相同</strong>的变量。因此，我们可以像解普通代数方程一样，对它进行移项、合并、提取公因式等操作：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142230.png" alt="image.png"></p>
<p>其中 $I$ 为单位矩阵，再接着对 $(I−K)^{-1}$ 使用广义二项式定理得到：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142311.png" alt="image.png"></p>
<p>仔细观察这个式子，注意 E 是光源所发出的光，K 为反射算子，这样一个式子的物理含义如下图所示：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142410.png" alt="image.png|711"></p>
<p><span style="color: #badc58; font-weight: 550;">渲染方程的本质：</span>一个场景的最终样貌，是光源自身的光 $E$、直接光照 $KE$、一次间接光照 $K^2E$、二次间接光照 $K^3E$……直至无穷多次间接光照的线性叠加。</p>
<p>下面看一个例子：</p>
<p>一次反射：一次直接光照</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142659.png" alt="image.png|651"></p>
<p>两次反射：一次间接光照</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142723.png" alt="image.png|667"></p>
<p>三次反射：二次间接光照:</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717142837.png" alt="image.png|612"></p>
<p>考虑次数越多越接近真实图片效果，趋近收敛</p>
<h1 id="蒙特卡洛路径追踪-Monte-Carlo-Path-Tracing"><a href="#蒙特卡洛路径追踪-Monte-Carlo-Path-Tracing" class="headerlink" title="蒙特卡洛路径追踪 (Monte Carlo Path Tracing)"></a>蒙特卡洛路径追踪 (Monte Carlo Path Tracing)</h1><blockquote>
<p> 之前，我们通过对辐射度量学当中一系列概念的定义，引入了渲染方程，一个正确的光线传播模型，但并没有去涉及如何解出该渲染方程，或者说如何通过该渲染方程计算出屏幕上每一个坐标的像素值。在这一章节会利用蒙特卡洛路径追踪来完成这个目标</p>
</blockquote>
<h2 id="1-前置知识：概率论"><a href="#1-前置知识：概率论" class="headerlink" title="1 前置知识：概率论"></a>1 前置知识：概率论</h2><h3 id="1-1-随机变量和概率密度函数"><a href="#1-1-随机变量和概率密度函数" class="headerlink" title="1.1 随机变量和概率密度函数"></a>1.1 随机变量和概率密度函数</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717180848.png" alt="image.png|504"></p>
<p><span style="color: #badc58; font-weight: 550;">随机变量 (Random Variable)</span></p>
<ul>
<li><strong>符号</strong>: $X$</li>
<li><strong>定义</strong>: 一个随机变量不代表一个固定的值，而是代表一个随机过程中所有<strong>潜在结果的集合</strong>。它本身表示的是一种分布。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">概率密度函数 (Probability Density Function, PDF)</span></p>
<ul>
<li><strong>符号</strong>: $X∼p(x)$</li>
<li><strong>定义</strong>: 概率密度函数 $p(x)$ 描述了一个随机变量 X 取某一个具体值 $x$ 的<strong>相对可能性</strong>（或概率）。</li>
<li>符号 <code>~</code> 的意思是“服从于…分布”。所以 $X∼p(x)$ 读作：“随机变量 X 服从于概率密度函数 $p(x)$”。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">均匀分布 (Uniform PDF)</span></p>
<ul>
<li>在一个给定的范围内（定义域），所有可能出现的值，其发生的<strong>概率是完全相等</strong>的。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717181109.png" alt="image.png|700"></p>
<h3 id="1-2-离散型概览分布"><a href="#1-2-离散型概览分布" class="headerlink" title="1.2 离散型概览分布"></a>1.2 离散型概览分布</h3><h4 id="1-2-1-概率分布的基本要素"><a href="#1-2-1-概率分布的基本要素" class="headerlink" title="1.2.1 概率分布的基本要素"></a>1.2.1 概率分布的基本要素</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717182547.png" alt="image.png"></p>
<ul>
<li>一个随机事件有 <code>n</code> 个离散的、可能的结果，记为 $x_i$​ (例如，掷骰子的结果 1, 2, 3, 4, 5, 6)。</li>
<li>每一个结果 $x_i$​ 的发生都有一个对应的<strong>概率</strong>，记为 $p_i$​。</li>
<li>图中的柱状图直观地展示了这种关系：每个结果 $x_i$​ 对应一个高度为 $p_i$​ 的“柱子”。</li>
</ul>
<h4 id="1-2-2-概率分布必须满足的两个条件"><a href="#1-2-2-概率分布必须满足的两个条件" class="headerlink" title="1.2.2 概率分布必须满足的两个条件"></a>1.2.2 概率分布必须满足的两个条件</h4><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717182850.png" alt="image.png|606"></p>
<ul>
<li><strong>概率非负性</strong>: 任何一个可能结果的概率都必须大于或等于零。</li>
<li><strong>归一化</strong>: 所有可能结果的概率之和必须<strong>恒等于 1</strong>。（通俗讲，所有可能性加起来必然是 100%，必然有一个结果会发生。）</li>
</ul>
<h3 id="1-3-随机变量的期望值"><a href="#1-3-随机变量的期望值" class="headerlink" title="1.3 随机变量的期望值"></a>1.3 随机变量的期望值</h3><p><span style="color: #badc58; font-weight: 550;">什么是期望值？</span></p>
<ul>
<li><strong>直观定义</strong>: 期望值是一个随机事件在<strong>大量重复试验</strong>后，所有可能结果的<strong>平均值</strong>。它代表了对一个随机变量长期表现的“期望”或“预测”。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">如何计算期望值？</span></p>
<p>对于一个有 <code>n</code> 个离散结果的随机变量 <code>X</code>（每个结果为 $x_i$​，其对应的概率为 $p_i$​），其期望值 <code>E[X]</code> 的计算方法是： 将每一个可能的结果 $x_i$​ 与其对应的概率 $p_i​$ 相乘，然后将所有这些乘积相加。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717183125.png" alt="image.png"></p>
<p>用掷骰子的例子来演示期望值的计算：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717183210.png" alt="image.png|677"></p>
<h3 id="1-4-连续型概率分布函数-Continuous-Probability-Distribution-Function-PDF"><a href="#1-4-连续型概率分布函数-Continuous-Probability-Distribution-Function-PDF" class="headerlink" title="1.4 连续型概率分布函数 (Continuous Probability Distribution Function, PDF)"></a>1.4 连续型概率分布函数 (Continuous Probability Distribution Function, PDF)</h3><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717183315.png" alt="image.png"></p>
<ul>
<li><strong>核心区别</strong>: 与离散情况（如掷骰子，结果只能是 1, 2, 3, 4, 5, 6）不同，一个<strong>连续型随机变量 <code>X</code></strong> 的取值可以是某个区间内的<strong>任何一个数</strong>。</li>
<li><strong>概率密度函数 (PDF) <code>p(x)</code></strong>: 在连续情况下，<code>p(x)</code> 不再是代表单个点发生的概率，而是描述了随机变量在 <code>x</code> 点附近取值的<strong>相对可能性</strong>或<strong>密度</strong>。函数的图形是一条曲线，如图中所示的高斯分布（正态分布）曲线。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">连续型 PDF 必须满足的条件</span></p>
<p>这与离散情况的两个条件非常相似，只是把“求和”操作换成了“积分”操作：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717192333.png" alt="image.png|583"></p>
<p><span style="color: #badc58; font-weight: 550;">连续型随机变量的期望值 (Expected Value)</span></p>
<p>计算期望值的思想与离散情况完全一样（值 × 概率的加权平均），只是同样地，求和符号 <code>∑</code> 被替换成了积分符号 <code>∫</code>。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717192431.png" alt="image.png"></p>
<h3 id="1-5-随机变量的函数"><a href="#1-5-随机变量的函数" class="headerlink" title="1.5 随机变量的函数"></a>1.5 随机变量的函数</h3><p><strong>基本思想</strong>: 如果 <code>X</code> 是一个随机变量（其值是随机的），那么对 <code>X</code> 应用一个函数 <code>f</code> 之后得到的新变量 <code>Y = f(X)</code>，其本身也<strong>是一个随机变量</strong>。</p>
<p><strong>数学描述</strong>:</p>
<ul>
<li>我们有一个随机变量 <code>X</code>，它服从于概率密度为 <code>p(x)</code> 的分布。($X∼p(x)$)</li>
<li>我们定义一个新的随机变量 <code>Y</code>，它是 <code>X</code> 的函数。($Y=f(X)$)</li>
</ul>
<p>计算 <code>Y</code> 的期望值 <code>E[Y]</code>（也就是 <code>E[f(X)]</code>）的方法非常直观：</p>
<ul>
<li><strong>思想</strong>: 它依然是一个<strong>加权平均</strong>。我们不再是对原来的值 <code>x</code> 进行加权平均，而是对<strong>经过函数 <code>f</code> 变换后的新值 <code>f(x)</code></strong> 进行加权平均。而这个权重，依然是原先 <code>x</code> 出现的概率密度 <code>p(x)</code>。</li>
<li><strong>数学公式 (连续情况)</strong>:<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717192753.png" alt="image.png"></li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">直观的例子（离散情况）</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717192843.png" alt="image.png"></p>
<h2 id="2-蒙特卡洛积分-Monte-Carlo-Integration"><a href="#2-蒙特卡洛积分-Monte-Carlo-Integration" class="headerlink" title="2 蒙特卡洛积分 (Monte Carlo Integration)"></a>2 蒙特卡洛积分 (Monte Carlo Integration)</h2><h3 id="2-1-核心思想"><a href="#2-1-核心思想" class="headerlink" title="2.1 核心思想"></a>2.1 核心思想</h3><p>简单来说，<strong>蒙特卡洛积分是一种用“随机撒点”的方式来估算定积分数值的方法。</strong> </p>
<p>它的核心思想是：在一个区域内随机撒下大量的点，通过计算落在特定图形内的点的比例，来估算出这个图形的面积或积分值。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717193442.png" alt="image.png|596"></p>
<p><span style="color: #badc58; font-weight: 550;">计算一个确定的定积分：</span></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717194538.png" alt="image.png"></p>
<p>求 $f(x)$ 的积分，无非就是求如下图的面积</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717193712.png" alt="image.png|767"></p>
<ul>
<li><strong>引入概率分布</strong>：直接计算上述积分可能很困难。该方法不直接积分，而是引入一个我们已知的、容易抽样的概率密度函数（PDF）$p(x)$。</li>
<li><strong>变换形式</strong>：将原积分巧妙地改写成一个<strong>期望值</strong>的形式。</li>
<li><strong>用采样均值近似期望</strong>：根据大数定律，一个随机变量的期望值可以通过大量采样的均值来近似。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717195018.png" alt="image.png"></p>
<p>特别地，当 $p(x)$ 为均匀分布时，</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717195323.png" alt="image.png"></p>
<p>定积分 $\int_{a}^{b} f(x) dx$ 的值可以有如下蒙特卡洛<strong>估计量</strong>：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717195245.png" alt="image.png|298"></p>
<h2 id="3-路径追踪-Path-Tracing"><a href="#3-路径追踪-Path-Tracing" class="headerlink" title="3 路径追踪 (Path Tracing)"></a>3 路径追踪 (Path Tracing)</h2><h3 id="3-1-传统的光线追踪（Whitted-Style-Ray-Tracing）算法的局限性"><a href="#3-1-传统的光线追踪（Whitted-Style-Ray-Tracing）算法的局限性" class="headerlink" title="3.1 传统的光线追踪（Whitted-Style Ray Tracing）算法的局限性"></a>3.1 传统的光线追踪（Whitted-Style Ray Tracing）算法的局限性</h3><p><span style="color: #badc58; font-weight: 550;">1、只处理完美镜面反射和折射</span></p>
<ul>
<li>只处理完美的镜面反射（specular reflections）和折射（refractions），就像镜子或纯净的玻璃。</li>
<li>现实世界中大量的材质既不是完美的镜子，也不是完全的漫反射，而是介于两者之间的光泽 (Glossy) 材质，比如有磨砂感的金属。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717200021.png" alt="image.png"></p>
<ul>
<li><strong>Whitted-Style Ray Tracing</strong>：只能模拟出左图“犹他茶壶”那样的<strong>镜面反射</strong>，影像清晰锐利。</li>
<li><strong>真实世界/路径追踪</strong>：能够模拟出右图那种带有<strong>模糊效果的光泽反射</strong>。</li>
</ul>
<p><span style="color: #badc58; font-weight: 550;">2、忽略了漫反射表面之间的光线弹射（间接光照）</span></p>
<ul>
<li>当光线碰到漫反射（diffuse）表面（如石膏墙、大多数塑料等没有光泽的表面）时，就停止继续弹射。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717200029.png" alt="image.png"></p>
<p><strong>左图（直接光照）</strong>：这是 Whitted-Style Ray Tracing 的结果。光线只从光源直接照到物体表面。结果是：</p>
<ul>
<li>天花板和盒子的阴影部分是纯黑的，因为没有光线直接照到它们。</li>
<li>墙壁之间没有颜色渗透，红墙就是红墙，绿墙就是绿墙。</li>
</ul>
<p><strong>右图（全局光照）</strong>：这是更真实的路径追踪结果。算法模拟了光线在漫反射表面之间的多次弹射。结果是：</p>
<ul>
<li><strong>颜色渗透（Color Bleeding）</strong>：红墙的光反弹到白色的天花板和墙壁上，使它们染上了一层红色；绿墙同理。</li>
<li><strong>间接照明</strong>：整个场景被照亮，天花板和阴影区域不再是纯黑，因为它们接收到了从地面和墙壁反弹过来的光线。</li>
</ul>
<h3 id="3-2-求解渲染方程"><a href="#3-2-求解渲染方程" class="headerlink" title="3.2 求解渲染方程"></a>3.2 求解渲染方程</h3><h4 id="3-2-1-基本思路"><a href="#3-2-1-基本思路" class="headerlink" title="3.2.1 基本思路"></a>3.2.1 基本思路</h4><p>回顾一下上篇文章中所得到的渲染方程：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717200726.png" alt="image.png"></p>
<p>要解这个方程，主要面临两个挑战：</p>
<ul>
<li><strong>积分的计算</strong>：这是一个在半球面上进行的复杂积分，很难用解析方法求解。</li>
<li><strong>递归形式</strong>：方程是递归的。因为入射光 $L_i​$ 来自于场景中的其他物体表面，而那些物体表面的出射光同样也由渲染方程决定。</li>
</ul>
<p>而解决这些难点自然就要利用上节中所提到的蒙特卡洛积分方法了。</p>
<p>在进行具体计算前，为了方便推导，对渲染方程做了一个简化：<strong>暂时忽略物体自身的发光项 $L_e$​</strong></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717200810.png" alt="image.png"></p>
<blockquote>
<p> 因为通常一个点在接收其他物体传来的光并进行反射时，它本身并不是一个光源</p>
</blockquote>
<p>从具体例子出发，首先仅仅考虑直接光照：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717200834.png" alt="image.png"></p>
<blockquote>
<p> 注意 ：这里针对的是<strong>面光源</strong>，对于点光源其实可以用一个小面表示</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717201015.png" alt="image.png"></p>
<p>针对简化后的渲染方程，我们应该把这个方程看作一个<strong>纯粹的数学积分计算</strong>。其物理含义是计算从着色点 <code>p</code> 到达摄像机或人眼的光的辐射亮度（Radiance）值。</p>
<p>对于任何一个难以计算的积分，只要为它的<strong>被积变量</strong>选择一个<strong>采样概率分布</strong>，就可以通过多次采样来得到积分的近似值。</p>
<p>在这个具体的渲染方程中：</p>
<ul>
<li><strong>被积变量</strong>是入射光的立体角（方向），即 $ω_i​$。</li>
<li><strong>被积函数</strong>是积分号内部的整个表达式，即 $L_i​(p,ωi​)f_r​(…)(n⋅ωi​)$。</li>
</ul>
<p>我们首先需要为被积变量 $ω_i$​ 定义一个概率密度函数（PDF），记为 $p(ω_i​)$。这意味着我们将根据这个概率分布来随机地生成入射光线的方向。</p>
<p>直接套用前面学到的通用蒙特卡洛估计公式，即 $\text{积分} \approx \frac{1}{N} \sum  \frac{\text{被积函数}}{\text{概率密度}}$，就可以得到渲染方程的近似解：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717201434.png" alt="image.png"></p>
<blockquote>
<p> 特别地，在半球方向上进行均匀采样时， $p(\omega_i) = 1/2\pi$，因为整个球体的立方角为 $4\pi$，半个即为 $2\pi$，均匀分布的概率密度就是其总面积的倒数。</p>
</blockquote>
<p>正如一开始所说，先单独考虑直接光照，因此只有当采样的方向 $ω_i$ 击中光源的时候，光源才会对该着色点有贡献，计算伪代码如下：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717203113.png" alt="image.png|884"></p>
<p>显而易见的，仅仅考虑直接光照是不够的，必须加入<strong>间接光照</strong>。</p>
<p>间接光照发生在当从着色点 $P$ 发出的采样光线 $ω_i​$ 没有击中光源，而是击中了场景中的<strong>另一个普通物体 Q</strong> 时，如下图：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717203215.png" alt="image.png|889"></p>
<p>这时，物体 Q 本身会反射光线到点 P。我们需要计算这部分光的贡献。</p>
<blockquote>
<p> 这个过程解释了“路径追踪”这个名字的由来：算法通过递归地追踪光线弹射，寻找从光源到眼睛的可行路径。</p>
</blockquote>
<p>从物体 Q 反射到点 P 的光有多少？</p>
<p>记从 Q 点沿相反方向 ($−ω_i​$) 射出的光为 $L_o​(Q,−ω_i​)$，其值可以通过<strong>递归调用 <code>shade</code> 函数自身</strong>来完成，即 <code>shade(q, -wi)</code>。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717205153.png" alt="image.png|849"></p>
<p>至此，我们成功通过蒙特卡洛的方式解出了渲染方程的积分值，也通过考虑直接光照与间接光照解决了递归的问题。但该方法至此有一个非常致命的缺陷</p>
<h4 id="3-2-2-“致命缺陷”：光线数量爆炸"><a href="#3-2-2-“致命缺陷”：光线数量爆炸" class="headerlink" title="3.2.2 “致命缺陷”：光线数量爆炸"></a>3.2.2 “致命缺陷”：光线数量爆炸</h4><p>上述的递归函数内，有一个 <code>for</code> 循环</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717210208.png" alt="image.png"></p>
<p>如果 N = 100，即一个像素发射出 100 条光线（第一次采样），当这些光线击中物体后，每个交点再各自发射 100 条光线来计算间接光照，那么第二次反射就需要追踪 <code>100 * 100 = 10,000</code> 条光线。再下一次就是 <code>100万</code> 条，计算量会迅速变得无法承受。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717210336.png" alt="image.png|690"></p>
<p>如何避免光线数量爆炸？答案是釜底抽薪——在<strong>每次</strong>光线与物体发生交互时，<strong>只随机采样一个方向</strong>继续追踪，即设置 <code>N=1</code>。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717210407.png" alt="image.png"></p>
<ul>
<li><code>shade</code> 函数内部不再有 <code>For</code> 循环来求平均。</li>
<li>函数的逻辑变为：随机选择<strong>一个</strong>方向 $w_i$，投射光线，然后根据击中的是光源还是物体，直接返回那<strong>一条路径</strong>的计算结果。</li>
<li>之前的 <code>(1/N)</code> 因子也自然消失了，因为 <code>N=1</code>。</li>
</ul>
<h4 id="3-2-3-解决新问题：高噪声-Noisy"><a href="#3-2-3-解决新问题：高噪声-Noisy" class="headerlink" title="3.2.3 解决新问题：高噪声 (Noisy)"></a>3.2.3 解决新问题：高噪声 (Noisy)</h4><p><strong>新问题</strong>：如果每次弹射只采样一条路径，那么单次完成的整条“从相机到光源”的路径追踪结果会极具随机性，导致计算出的颜色值<strong>噪声非常大</strong>，完全不可用。</p>
<p><span style="color: #badc58; font-weight: 550;">真正的解决方案</span>：<strong>将“求平均”的操作从“递归函数的内部”移到了“像素渲染的顶层”</strong>，通过平均多条完整路径的结果来对抗单条路径的高噪声。</p>
<ul>
<li>这个问题的解决方法，也是路径追踪算法的精髓所在：<strong>不要指望一次性就算对一个像素的颜色</strong>。</li>
<li>我们应该做的是，对<strong>同一个像素</strong>，重复<strong>多次</strong>执行这个“每次弹射只追踪一条光线”的完整过程。</li>
<li>也就是说，我们从相机发射多条<strong>独立的、完整的路径</strong>穿过同一个像素，每一条路径都会得到一个（有噪声的）颜色值。</li>
<li>最后，将这<strong>所有路径的颜色值进行平均</strong>，得到该像素最终的、平滑的颜色。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717210655.png" alt="image.png|800"></p>
<blockquote>
<p>上图对一个 pixel 追踪了三条不同的光线</p>
</blockquote>
<p>这个“<strong>在每个点上只追一个随机方向，但对整个像素追很多条独立路径来求平均</strong>”的策略，就是路径追踪算法能够以可控的计算量、无偏地逼近真实物理光照效果的根本原因。</p>
<p>对应的伪代码如下：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717211000.png" alt="image.png|879"></p>
<p>那么现在所有的问题都解决了吗？还没有！因为 shade 函数的递归没有出口，永远不会停下。</p>
<h4 id="3-2-4-递归函数-shade-的结束条件"><a href="#3-2-4-递归函数-shade-的结束条件" class="headerlink" title="3.2.4 递归函数 shade 的结束条件"></a>3.2.4 递归函数 shade 的结束条件</h4><blockquote>
<p><code>shade</code> 函数的递归调用没有出口，如果光线一直在物体之间弹射，理论上这个递归会永远进行下去，导致程序无法终止。</p>
</blockquote>
<p>解决方案不是像传统光线追踪那样设置一个固定的最大反射深度，而是采用一种更优雅的、基于概率的随机算法——<strong>俄罗斯轮盘赌</strong>。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717211838.png" alt="image.png|670"></p>
<ul>
<li>我们预先设定一个概率 <code>P</code>（比如 <code>P=0.8</code>），代表光线“存活”的概率。</li>
<li>在每次光线需要进行下一次弹射时（即每次递归调用 <code>shade</code> 函数时），我们进行一次“赌博”：<ul>
<li>有 <code>P</code> 的概率，光线存活，继续进行下一次弹射的计算。</li>
<li>有 <code>1-P</code> 的概率，光线“死亡”，递归被终止，该路径的贡献直接被记为 0。</li>
</ul>
</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717212036.png" alt="image.png|337"></p>
<p><span style="color: #badc58; font-weight: 550;">保持无偏估计：能量补偿</span></p>
<p><strong>问题</strong>：如果我们随机地“杀死”一部分光线路径（以 <code>1-P</code> 的概率），那么最终得到的图像能量会系统性地偏低，导致结果变暗，这是一种有偏（biased）的估计。</p>
<p>下面通过一个例子感受一下：</p>
<ul>
<li>我们要计算一个班级 <strong>10</strong> 个同学的总捐款数。我们提前知道，<strong>每个同学都捐了 10 元</strong>。所以，真实的总额应该是 10 人×10 元/人=100 元。这个“100 元”就相当于我们想要求的真实光照结果 $L_o​$。</li>
<li>随机找到了 8 个同学，问他们捐了多少。他们都说“10 元”，如果我们直接把这个“80 元”作为最终结果，那显然是<strong>错误</strong>的。它比真实的“100 元”要少。因为我们系统性地漏掉了 2 个同学，所以我们的估计<strong>系统性地偏低</strong>了。这就是<strong>有偏估计（Biased Estimate）</strong>。</li>
<li>现在进行关键的<strong>能量补偿</strong>：我们把这个不完整的总额，<strong>除以我们采样的概率 P</strong>。<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717212855.png" alt="image.png"></li>
</ul>
<p>同样地，为了保持估计的无偏性，我们必须对“存活”下来的光线进行<strong>能量补偿</strong>。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717213011.png" alt="image.png|556"></p>
<ul>
<li>具体做法是：当一条光线以 <code>P</code> 的概率存活下来时，我们将它计算出的贡献值**除以概率 <code>P</code>**。</li>
<li><strong>原理</strong>：通过将存活路径的贡献放大 <code>1/P</code> 倍，我们把那些被“杀死”的路径所“损失”的能量，在统计意义上平均地补偿了回来。</li>
</ul>
<p>shade 函数的伪代码变更如下，使得可以停止递归了：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717213055.png" alt="image.png|760"></p>
<h4 id="3-2-5-效率问题"><a href="#3-2-5-效率问题" class="headerlink" title="3.2.5 效率问题"></a>3.2.5 效率问题</h4><p>至此，我们的路径追踪算法已经完成大半，只差最后一个小问题！现在的路径追踪效率非常的低下，如图所示：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717213122.png" alt="image.png|833"></p>
<p>尽管之前的路径追踪算法（在半球面上随机采样方向）在理论上是正确的，但它的<strong>效率非常低</strong>。</p>
<p><strong>原因</strong>：当场景中的光源很小的时候，随机向半球空间发射的大部分光线（比如 5000 条里有 4995 条）都<strong>无法击中光源</strong>。对于直接光照的计算而言，这些没有击中光源的光线贡献为零，它们的计算完全被浪费了，这导致最终图像的收敛速度极慢，充满噪声（噪点）。</p>
<p><span style="color: #badc58; font-weight: 550;">解决方案：改变采样策略</span></p>
<p><strong>核心思想</strong>：与其“盲目地”向空间中发射光线并“期望”能撞上光源，不如反过来，<strong>直接在光源的表面上选择采样点</strong>。这是一种更聪明的<strong>重要性采样（Importance Sampling）</strong>，因为我们知道所有直接光照都必然来自光源。</p>
<p>要实现这一点，我们必须重写渲染方程。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717213555.png" alt="image.png"></p>
<p>原来的方程是关于<strong>立体角（方向）$dω$</strong> 的积分，我们需要把它转换成一个关于<strong>光源面积 $dA$</strong> 的积分。</p>
<p>故我们要找出，在观察点 $x$ 处，一个位于点 $x^{‘}$ 的微小面积元 $dA$ 所张成的微小立体角 $dω$ 是多少。</p>
<p>这个推导可以分为两个关键步骤：</p>
<ol>
<li>**投影缩减 (Foreshortening)**：计算 $dA$ 朝向观察点 <strong>x</strong> 的有效面积。<ul>
<li>记从 <strong>x’</strong> 指向 <strong>x</strong> 的向量是 <strong>v</strong>，面积元 $dA$ 垂直于向量 <strong>v</strong> 的投影面积 $dA_perp$ 就是：<br><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717214418.png" alt="image.png"></li>
<li>这个 $dA_perp$ 就是在 <strong>x’</strong> 点处、距离为 r 的球面上，我们“看到”的 dA 的实际大小。</li>
</ul>
</li>
<li>**距离缩放 (Distance Scaling)**：将这个有效面积从其所在位置（距离为 $r$）缩放到单位球面上。<ul>
<li>我们如何将在半径为 r 的球面上的面积，转换到半径为 1 的球面上的面积呢？</li>
<li>这遵循一个简单的几何关系：球面上的面积与半径的平方成正比。一个在半径为 r 的球面上的区域，其面积是在半径为 1 的球面上对应区域面积的 $r^2$ 倍。</li>
<li>因此，要将在半径为 r 的球面上的面积 $A_r$ 转换到单位球面上的面积 $A_1$，我们需要除以 $r^2$</li>
</ul>
</li>
</ol>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717213455.png" alt="image.png|762"></p>
<ul>
<li>$cosθ^′$ 是光源表面法线与光线方向的夹角余弦：代表了光源表面自身的朝向。如果光源表面是侧对着着色点（theta′ 趋近 90°），那么它贡献的光就越少。</li>
<li>$∣x′−x∣^2$ 是着色点与光源采样点之间的距离平方。着色点离光源越远，接收到的能量就越少</li>
</ul>
<p>将上述转换公式代入原有的渲染方程，积分就从对半球方向 Ω+ 的积分，变成了对光源表面积 A 的积分</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717215258.png" alt="image.png"></p>
<p>这个新形式的方程，其被积变量是光源上的一个点，它直接包含了距离、两个表面姿态等几何信息（通常被称为<strong>几何项 G</strong>）。</p>
<p>这个转换使得我们可以用蒙特卡洛方法直接对<strong>光源面积</strong>进行采样（比如在光源表面上均匀选择点，此时 p(x′)=1/A），从而高效地计算<strong>直接光照</strong>。</p>
<p>最终伪代码如下，分直接光照和间接光照两部分计算：</p>
<ul>
<li><strong>计算直接光照</strong>：专门调用一个函数，通过<strong>直接在光源上采样</strong>来计算。对于场景中的每一个光源，都在其表面上随机取一点，计算其对着色点的贡献，<span style="color: #9c88ff; font-weight: 550;">并检查中间有无遮挡。</span></li>
<li><strong>计算间接光照</strong>：仍然使用之前的方法，即在半球面上随机采样一个方向（<strong>N=1</strong>），如果击中一个非光源物体，则<strong>递归调用</strong>渲染函数，并用<strong>俄罗斯轮盘赌</strong>来终止路径。</li>
</ul>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717215439.png" alt="image.png|734"></p>
<p>计算直接光照的时候还需要判断光源与着色点之间是否有物体遮挡，该做法也很简单，只需从着色点 x 向光源采样点 x’ 发出一条检测光线判断是否与光源之外的物体相交即可，如图所示:</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717215650.png" alt="image.png|823"></p>
<p>如果存在遮挡，那么这个光源采样点 <code>x&#39;</code> 实际上对 <code>p</code> 点没有任何光照贡献，因为 <code>p</code> 点位于该采样点所投下的阴影之中。</p>
<p>最终效果：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717220726.png" alt="image.png|802"></p>
<h2 id="4-需要深入探究的点"><a href="#4-需要深入探究的点" class="headerlink" title="4 需要深入探究的点"></a>4 需要深入探究的点</h2><p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/20250717220517.png" alt="image.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://VernalScenery.github.io">Scenery</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://vernalscenery.github.io/2025/07/17/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/08_GAMES101_%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_02/">https://vernalscenery.github.io/2025/07/17/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/08_GAMES101_%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_02/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://VernalScenery.github.io" target="_blank">春和景明的记事本</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/GAMES101/">GAMES101</a></div><div class="post_share"><div class="social-share" data-image="/./img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/18/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/01_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%84%9F%E7%9F%A5%E6%9C%BA/" title="01_机器学习_感知机"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">01_机器学习_感知机</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/14/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/08_GAMES101_%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA_01/" title="08_GAMES101_光线追踪_01"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">08_GAMES101_光线追踪_01</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2025/06/26/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/02_GAMES101_%E5%90%91%E9%87%8F%E4%B8%8E%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" title="02_GAMES101_向量与线性代数"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-26</div><div class="title">02_GAMES101_向量与线性代数</div></div></a></div><div><a href="/2025/06/26/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/01_GAMES101_%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6%E6%A6%82%E8%BF%B0/" title="01_GAMES101_计算机图形学概述"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-26</div><div class="title">01_GAMES101_计算机图形学概述</div></div></a></div><div><a href="/2025/07/10/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/01_GAMES101%E6%80%BB%E7%BB%93%E7%89%88_%E7%A9%BA%E9%97%B4%E5%8F%98%E6%8D%A2/" title="01_GAMES101总结版_空间变换"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-10</div><div class="title">01_GAMES101总结版_空间变换</div></div></a></div><div><a href="/2025/06/26/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/03_GAMES101_%E5%8F%98%E6%8D%A2(%E4%BA%8C%E7%BB%B4%E4%B8%8E%E4%B8%89%E7%BB%B4)/" title="03_GAMES101_变换(二维与三维)"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-06-26</div><div class="title">03_GAMES101_变换(二维与三维)</div></div></a></div><div><a href="/2025/07/11/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/02_GAMES101%E6%80%BB%E7%BB%93%E7%89%88_%E5%85%89%E6%A0%85%E5%8C%96/" title="02_GAMES101总结版_光栅化"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-11</div><div class="title">02_GAMES101总结版_光栅化</div></div></a></div><div><a href="/2025/07/01/%E5%9B%BE%E5%BD%A2%E5%AD%A6/Games101/06_GAMES101_%E7%9D%80%E8%89%B2/" title="06_GAMES101_着色"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2025-07-01</div><div class="title">06_GAMES101_着色</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Scenery</div><div class="author-info__description">今天不想跑，所以才去跑</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">73</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/chjm0121" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1595718686@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%89%A9%E7%90%86%E6%B8%B2%E6%9F%93%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-text">基于物理渲染的基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%BE%90%E5%B0%84%E5%BA%A6%E9%87%8F%E5%AD%A6"><span class="toc-text">1 辐射度量学</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%A6%82%E8%A7%88"><span class="toc-text">1.1 概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E8%BE%90%E5%B0%84%E8%83%BD%E9%87%8F-Radiant-Energy-Q-%E5%92%8C-%E8%BE%90%E5%B0%84%E9%80%9A%E9%87%8F-Radiant-Flux-%CE%A6"><span class="toc-text">1.2 辐射能量 (Radiant Energy, Q) 和 辐射通量 (Radiant Flux, Φ)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%BE%90%E5%B0%84%E5%BC%BA%E5%BA%A6-Radiant-Intensity-I"><span class="toc-text">1.3 辐射强度 (Radiant Intensity, I)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">1.3.1 定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E7%AB%8B%E4%BD%93%E8%A7%92-Solid-Angle"><span class="toc-text">1.3.2 立体角 (Solid Angle)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-3-%E5%BE%AE%E5%88%86%E7%AB%8B%E4%BD%93%E8%A7%92-d%CF%89"><span class="toc-text">1.3.3 微分立体角 dω</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-4-%E8%BE%90%E5%B0%84%E5%BC%BA%E5%BA%A6-Radiant-Intensity-%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-text">1.3.4 辐射强度 (Radiant Intensity) 的本质</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-5-%E5%90%84%E5%90%91%E5%90%8C%E6%80%A7%E7%82%B9%E5%85%89%E6%BA%90-Isotropic-Point-Source"><span class="toc-text">1.3.5 各向同性点光源 (Isotropic Point Source)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%BE%90%E7%85%A7%E5%BA%A6-Irradiance-E"><span class="toc-text">1.4 辐照度 (Irradiance, E)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">1.4.1 定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-2-%E5%BD%B1%E5%93%8D%E5%9B%A0%E7%B4%A0%E4%B8%80%EF%BC%9A%E5%85%A5%E5%B0%84%E8%A7%92%E5%BA%A6-Lambert%E2%80%99s-Law"><span class="toc-text">1.4.2 影响因素一：入射角度 (Lambert’s Law)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-3-%E5%BD%B1%E5%93%8D%E5%9B%A0%E7%B4%A0%E4%BA%8C%EF%BC%9A%E8%B7%9D%E7%A6%BB-Irradiance-Falloff"><span class="toc-text">1.4.3 影响因素二：距离 (Irradiance Falloff)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E8%BE%90%E5%B0%84%E7%8E%87-Radiance-L"><span class="toc-text">1.5 辐射率 (Radiance, L)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-%E5%AE%9A%E4%B9%89"><span class="toc-text">1.5.1 定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-%E6%A0%B8%E5%BF%83%E5%8C%BA%E5%88%AB%EF%BC%9A%E5%AE%9E%E9%99%85%E9%9D%A2%E7%A7%AF-vs-%E6%8A%95%E5%BD%B1%E9%9D%A2%E7%A7%AF-cos%CE%B8-%E7%9A%84%E7%94%B1%E6%9D%A5"><span class="toc-text">1.5.2 核心区别：实际面积 vs. 投影面积 (cosθ 的由来)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-3-%E8%BE%90%E5%B0%84%E7%8E%87-Radiance-L-%E5%92%8C-%E8%BE%90%E7%85%A7%E5%BA%A6-Irradiance-E-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">1.5.3 辐射率 (Radiance, L) 和 辐照度 (Irradiance, E) 的关系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%8F%8C%E5%90%91%E5%8F%8D%E5%B0%84%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0-BRDF"><span class="toc-text">2 双向反射分布函数 (BRDF)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A6%82%E8%A7%88"><span class="toc-text">2.1 概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3%EF%BC%9A%E4%B8%A4%E6%AD%A5%E8%83%BD%E9%87%8F%E8%BD%AC%E6%8D%A2%E8%BF%87%E7%A8%8B"><span class="toc-text">2.2 核心思想：两步能量转换过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%A0%B8%E5%BF%83%E5%AE%9A%E4%B9%89"><span class="toc-text">2.3 核心定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%8F%8D%E5%B0%84%E6%96%B9%E7%A8%8B-The-Reflection-Equation"><span class="toc-text">3 反射方程 (The Reflection Equation)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B-Rendering-Equation"><span class="toc-text">4 渲染方程 (Rendering Equation)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA-Monte-Carlo-Path-Tracing"><span class="toc-text">蒙特卡洛路径追踪 (Monte Carlo Path Tracing)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86%EF%BC%9A%E6%A6%82%E7%8E%87%E8%AE%BA"><span class="toc-text">1 前置知识：概率论</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F%E5%92%8C%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%87%BD%E6%95%B0"><span class="toc-text">1.1 随机变量和概率密度函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%A6%BB%E6%95%A3%E5%9E%8B%E6%A6%82%E8%A7%88%E5%88%86%E5%B8%83"><span class="toc-text">1.2 离散型概览分布</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E7%9A%84%E5%9F%BA%E6%9C%AC%E8%A6%81%E7%B4%A0"><span class="toc-text">1.2.1 概率分布的基本要素</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%BF%85%E9%A1%BB%E6%BB%A1%E8%B6%B3%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%9D%A1%E4%BB%B6"><span class="toc-text">1.2.2 概率分布必须满足的两个条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F%E7%9A%84%E6%9C%9F%E6%9C%9B%E5%80%BC"><span class="toc-text">1.3 随机变量的期望值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E8%BF%9E%E7%BB%AD%E5%9E%8B%E6%A6%82%E7%8E%87%E5%88%86%E5%B8%83%E5%87%BD%E6%95%B0-Continuous-Probability-Distribution-Function-PDF"><span class="toc-text">1.4 连续型概率分布函数 (Continuous Probability Distribution Function, PDF)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E9%9A%8F%E6%9C%BA%E5%8F%98%E9%87%8F%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-text">1.5 随机变量的函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%92%99%E7%89%B9%E5%8D%A1%E6%B4%9B%E7%A7%AF%E5%88%86-Monte-Carlo-Integration"><span class="toc-text">2 蒙特卡洛积分 (Monte Carlo Integration)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%A0%B8%E5%BF%83%E6%80%9D%E6%83%B3"><span class="toc-text">2.1 核心思想</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA-Path-Tracing"><span class="toc-text">3 路径追踪 (Path Tracing)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%BC%A0%E7%BB%9F%E7%9A%84%E5%85%89%E7%BA%BF%E8%BF%BD%E8%B8%AA%EF%BC%88Whitted-Style-Ray-Tracing%EF%BC%89%E7%AE%97%E6%B3%95%E7%9A%84%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-text">3.1 传统的光线追踪（Whitted-Style Ray Tracing）算法的局限性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%B1%82%E8%A7%A3%E6%B8%B2%E6%9F%93%E6%96%B9%E7%A8%8B"><span class="toc-text">3.2 求解渲染方程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%9F%BA%E6%9C%AC%E6%80%9D%E8%B7%AF"><span class="toc-text">3.2.1 基本思路</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E2%80%9C%E8%87%B4%E5%91%BD%E7%BC%BA%E9%99%B7%E2%80%9D%EF%BC%9A%E5%85%89%E7%BA%BF%E6%95%B0%E9%87%8F%E7%88%86%E7%82%B8"><span class="toc-text">3.2.2 “致命缺陷”：光线数量爆炸</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-3-%E8%A7%A3%E5%86%B3%E6%96%B0%E9%97%AE%E9%A2%98%EF%BC%9A%E9%AB%98%E5%99%AA%E5%A3%B0-Noisy"><span class="toc-text">3.2.3 解决新问题：高噪声 (Noisy)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-4-%E9%80%92%E5%BD%92%E5%87%BD%E6%95%B0-shade-%E7%9A%84%E7%BB%93%E6%9D%9F%E6%9D%A1%E4%BB%B6"><span class="toc-text">3.2.4 递归函数 shade 的结束条件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-5-%E6%95%88%E7%8E%87%E9%97%AE%E9%A2%98"><span class="toc-text">3.2.5 效率问题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E9%9C%80%E8%A6%81%E6%B7%B1%E5%85%A5%E6%8E%A2%E7%A9%B6%E7%9A%84%E7%82%B9"><span class="toc-text">4 需要深入探究的点</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/29/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/13_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%A6%82%E7%8E%87%E5%9B%BE%E6%A8%A1%E5%9E%8B/" title="13_机器学习_概率图模型">13_机器学习_概率图模型</a><time datetime="2025-07-29T00:29:02.000Z" title="发表于 2025-07-29 08:29:02">2025-07-29</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/11_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E8%81%9A%E7%B1%BB/" title="11_机器学习_聚类">11_机器学习_聚类</a><time datetime="2025-07-28T00:19:53.000Z" title="发表于 2025-07-28 08:19:53">2025-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/28/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/12_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E9%99%8D%E7%BB%B4/" title="12_机器学习_降维">12_机器学习_降维</a><time datetime="2025-07-27T20:48:42.000Z" title="发表于 2025-07-28 04:48:42">2025-07-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/26/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/10_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E9%9B%86%E6%88%90%E5%AD%A6%E4%B9%A0/" title="10_机器学习_集成学习">10_机器学习_集成学习</a><time datetime="2025-07-26T01:58:53.000Z" title="发表于 2025-07-26 09:58:53">2025-07-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/07/25/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/%E5%9F%BA%E7%A1%80%E5%8E%9F%E7%90%86/09_%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0_%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF/" title="09_机器学习_朴素贝叶斯">09_机器学习_朴素贝叶斯</a><time datetime="2025-07-25T03:08:47.000Z" title="发表于 2025-07-25 11:08:47">2025-07-25</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Scenery</div><div class="footer_custom_text"><div>波澜不惊</div><div class="footer-div"><img class="footer-icon" src="./img/备案图标.png"><a class="footer-a" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">皖ICP备2021016944号-1</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@5.2.0/instantpage.min.js" type="module"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>