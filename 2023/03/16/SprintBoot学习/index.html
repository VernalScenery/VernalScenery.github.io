<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>SprintBoot学习 | 春和景明的记事本</title><meta name="keywords" content="博客"><meta name="author" content="Scenery"><meta name="copyright" content="Scenery"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="SprintBoot 框架课配置 Mysql 与注册登录模块1. Mysql1.1 mysql 服务的关闭与启动 默认开机自动启动，如果想手动操作，可以参考如下命令 启动 mysql5.7 版本不需要加 80，直接net start mysql   关闭：net stop mysql80 启动：net start mysql80  1.2 常用操作 连接用户名为root，密码为123456的数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="SprintBoot学习">
<meta property="og:url" content="https://vernalscenery.github.io/2023/03/16/SprintBoot%E5%AD%A6%E4%B9%A0/index.html">
<meta property="og:site_name" content="春和景明的记事本">
<meta property="og:description" content="SprintBoot 框架课配置 Mysql 与注册登录模块1. Mysql1.1 mysql 服务的关闭与启动 默认开机自动启动，如果想手动操作，可以参考如下命令 启动 mysql5.7 版本不需要加 80，直接net start mysql   关闭：net stop mysql80 启动：net start mysql80  1.2 常用操作 连接用户名为root，密码为123456的数据库">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://vernalscenery.github.io/img/1.jpg">
<meta property="article:published_time" content="2023-03-16T09:24:19.000Z">
<meta property="article:modified_time" content="2023-03-17T01:05:46.000Z">
<meta property="article:author" content="Scenery">
<meta property="article:tag" content="博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://vernalscenery.github.io/img/1.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://vernalscenery.github.io/2023/03/16/SprintBoot%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SprintBoot学习',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-17 09:05:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/./img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/./img/1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">春和景明的记事本</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">SprintBoot学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-16T09:24:19.000Z" title="发表于 2023-03-16 17:24:19">2023-03-16</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-03-17T01:05:46.000Z" title="更新于 2023-03-17 09:05:46">2023-03-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>35分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SprintBoot学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="SprintBoot-框架课"><a href="#SprintBoot-框架课" class="headerlink" title="SprintBoot 框架课"></a>SprintBoot 框架课</h1><h2 id="配置-Mysql-与注册登录模块"><a href="#配置-Mysql-与注册登录模块" class="headerlink" title="配置 Mysql 与注册登录模块"></a>配置 Mysql 与注册登录模块</h2><h3 id="1-Mysql"><a href="#1-Mysql" class="headerlink" title="1. Mysql"></a>1. Mysql</h3><h4 id="1-1-mysql-服务的关闭与启动"><a href="#1-1-mysql-服务的关闭与启动" class="headerlink" title="1.1 mysql 服务的关闭与启动"></a>1.1 mysql 服务的关闭与启动</h4><blockquote>
<p>默认开机自动启动，如果想手动操作，可以参考如下命令</p>
<p>启动 mysql5.7 版本不需要加 80，直接<code>net start mysql</code></p>
</blockquote>
<ul>
<li>关闭：<code>net stop mysql80</code></li>
<li>启动：<code>net start mysql80</code></li>
</ul>
<h4 id="1-2-常用操作"><a href="#1-2-常用操作" class="headerlink" title="1.2 常用操作"></a>1.2 常用操作</h4><ul>
<li>连接用户名为<code>root</code>，密码为<code>123456</code>的数据库服务：<code>mysql -uroot -p123456</code></li>
<li><code>show databases</code>：列出所有数据库</li>
<li><code>create database kob</code>：创建数据库</li>
<li><code>drop database kob</code>：删除数据库</li>
<li><code>use kob</code>：使用数据库 kob</li>
<li><code>show tables</code>：列出当前数据库的所有表</li>
<li><code>create table user(id int, username varchar(100))</code>：创建名称为 user 的表，表中包含 id 和 username 两个属性。</li>
<li><code>drop table user</code>：删除表</li>
<li><code>insert into user values(1, &#39;yxc&#39;)</code>：在表中插入数据</li>
<li><code>select * from user</code>：查询表中所有数据</li>
<li><code>delete from user where id = 2</code>：删除某行数据</li>
</ul>
<p><strong>SpringBoot 中可以可视化 mysql 数据库</strong></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226093901090.png" alt="image-20230226093901090"></p>
<h3 id="2-SpringBoot-配置-mysql"><a href="#2-SpringBoot-配置-mysql" class="headerlink" title="2. SpringBoot 配置 mysql"></a>2. SpringBoot 配置 mysql</h3><ol>
<li><p>在<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a>中查找如下依赖，并添加到<code>pom.xml</code>文件中：</p>
<ul>
<li><p><strong>Spring Boot Starter JDBC</strong></p>
<blockquote>
<p>JDBCTemplate 为我们提供了增删改查数据库的方法</p>
</blockquote>
</li>
<li><p><strong>Project Lombok</strong></p>
<blockquote>
<p>Lombok 是一种 Java 实用工具，可用来帮助开发人员消除 Java 的冗长，尤其是对于简单的 Java 对象（POJO）。它通过注释实现这一目的。通过在开发环境中实现 Lombok，开发人员可以节省构建诸如 hashCode() 和 equals() 这样的方法以及以往用来分类各种 accessor 和 mutator 的大量时间。</p>
</blockquote>
<p>使用 Lombok：</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226101449302.png" alt="image-20230226101449302" style="zoom: 54%;" />

<p>源文件：</p>
  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226101742593.png" alt="image-20230226101742593" style="zoom: 67%;" />

<p>生成的 target 后的文件：</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226101336841.png" alt="image-20230226101336841" style="zoom:67%;" /></li>
<li><p><strong>MySQL Connector/J</strong></p>
<blockquote>
<p>mysql 连接</p>
</blockquote>
</li>
<li><p><strong>mybatis-plus-boot-starter</strong></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chaizepeng/article/details/119384531">关于 mybatis</a>，使用 mybatis-plus 就不用写 sql 语句了</p>
</blockquote>
</li>
<li><p><strong>mybatis-plus-generator</strong></p>
<blockquote>
<p>生成 Mapper 接口和配置文件</p>
</blockquote>
<p><strong>MyBatis-Plus 最核心的功能要数通用 Mapper 了，只要我们的 Mapper 接口继承了 BaseMapper，就可以进行单表 CRUD 操作，具体接口见</strong><a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226102611248.png" alt="image-20230226102611248"></p>
</li>
</ul>
</li>
<li><p>然后让 Maven 更新依赖：</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226092348496.png" alt="image-20230226092348496"></p>
</li>
<li><p>在<code>application.properties</code>中添加数据库配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.username=root</span><br><span class="line">spring.datasource.password=<span class="number">123456</span></span><br><span class="line">spring.datasource.url=jdbc:mysql:<span class="comment">//localhost:3307/kob?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8</span></span><br><span class="line">spring.datasource.driver-<span class="class"><span class="keyword">class</span>-<span class="title">name</span></span>=com.mysql.cj.jdbc.Driver</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>注意：在安装上述依赖后，建议关闭如下选项：</strong></p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226093421511.png" alt="image-20230226093421511" style="zoom: 67%;" />

<h3 id="3-接口编写整体流程"><a href="#3-接口编写整体流程" class="headerlink" title="3.接口编写整体流程"></a>3.接口编写整体流程</h3><h4 id="3-1-SpringBoot-中的各个层"><a href="#3-1-SpringBoot-中的各个层" class="headerlink" title="3.1 SpringBoot 中的各个层"></a>3.1 SpringBoot 中的各个层</h4><ul>
<li><code>pojo</code>层：将数据库中的表对应成<code>Java</code>中的<code>Class</code></li>
<li><code>mapper</code>层（也叫<code>Dao</code>层）：将<code>pojo</code>层的<code>class</code>中的操作，映射成<code>sql</code>语句</li>
<li><code>service</code>层：写具体的业务逻辑，组合使用<code>mapper</code>中的操作</li>
<li><code>controller</code>层：负责请求转发，接受页面过来的参数，传给<code>Service</code>处理，接到返回值，再传给页面</li>
</ul>
<h4 id="3-2-具体实现"><a href="#3-2-具体实现" class="headerlink" title="3.2 具体实现"></a>3.2 具体实现</h4><p>文件目录如下：</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226111207030.png" alt="image-20230226111207030" style="zoom:67%;" />

<ol>
<li>首先在<code>pojo</code>层新建<code>User</code>类，数据库中的<code>User</code>表对应成<code>Java</code>中的<code>User</code>类。</li>
</ol>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226111347059.png" alt="image-20230226111347059" style="zoom:67%;" />

<ol start="2">
<li>然后在<code>mapper</code>层中新建<code>UserMapper</code>接口，让其继承 MyBatis-Plus 库实现的 BaseMapper，这样就可以对<code>user</code>表 CRUD 操作，具体 CRUD 操作 API 见<a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a></li>
</ol>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226111507605.png" alt="image-20230226111507605" style="zoom:67%;" />

<ol start="3">
<li><p>然后在<code>controller</code>层中实现接口</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230226112059568.png" alt="image-20230226112059568" style="zoom:67%;" />

<ul>
<li><p><code>@RestController</code>：个人理解是指定接口返回数据的规范，相关理解可参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/justn0w/p/11628287.html">这个网站</a></p>
</li>
<li><p><code>@Autowired</code>：可以对类成员变量、方法及构造函数进行标注，让 <code>spring</code> 完成<code> bean自动装配</code>的工作。默认是按照类去匹配，配合@<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Qualifier&spm=1001.2101.3001.7020">Qualifier</a> 指定按照名称去装配 bean。</p>
<blockquote>
<p>在使用 Spring 进行项目开发的时候，会大量使用到自动装配，那自动装配是什么呢？简单来说：Spring 利用依赖注入（DI）功能，完成 SpringIOC 容器中各个组件之间的依赖关系赋值管理。</p>
</blockquote>
</li>
<li><p><code>@GetMapping</code>：GET 接口</p>
</li>
<li><p><code>selectList</code>方法是<code>userMapper</code>继承的父类<code>BaseMapper</code>（<code>MyBatis-Plus</code>库实现)中的<code>API</code>，详情见<a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a></p>
</li>
</ul>
</li>
</ol>
<h3 id="4-修改-Spring-Security"><a href="#4-修改-Spring-Security" class="headerlink" title="4. 修改 Spring Security"></a>4. 修改 Spring Security</h3><h4 id="4-1-安装相关依赖"><a href="#4-1-安装相关依赖" class="headerlink" title="4.1 安装相关依赖"></a>4.1 安装相关依赖</h4><ol>
<li><p>在<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a>中查找如下依赖，并添加到<code>pom.xml</code>文件中，并更新 Maven 依赖</p>
<ul>
<li>spring-boot-starter-security</li>
</ul>
</li>
<li><p>然后重启项目后，访问相关端口需要先登录。<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227082643042.png" alt="image-20230227082643042"></p>
</li>
<li><p>username 默认为 user,密码为随机生成，见命令行。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227082620583.png" alt="image-20230227082620583"></p>
</li>
</ol>
<h4 id="4-2-修改-security"><a href="#4-2-修改-security" class="headerlink" title="4.2 修改 security"></a>4.2 修改 security</h4><ol>
<li><p>实现实现由数据库中的用户登录</p>
<ul>
<li>首先在如下目录中，新建 UserDetailsServiceImpl 类，继承自 UserDetailsService 接口，用来接入数据库信息</li>
</ul>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227090455634.png" alt="image-20230227090455634" style="zoom:67%;" />

<ul>
<li><p>UserDetailsServiceImpl 实现了根据 username 返回用户信息，用于登录验证，代码如下：</p>
<blockquote>
<p>这里会将数据库中该用户的 password 与用户输入的 password 进行比较，注意这里是明文比较，需要在数据库中的 password 字段前前加<code>&#123;noop&#125;</code>，表示密码没有加密。</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227092255287.png" alt="image-20230227092255287" style="zoom: 67%;" /></blockquote>
</li>
</ul>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227090546982.png" alt="image-20230227090546982" style="zoom:67%;" />

<ul>
<li>其中，UserDetailsImpl 为实现的工具，用于返回用户各种信息，该类继承于 implements，按<code>alt+insert</code>可自动补全父类中需要重写的方法，部分代码截图如下：</li>
</ul>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227090846640.png" alt="image-20230227090846640" style="zoom:60%;" />

<p>以上实现的为密码<strong>明文比较</strong>进行登录，还未对密码进行加密。</p>
</li>
<li><p>实现 config.SecurityConfig 类，用来实现用户密码的加密存储</p>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227093653414.png" alt="image-20230227093653414" style="zoom: 67%;" />

<blockquote>
<p>可以在 test 中进行测试，如图：</p>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227095103549.png" alt="image-20230227095103549" style="zoom:67%;" />
</blockquote>
<p>然后在新建用户时将 password 换为加密后的密码即可，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/user/add/&#123;userId&#125;/&#123;username&#125;/&#123;password&#125;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addUser</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> <span class="keyword">int</span> userId,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> String username,</span></span></span><br><span class="line"><span class="params"><span class="function">            <span class="meta">@PathVariable</span> String password)</span></span>&#123;</span><br><span class="line">        PasswordEncoder passwordEncoder = <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">        String encodePassword = passwordEncoder.encode(password);</span><br><span class="line">        User user = <span class="keyword">new</span> User(userId,username,encodePassword);</span><br><span class="line">        userMapper.insert(user);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Add User Successfully&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="5-jwt-验证"><a href="#5-jwt-验证" class="headerlink" title="5. jwt 验证"></a>5. jwt 验证</h3><h4 id="5-1-安装相关依赖"><a href="#5-1-安装相关依赖" class="headerlink" title="5.1 安装相关依赖"></a>5.1 安装相关依赖</h4><ol>
<li><p>在<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a>中查找如下依赖，并添加到<code>pom.xml</code>文件中，然后更新 maven 依赖：</p>
<ul>
<li><code>jjwt-api</code></li>
<li><code>jjwt-impl</code></li>
<li><code>jjwt-jackson</code></li>
</ul>
</li>
<li><p>实现<code>utils.JwtUtil</code>类，为<code>jwt</code>工具类，用来创建、解析<code>jwt token</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.JwtBuilder;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Jwts;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.SignatureAlgorithm;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.SecretKey;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> JWT_TTL = <span class="number">60</span> * <span class="number">60</span> * <span class="number">1000L</span> * <span class="number">24</span> * <span class="number">14</span>;  <span class="comment">// 有效期14天</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String JWT_KEY = <span class="string">&quot;SDFGjhdsfalshdfHFdsjkdsfds121232131afasdfac&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getUUID</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createJWT</span><span class="params">(String subject)</span> </span>&#123;</span><br><span class="line">        JwtBuilder builder = getJwtBuilder(subject, <span class="keyword">null</span>, getUUID());</span><br><span class="line">        <span class="keyword">return</span> builder.compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> JwtBuilder <span class="title">getJwtBuilder</span><span class="params">(String subject, Long ttlMillis, String uuid)</span> </span>&#123;</span><br><span class="line">        SignatureAlgorithm signatureAlgorithm = SignatureAlgorithm.HS256;</span><br><span class="line">        SecretKey secretKey = generalKey();</span><br><span class="line">        <span class="keyword">long</span> nowMillis = System.currentTimeMillis();</span><br><span class="line">        Date now = <span class="keyword">new</span> Date(nowMillis);</span><br><span class="line">        <span class="keyword">if</span> (ttlMillis == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ttlMillis = JwtUtil.JWT_TTL;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> expMillis = nowMillis + ttlMillis;</span><br><span class="line">        Date expDate = <span class="keyword">new</span> Date(expMillis);</span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setId(uuid)</span><br><span class="line">                .setSubject(subject)</span><br><span class="line">                .setIssuer(<span class="string">&quot;sg&quot;</span>)</span><br><span class="line">                .setIssuedAt(now)</span><br><span class="line">                .signWith(signatureAlgorithm, secretKey)</span><br><span class="line">                .setExpiration(expDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SecretKey <span class="title">generalKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] encodeKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SecretKeySpec(encodeKey, <span class="number">0</span>, encodeKey.length, <span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Claims <span class="title">parseJWT</span><span class="params">(String jwt)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        SecretKey secretKey = generalKey();</span><br><span class="line">        <span class="keyword">return</span> Jwts.parserBuilder()</span><br><span class="line">                .setSigningKey(secretKey)</span><br><span class="line">                .build()</span><br><span class="line">                .parseClaimsJws(jwt)</span><br><span class="line">                .getBody();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>实现<code>config.filter.JwtAuthenticationTokenFilter</code>类，用来验证<code>jwt token</code>，如果验证成功，则将<code>User</code>信息注入上下文中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.config.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kob.backend.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.pojo.User;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.service.impl.utils.UserDetailsImpl;</span><br><span class="line"><span class="keyword">import</span> com.kob.backend.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> org.jetbrains.annotations.NotNull;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.UsernamePasswordAuthenticationToken;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.context.SecurityContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.filter.OncePerRequestFilter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.FilterChain;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JwtAuthenticationTokenFilter</span> <span class="keyword">extends</span> <span class="title">OncePerRequestFilter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doFilterInternal</span><span class="params">(HttpServletRequest request, <span class="meta">@NotNull</span> HttpServletResponse response, <span class="meta">@NotNull</span> FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        String token = request.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasText(token) || !token.startsWith(<span class="string">&quot;Bearer &quot;</span>)) &#123;</span><br><span class="line">            filterChain.doFilter(request, response);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        token = token.substring(<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">        String userid;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Claims claims = JwtUtil.parseJWT(token);</span><br><span class="line">            userid = claims.getSubject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        User user = userMapper.selectById(Integer.parseInt(userid));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户名未登录&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserDetailsImpl loginUser = <span class="keyword">new</span> UserDetailsImpl(user);</span><br><span class="line">        UsernamePasswordAuthenticationToken authenticationToken =</span><br><span class="line">                <span class="keyword">new</span> UsernamePasswordAuthenticationToken(loginUser, <span class="keyword">null</span>, <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        SecurityContextHolder.getContext().setAuthentication(authenticationToken);</span><br><span class="line"></span><br><span class="line">        filterChain.doFilter(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>配置<code>config.SecurityConfig</code>类，放行登录、注册等接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.kob.backend.config.filter.JwtAuthenticationTokenFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.authentication.AuthenticationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtAuthenticationTokenFilter jwtAuthenticationTokenFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PasswordEncoder <span class="title">passwordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BCryptPasswordEncoder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AuthenticationManager <span class="title">authenticationManagerBean</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.authenticationManagerBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/user/account/token/&quot;</span>, <span class="string">&quot;/user/account/register/&quot;</span>).permitAll()</span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS).permitAll()</span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line"></span><br><span class="line">        http.addFilterBefore(jwtAuthenticationTokenFilter, UsernamePasswordAuthenticationFilter.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="5-2-编写-API"><a href="#5-2-编写-API" class="headerlink" title="5.2 编写 API"></a>5.2 编写 API</h4><ol>
<li><p>将数据库中的<code>id</code>域变为自增</p>
<ul>
<li>在数据库中将<code>id</code>列变为自增</li>
<li>在<code>pojo.User</code>类中添加注解：<code>@TableId(type = IdType.AUTO)</code></li>
</ul>
</li>
<li><p>实现<code>/user/account/token/</code>：验证用户名密码，验证成功后返回<code>jwt token</code>（令牌）</p>
<p><strong>注意：在 POST 方法中</strong></p>
<ul>
<li><p><code>@RequestBody</code>获取的是<code>axios</code>中<code>data</code>字段携带的数据</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227163918163.png" alt="image-20230227163918163" style="zoom:67%;" />

 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227164055094.png" alt="image-20230227164055094" style="zoom:67%;" /></li>
<li><p><code>@RequestParam</code>获取的是<code>axios</code>中<code>params</code>字段携带的数据</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227164252146.png" alt="image-20230227164252146" style="zoom:67%;" />

 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227164321030.png" alt="image-20230227164321030" style="zoom:67%;" /></li>
</ul>
</li>
<li><p>实现<code>/user/account/info/</code>：根据令牌返回用户信息</p>
</li>
<li><p>实现<code>/user/account/register/</code>：注册账号</p>
</li>
</ol>
<h2 id="编写-API-的总结"><a href="#编写-API-的总结" class="headerlink" title="编写 API 的总结"></a>编写 API 的总结</h2><ol>
<li><p>首先在 pojo 封装与数据库对应的类</p>
<blockquote>
<p>注意：数据库里字段命名用 create_time，pojo 里用驼峰命名 createTime</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227172944636.png" alt="image-20230227172944636"></p>
</li>
<li><p>在 mapper 层，实现<code>UserMapper</code>接口 让其继承<code>mybatis</code>封装的<code>BaseMapper</code>接口，该接口内定义了许多封装好的接口，用于查询数据库，这样就可以避免写 sql 语句了,相关 api 见<a target="_blank" rel="noopener" href="https://baomidou.com/">Mybatis-Plus 官网</a></p>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227174734447.png" alt="image-20230227174734447" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;  <span class="comment">// 让UserMapper接口继承mybatis封装的BaseMapper接口</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>然后在 service 层定义接口，并实现该接口。</p>
<ul>
<li><p>service 层整体目录：</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230227173402697.png" alt="image-20230227173402697" style="zoom:67%;" /></li>
<li><p><code>service/user/account/RegisterService</code>中定义接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">RegisterService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">register</span><span class="params">(String username, String password, String confirmedPassword)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>在<code>service/impl/user/account/RegisterService</code>中实现接口</p>
<p>public class RegisterServiceImpl implements RegisterService {<br>@Autowired<br>private UserMapper userMapper; // 继承了 mybatis 中的 BaseMapper 类 不用写 sql 语句了 直接调 api</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PasswordEncoder passwordEncoder;  <span class="comment">// 密码加密的接口</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">register</span><span class="params">(String username, String password, String confirmedPassword)</span> </span>&#123;</span><br><span class="line">    Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (username == <span class="keyword">null</span>) &#123;  <span class="comment">// null判断是否有这个参数 和 参数长度为0不一样</span></span><br><span class="line">        map.put(<span class="string">&quot;error_message&quot;</span>, <span class="string">&quot;用户名不能为空&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (password == <span class="keyword">null</span> || confirmedPassword == <span class="keyword">null</span>) &#123;</span><br><span class="line">        map.put(<span class="string">&quot;error_message&quot;</span>, <span class="string">&quot;密码不能为空&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// .... 此处省略各种特判......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询数据库 验证用户名是否存在</span></span><br><span class="line">    QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    queryWrapper.eq(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(queryWrapper);</span><br><span class="line">    <span class="keyword">if</span> (!users.isEmpty()) &#123;</span><br><span class="line">        map.put(<span class="string">&quot;error_message&quot;</span>, <span class="string">&quot;用户名已存在&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新建用户</span></span><br><span class="line">    String encodedPassword = passwordEncoder.encode(password);</span><br><span class="line">    String photo = <span class="string">&quot;https://cdn.acwing.com/media/user/profile/photo/1_lg_844c66b332.jpg&quot;</span>;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="keyword">null</span>, username, encodedPassword, photo); <span class="comment">// id是自增的 所以不用传</span></span><br><span class="line">    userMapper.insert(user);</span><br><span class="line"></span><br><span class="line">    map.put(<span class="string">&quot;error_message&quot;</span>, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>最后在<code>controller</code>层映射指定路径到接口</p>
<p><code>controller/user/account/</code>中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RegisterController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RegisterService registerService; <span class="comment">// 生成之前实现的接口实例，这样可以调用接口里实现的方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user/account/register/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">register</span><span class="params">(<span class="meta">@RequestParam</span> Map&lt;String, String&gt; map)</span> </span>&#123;</span><br><span class="line">        String username = map.get(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">        String password = map.get(<span class="string">&quot;password&quot;</span>);</span><br><span class="line">        String confirmedPassword = map.get(<span class="string">&quot;confirmedPassword&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registerService.register(username, password, confirmedPassword);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="匹配系统"><a href="#匹配系统" class="headerlink" title="匹配系统"></a>匹配系统</h2><h3 id="1-前后端-WebSocekt-连接"><a href="#1-前后端-WebSocekt-连接" class="headerlink" title="1. 前后端 WebSocekt 连接"></a>1. 前后端 WebSocekt 连接</h3><h4 id="后端集成-WebSocket"><a href="#后端集成-WebSocket" class="headerlink" title="后端集成 WebSocket"></a>后端集成 WebSocket</h4><ol>
<li><p>在 pom.xml 文件中添加依赖：</p>
<ul>
<li><code>spring-boot-starter-websocket</code></li>
<li><code>fastjson</code></li>
</ul>
</li>
<li><p>添加<code>config.WebSocketConfig</code>配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpointExporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>添加<code>consumer.WebSocketServer</code>类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;token&#125;&quot;)</span>  <span class="comment">// 注意不要以&#x27;/&#x27;结尾</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保存所有的用户 静态变量 ConcurrentHashMap是进程安全的HashMap</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConcurrentHashMap&lt;Integer,WebSocketServer&gt; users =  <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 一个session对应一个user</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="keyword">private</span> Session session = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 匹配池</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> CopyOnWriteArraySet&lt;User&gt; matchPool = <span class="keyword">new</span> CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例模式注入UserMapper</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> UserMapper userMapper;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserMapper</span><span class="params">(UserMapper userMapper)</span></span>&#123;</span><br><span class="line">        WebSocketServer.userMapper = userMapper;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;token&quot;)</span> String token)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 建立连接</span></span><br><span class="line">		System.out.println(<span class="string">&quot;onOpen&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.session = session;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 关闭链接</span></span><br><span class="line">        System.out.println(<span class="string">&quot;onclose&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.user != <span class="keyword">null</span>)&#123;</span><br><span class="line">            users.remove(<span class="keyword">this</span>.user.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span><span class="params">(String message, Session session)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 从Client接收消息</span></span><br><span class="line">        System.out.println(<span class="string">&quot;onMessage&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnError</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Session session, Throwable error)</span> </span>&#123;</span><br><span class="line">        error.printStackTrace();</span><br><span class="line">        System.out.println(<span class="string">&quot;onError&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 发送消息给从Client</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>.session)&#123;  <span class="comment">// 锁</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.session.getBasicRemote().sendText(message);</span><br><span class="line">            &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>在<code>config.SecurityConfig</code>中添加如下代码，跳过 jwt 验证</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(WebSecurity web)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     web.ignoring().antMatchers(<span class="string">&quot;/websocket/**&quot;</span>);  <span class="comment">// 开发接口 跳过jwt验证</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="前端集成-WebSocket"><a href="#前端集成-WebSocket" class="headerlink" title="前端集成 WebSocket"></a>前端集成 WebSocket</h4><blockquote>
<p>前端有封装好的 WebSocket 类，直接调用相关 api 即可，这里没有跨域问题，直接使用后端端口就行</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socketUrl = <span class="string">`ws://localhost:3030/websocket/<span class="subst">$&#123;store.state.user.token&#125;</span>`</span>;</span><br><span class="line"><span class="keyword">let</span> socket: WebSocket | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line">onMounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 建立连接</span></span><br><span class="line">  socket = <span class="keyword">new</span> WebSocket(socketUrl);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 开始连接的钩子函数</span></span><br><span class="line">  socket.onopen = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onopen&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 向服务端发送消息</span></span><br><span class="line">  socket.send(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">event</span>: <span class="string">&quot;start-matching&quot;</span> &#125;));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 从服务端接收消息</span></span><br><span class="line">  socket.onmessage = <span class="function">(<span class="params">msg</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> data = <span class="built_in">JSON</span>.parse(msg.data);</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 结束连接的钩子函数</span></span><br><span class="line">  socket.onclose = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;onclose&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">onUnmounted(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 断开连接</span></span><br><span class="line">  socket?.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="2-创建微服务"><a href="#2-创建微服务" class="headerlink" title="2.创建微服务"></a>2.创建微服务</h3><ol>
<li><p>新建一个<code>backendcloud</code>项目，勾选<code>spring web</code>依赖</p>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307210913920.png" alt="image-20230307210913920" style="zoom: 67%;" />

 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307210957305.png" alt="image-20230307210957305" style="zoom: 67%;" /></li>
<li><p>删除其 src 文件，并在<code>pom.xml</code>文件中添加<code>&lt;packaging&gt;pom&lt;/packaging&gt;</code></p>
<blockquote>
<p>配置<code>&lt;packaging&gt;pom&lt;/packaging&gt;</code>的意思是使用 maven 分模块管理，都会有一个父级项目，pom 文件一个重要的属性就是 packaging（打包类型），一般来说所有的父级项目的 packaging 都为 pom，packaging 默认类型 jar 类型，如果不做配置，maven 会将该项目打成 jar 包。</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307211455062.png"></p>
</li>
<li><p>然后在<code>SpringCloud</code>项目中添加依赖：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a></p>
<ul>
<li>spring-cloud-dependencies</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;<span class="number">2021.0</span><span class="number">.3</span>&lt;/version&gt;</span><br><span class="line">	&lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">	&lt;scope&gt;<span class="keyword">import</span>&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>然后在<code>backendcloud</code>中新建一个<strong>模块</strong>，命名为<code>matchingsystem</code></p>
<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307211947105.png" alt="image-20230307211947105" style="zoom:67%;" /></li>
</ol>
  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307212543356.png" alt="image-20230307212543356" style="zoom:67%;" />

<ol start="5">
<li><p>将<code>backencloud</code>项目<code>pom.xml</code>中<code>spring Web</code>的依赖<strong>剪切</strong>到<code>matchingsystem</code>项目的<code>pom.xml</code>中，然后同步父项目<code>backencloud</code>和子项目<code>matchingsystem</code>的<code>maven</code>依赖。</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307212811987.png" alt="image-20230307212811987" style="zoom: 46%;" /><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307212930685.png" alt="image-20230307212930685" style="zoom: 62%;" /></p>
</li>
<li><p>在子项目<code>matchingsystem</code>下的<code>resources</code>文件夹下新建<code>application.properties</code>文件，并配置端口号</p>
<blockquote>
<p>注意：别和 backend 的端口重了</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307213327245.png" alt="image-20230307213327245"></p>
</li>
<li><p>在子项目<code>matchingsystem</code>下创建<code>service</code>和<code>controller</code>层，编写相关端口</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307213932988.png" alt="image-20230307213932988" style="zoom:50%;" />

<p>其中<code>MatchingController</code>的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchingController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MatchingService matchingService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/player/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addPlayer</span><span class="params">(<span class="meta">@RequestParam</span> MultiValueMap&lt;String, String&gt; data)</span> </span>&#123; <span class="comment">// 这里必须是MultiValueMap</span></span><br><span class="line">        Integer userId = Integer.parseInt(Objects.requireNonNull(data.getFirst(<span class="string">&quot;user_id&quot;</span>)));</span><br><span class="line">        Integer rating = Integer.parseInt(Objects.requireNonNull(data.getFirst(<span class="string">&quot;rating&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> matchingService.addPlayer(userId, rating);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/player/remove&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">removePlayer</span><span class="params">(<span class="meta">@RequestParam</span> MultiValueMap&lt;String, String&gt; data)</span> </span>&#123;</span><br><span class="line">        Integer userId = Integer.parseInt(Objects.requireNonNull(data.getFirst(<span class="string">&quot;user_id&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> matchingService.removePlayer(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>修改<code>security</code>，设置权限管理，只需要<code>backend</code>项目访问<code>matchingsystem</code>里的<code>addPlayer</code>和<code>removePlayer</code>接口。</p>
<ul>
<li><p>安装 security 依赖，并更新 maven</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.7</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>创建<code>config/SecurityConfig</code>，并配置<code>security</code><strong>只允许本地 iP 访问</strong></p>
  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307214820943.png" style="zoom:67%;" />

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.matchingsystem.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.http.SessionCreationPolicy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/player/add&quot;</span>, <span class="string">&quot;/player/remove&quot;</span>).hasIpAddress(<span class="string">&quot;127.0.0.1&quot;</span>)<span class="comment">//只允许本地访问</span></span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS).permitAll()</span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>将<code>matchingsystem</code>下的<code>Main</code>文件重命名为<code>MatchingSystemApplication</code>，并修改为<code>SpringWeb</code>的入口文件<img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307215346426.png" alt="image-20230307215346426"></p>
</li>
<li><p>启动<code>MatchingSystemApplication</code>项目，访问本地<code>3040</code>端口，结果如下，即为成功</p>
  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230307215529013.png" style="zoom:67%;" /></li>
<li><p>重新创建一个子模块<code>backend</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=<span class="string">&quot;C:\Users\chjm\AppData\Roaming\Typora\typora-user-images\image-20230310163002032.png&quot;</span> alt=<span class="string">&quot;image-20230310163002032&quot;</span> style=<span class="string">&quot;zoom:67%;&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<pre><code> 12. 删除其`src`文件夹，再将之前`backend`里的`src`文件复制过来，并将其`pom`里依赖复制过来。

 13.  创建`RestTemplateConfig`Bean，它的作用是**几个子项目之间通信**

     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

     并注入到`WebSocketServer`中：

     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/websocket/&#123;token&#125;&quot;)</span>  <span class="comment">// 注意不要以&#x27;/&#x27;结尾</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketServer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 子模块通信的url</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String addPlayerUrl =  <span class="string">&quot;http://127.0.0.1:3040/player/add&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String removePlayerUrl =  <span class="string">&quot;http://127.0.0.1:3040/player/remove&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注入RestTemplateConfig</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> RestTemplate restTemplate;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRestTemplate</span><span class="params">(RestTemplate restTemplate)</span> </span>&#123;</span><br><span class="line">        WebSocketServer.restTemplate = restTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开始匹配时</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">startMatching</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MultiValueMap&lt;String,String&gt; data = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">        data.add(<span class="string">&quot;user_id&quot;</span>,<span class="keyword">this</span>.user.getId().toString());</span><br><span class="line">        data.add(<span class="string">&quot;rating&quot;</span>,<span class="keyword">this</span>.user.getRating().toString());</span><br><span class="line">        restTemplate.postForObject(addPlayerUrl,data,String.class); <span class="comment">// 发送给匹配系统服务</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 结束匹配时</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span>  <span class="title">stopMatching</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MultiValueMap&lt;String,String&gt; data = <span class="keyword">new</span> LinkedMultiValueMap&lt;&gt;();</span><br><span class="line">        data.add(<span class="string">&quot;user_id&quot;</span>,<span class="keyword">this</span>.user.getId().toString());</span><br><span class="line">        restTemplate.postForObject(removePlayerUrl,data,String.class); <span class="comment">// 发送给匹配系统服务</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

     这里`restTemplate.postForObject(addPlayerUrl,data,String.class)`通过`post`给`matching Server`发送信息，而`Match Server`通过如下代码接受消息：

     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatchingController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MatchingService matchingService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/player/add&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addPlayer</span><span class="params">(<span class="meta">@RequestParam</span> MultiValueMap&lt;String, String&gt; data)</span> </span>&#123; <span class="comment">// 这里必须是MultiValueMap</span></span><br><span class="line">        Integer userId = Integer.parseInt(Objects.requireNonNull(data.getFirst(<span class="string">&quot;user_id&quot;</span>)));</span><br><span class="line">        Integer rating = Integer.parseInt(Objects.requireNonNull(data.getFirst(<span class="string">&quot;rating&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> matchingService.addPlayer(userId, rating);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</code></pre>
<h2 id="Bot-代码执行"><a href="#Bot-代码执行" class="headerlink" title="Bot 代码执行"></a>Bot 代码执行</h2><ol>
<li><p>创建<code>SpringCloud</code>的子项目<code>BotRunningSystem</code></p>
</li>
<li><p>在<code>BotRunningSystem</code>项目中添加依赖：<a target="_blank" rel="noopener" href="https://mvnrepository.com/">Maven 仓库地址</a></p>
<ul>
<li><code>joor-java-8</code>：java 代码编译</li>
<li><code>spring-cloud-dependencies</code></li>
<li><code>spring-boot-starter-security</code> ：网关</li>
<li><code>lombok</code> : 自动实现类的构建、getter、eques 方法</li>
</ul>
</li>
<li><p>创建<code>controller</code>,<code>service</code>,<code>config</code>等层，并创建启动文件<code>BotRunningSystemApplication</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BotRunningSystemApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 启动匹配池线程</span></span><br><span class="line">        <span class="comment">// 运行spring服务</span></span><br><span class="line">        SpringApplication.run(BotRunningSystemApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在<code>resources/application.properties</code>中配置端口号，并在<code>config</code>中创建如下文件：</p>
<p><code>RestTemplateConfig</code>，用于子服务之间通信</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        http.csrf().disable()</span><br><span class="line">                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS)</span><br><span class="line">                .and()</span><br><span class="line">                .authorizeRequests()</span><br><span class="line">                .antMatchers(<span class="string">&quot;/bot/add&quot;</span>).hasIpAddress(<span class="string">&quot;127.0.0.1&quot;</span>) <span class="comment">// 只允许本地访问</span></span><br><span class="line">                .antMatchers(HttpMethod.OPTIONS).permitAll()</span><br><span class="line">                .anyRequest().authenticated();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>SecurityConfig</code>，起到网关的作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestTemplateConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RestTemplate <span class="title">getRestTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="分页功能"><a href="#分页功能" class="headerlink" title="分页功能"></a>分页功能</h2><p>在<code>config.MybatisConfig</code>中添加分页配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * MyBatisPlus配置类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * MyBatisPlus拦截器（用于分页）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        <span class="comment">//添加MySQL的分页拦截器</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="spring-整合-Minio"><a href="#spring-整合-Minio" class="headerlink" title="spring 整合 Minio"></a>spring 整合 Minio</h2><h3 id="1-腾讯云-ubuntu-系统改为-root-登陆"><a href="#1-腾讯云-ubuntu-系统改为-root-登陆" class="headerlink" title="1. 腾讯云 ubuntu 系统改为 root 登陆"></a>1. 腾讯云 ubuntu 系统改为 root 登陆</h3><p>因为腾讯云默认不是 root 用户，无法通过 xftp 传输文件，所以这里需要先修改下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改 root 密码</span></span><br><span class="line">sudo passwd root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 ssh 配置</span></span><br><span class="line">sudo vi /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改PermitRootLogin 将它后面改为yes</span></span><br><span class="line">:/PermitRootLogin  <span class="comment"># 向光标之下寻找第一个值为word的字符串  按n为接着找下一个</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316100300151.png" alt="image-20230316100300151"></p>
<p>最后重启 ssh 服务即可,这样本地就可以通过 ssh 登录 root 用户了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service ssh restart</span><br></pre></td></tr></table></figure>

<h3 id="2-通过-docker-安装-Minio"><a href="#2-通过-docker-安装-Minio" class="headerlink" title="2. 通过 docker 安装 Minio"></a>2. 通过 docker 安装 Minio</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索是否有 minio 镜像</span></span><br><span class="line">docker search minio</span><br><span class="line"></span><br><span class="line"><span class="comment"># 有则拉取镜像</span></span><br><span class="line">docker pull minio/minio</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先创建minio 文件和配置 存放的位置</span></span><br><span class="line">sudo mkdir -p /home/chjm/docker/minio/data</span><br><span class="line">sudo mkdir -p /home/chjm/docker/minio/config</span><br></pre></td></tr></table></figure>

<h3 id="3-启动-及配置-Minio"><a href="#3-启动-及配置-Minio" class="headerlink" title="3. 启动 及配置 Minio"></a>3. 启动 及配置 Minio</h3><h4 id="配置https访问"><a href="#配置https访问" class="headerlink" title="配置https访问"></a>配置<code>https</code>访问</h4><p>需要将<code>ssl</code>证书中的<code>.key</code>，<code>.crt</code>，移动到<code>minio</code>的<code>/home/chjm/docker/minio/config</code>下面，并重命名为<code>private.key</code>和<code>public.crt</code>两个文件</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316103239444.png" alt="image-20230316103239444"></p>
<h4 id="启动-minio"><a href="#启动-minio" class="headerlink" title="启动 minio"></a>启动 minio</h4><p>这里需要在腾讯云开放 9000 和 9090 端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动并指定端口</span></span><br><span class="line">docker run -p 9000:9000 -p 9090:9090 \</span><br><span class="line">     --net=host \</span><br><span class="line">     --name minio \</span><br><span class="line">     -d --restart=always \</span><br><span class="line">     -e <span class="string">&quot;MINIO_ACCESS_KEY=chjm&quot;</span> \</span><br><span class="line">     -e <span class="string">&quot;MINIO_SECRET_KEY=ldx186729..&quot;</span> \</span><br><span class="line">     -e <span class="string">&quot;MINIO_SERVER_URL=https://chjm.online:9000&quot;</span> \</span><br><span class="line">     -v /home/chjm/docker/minio/data:/data  \</span><br><span class="line">     -v /home/chjm/docker/minio/config:/root/.minio  \</span><br><span class="line">     minio/minio server \</span><br><span class="line">     /data --console-address <span class="string">&quot;:9090&quot;</span> -address <span class="string">&quot;:9000&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里解释一下 docker 里面的几个参数</p>
<p>-p: 指定<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84&spm=1001.2101.3001.7020">端口映射</a>，格式为：主机（宿主）端口:容器端口</p>
<p>-e “MINIO_ROOT_USER=Jonny”: 设置环境变量；</p>
<p>-d: 后台运行容器，并返回容器 ID；</p>
<p>-v: 绑定一个卷</p>
<p>9090 端口指的是 minio 的客户端端口</p>
<p>MINIO_ACCESS_KEY ：账号</p>
<p>MINIO_SECRET_KEY ：密码（账号长度必须大于等于 5，密码长度必须大于等于 8 位）</p>
<p>MINIO_SERVER_URL ：ssl 证书绑定的域名 ，后面要加端口号 ，不然默认是 443</p>
<p>-v /home/chjm/docker/minio/config:/root/.minio : 修改 config 文件夹的地址</p>
</blockquote>
<h3 id="4-登录-Minio-服务端"><a href="#4-登录-Minio-服务端" class="headerlink" title="4.登录 Minio 服务端"></a>4.登录 Minio 服务端</h3><p>访问<a target="_blank" rel="noopener" href="https://chjm.online:9090/login%E8%BF%9B%E8%A1%8C%E7%9B%B8%E5%85%B3%E8%AE%BE%E7%BD%AE">https://chjm.online:9090/login进行相关设置</a></p>
<p>首先下载 key</p>
<p><img src="C:\Users\chjm\AppData\Roaming\Typora\typora-user-images\image-20230315091010457.png" alt="image-20230315091010457"></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230315091049492.png" alt="image-20230315091049492"></p>
<p>文件内容如下，保存文件，SDK 操作文件的 API 需要用到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;url&quot;</span>:<span class="string">&quot;http://127.0.0.1:9000&quot;</span>,<span class="string">&quot;accessKey&quot;</span>:<span class="string">&quot;PM9mZ2mFvU5jFHkz&quot;</span>,<span class="string">&quot;secretKey&quot;</span>:<span class="string">&quot;Sds7XdVDQX7sFgUm1MqIbEwPAc02H7yl&quot;</span>,<span class="string">&quot;api&quot;</span>:<span class="string">&quot;s3v4&quot;</span>,<span class="string">&quot;path&quot;</span>:<span class="string">&quot;auto&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>然后创建一个 bucket</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230315095349830.png" alt="image-20230315095349830" style="zoom: 67%;" />

<p>记得开放桶的权限</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230315183403197.png" alt="image-20230315183403197"></p>
<h3 id="4-SpringBoot-整合-MinIO"><a href="#4-SpringBoot-整合-MinIO" class="headerlink" title="4. SpringBoot 整合 MinIO"></a>4. SpringBoot 整合 MinIO</h3><h4 id="1-导入依赖"><a href="#1-导入依赖" class="headerlink" title="1.导入依赖"></a>1.导入依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/io.minio/minio --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.minio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>minio<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-application-yml-配置信息"><a href="#2-application-yml-配置信息" class="headerlink" title="2. application.yml 配置信息"></a>2. application.yml 配置信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">minio:</span><br><span class="line">  endpoint: https://chjm.online:9000 <span class="comment"># Minio服务所在地址</span></span><br><span class="line">  bucketName: kob <span class="comment">#存储桶名称</span></span><br><span class="line">  accessKey: PM9mZ2mFvU5jFHkz <span class="comment">#访问的key</span></span><br><span class="line">  secretKey: Sds7XdVDQX7sFgUm1MqIbEwPAc02H7yl <span class="comment">#访问的秘钥</span></span><br></pre></td></tr></table></figure>

<h4 id="3-MinioConfig-配置类"><a href="#3-MinioConfig-配置类" class="headerlink" title="3.MinioConfig 配置类"></a>3.MinioConfig 配置类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;minio&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinioConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKey;</span><br><span class="line">    <span class="keyword">private</span> String secretKey;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MinioClient <span class="title">minioClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> MinioClient.builder()</span><br><span class="line">                .endpoint(endpoint)</span><br><span class="line">                .credentials(accessKey, secretKey)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-MinioUtil-工具类"><a href="#4-MinioUtil-工具类" class="headerlink" title="4.MinioUtil 工具类"></a>4.MinioUtil 工具类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.utils;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MinioUtil</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioConfig prop;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MinioClient minioClient;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看存储bucket是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">bucketExists</span><span class="params">(String bucketName)</span> </span>&#123;</span><br><span class="line">        Boolean found;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            found = minioClient.bucketExists(BucketExistsArgs.builder().bucket(bucketName).build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> found;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建存储bucket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">makeBucket</span><span class="params">(String bucketName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient.makeBucket(MakeBucketArgs.builder()</span><br><span class="line">                    .bucket(bucketName)</span><br><span class="line">                    .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除存储bucket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">removeBucket</span><span class="params">(String bucketName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient.removeBucket(RemoveBucketArgs.builder()</span><br><span class="line">                    .bucket(bucketName)</span><br><span class="line">                    .build());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取全部bucket</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Bucket&gt; <span class="title">getAllBuckets</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            List&lt;Bucket&gt; buckets = minioClient.listBuckets();</span><br><span class="line">            <span class="keyword">return</span> buckets;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取当前时间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNowDate</span><span class="params">(String dateFormat)</span> </span>&#123;</span><br><span class="line">        Date currentTime = <span class="keyword">new</span> Date();</span><br><span class="line">        SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(dateFormat);</span><br><span class="line">        String dateString = formatter.format(currentTime);</span><br><span class="line">        <span class="keyword">return</span> dateString;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件上传</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file 文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">upload</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        String originalFilename = file.getOriginalFilename();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(originalFilename))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException();</span><br><span class="line">        &#125;</span><br><span class="line">        UUID uuid = UUID.randomUUID();</span><br><span class="line">        String uid = uuid.toString().substring(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">        String fileName = uid + originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">        String objectName = getNowDate(<span class="string">&quot;dd-MM-yyyy&quot;</span>) + <span class="string">&quot;/&quot;</span> + fileName;  <span class="comment">// 中间加个/ 意味着是在一个文件夹下</span></span><br><span class="line">        InputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            in = file.getInputStream();</span><br><span class="line">            PutObjectArgs objectArgs = PutObjectArgs.builder()</span><br><span class="line">                    .bucket(prop.getBucketName())</span><br><span class="line">                    .object(objectName)</span><br><span class="line">                    .stream(in, in.available(), -<span class="number">1</span>)</span><br><span class="line">                    .contentType(file.getContentType()).build();</span><br><span class="line">            <span class="comment">//文件名称相同会覆盖</span></span><br><span class="line">            minioClient.putObject(objectArgs);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objectName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 预览图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">preview</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 查看文件地址</span></span><br><span class="line">        GetPresignedObjectUrlArgs build = <span class="keyword">new</span> GetPresignedObjectUrlArgs().builder().bucket(prop.getBucketName()).object(fileName).method(Method.GET).build();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String url = minioClient.getPresignedObjectUrl(build);</span><br><span class="line">            <span class="keyword">return</span> url;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> res response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(String fileName, HttpServletResponse res)</span> </span>&#123;</span><br><span class="line">        GetObjectArgs objectArgs = GetObjectArgs.builder().bucket(prop.getBucketName())</span><br><span class="line">                .object(fileName).build();</span><br><span class="line">        <span class="keyword">try</span> (GetObjectResponse response = minioClient.getObject(objectArgs))&#123;</span><br><span class="line">            <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="keyword">int</span> len;</span><br><span class="line">            <span class="keyword">try</span> (FastByteArrayOutputStream os = <span class="keyword">new</span> FastByteArrayOutputStream())&#123;</span><br><span class="line">                <span class="keyword">while</span> ((len=response.read(buf))!=-<span class="number">1</span>)&#123;</span><br><span class="line">                    os.write(buf,<span class="number">0</span>,len);</span><br><span class="line">                &#125;</span><br><span class="line">                os.flush();</span><br><span class="line">                <span class="keyword">byte</span>[] bytes = os.toByteArray();</span><br><span class="line">                res.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                <span class="comment">// 设置强制下载不打开</span></span><br><span class="line">                <span class="comment">// res.setContentType(&quot;application/force-download&quot;);</span></span><br><span class="line">                res.addHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;fileName=&quot;</span> + fileName);</span><br><span class="line">                <span class="keyword">try</span> (ServletOutputStream stream = res.getOutputStream())&#123;</span><br><span class="line">                    stream.write(bytes);</span><br><span class="line">                    stream.flush();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查看文件对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 存储bucket内文件对象信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Item&gt; <span class="title">listObjects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Iterable&lt;Result&lt;Item&gt;&gt; results = minioClient.listObjects(</span><br><span class="line">                ListObjectsArgs.builder().bucket(prop.getBucketName()).build());</span><br><span class="line">        List&lt;Item&gt; items = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Result&lt;Item&gt; result : results) &#123;</span><br><span class="line">                items.add(result.get());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">remove</span><span class="params">(String fileName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            minioClient.removeObject( RemoveObjectArgs.builder().bucket(prop.getBucketName()).object(fileName).build());</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-文件处理接口"><a href="#5-文件处理接口" class="headerlink" title="5.文件处理接口"></a>5.文件处理接口</h4><h5 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h5><p><code>UploadImageService</code>层</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package com.kob.backend.service.user.account;</span><br><span class="line"></span><br><span class="line">@Component</span><br><span class="line">public interface UploadImageService &#123;</span><br><span class="line">    public JsonResult&lt;JSONObject&gt; uploadImage (MultipartFile file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UploadImageServiceImpl</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.service.impl.user.account;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadImageServiceImpl</span> <span class="keyword">implements</span> <span class="title">UploadImageService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioUtil minioUtil;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MinioConfig prop;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonResult&lt;JSONObject&gt; <span class="title">uploadImage</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        String objectName = minioUtil.upload(file);</span><br><span class="line">        JSONObject resp = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != objectName) &#123;</span><br><span class="line">            resp.put(<span class="string">&quot;url&quot;</span>,(prop.getEndpoint() + <span class="string">&quot;/&quot;</span> + prop.getBucketName() + <span class="string">&quot;/&quot;</span> + objectName));</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">new</span> JsonResult&lt;&gt;(resp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> JsonResult&lt;&gt;(<span class="number">1</span>,<span class="string">&quot;上传失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UploadImageController</code>层</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kob.backend.controller.user.account;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;api/user/account/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadImageController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UploadImageService uploadImageService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;uploadImage&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JsonResult&lt;JSONObject&gt; <span class="title">uploadImage</span><span class="params">(<span class="meta">@RequestBody</span> MultipartFile file)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  uploadImageService.uploadImage(file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h5><p>axio 接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">export function uploadImage(formData: FormData) &#123;</span><br><span class="line">  return hyRequest.post&lt;IDataType&lt;&#123; url: string &#125;&gt;&gt;(&#123;</span><br><span class="line">    url: userAPI.uploadImage,</span><br><span class="line">    data: formData,</span><br><span class="line">    showLoading: false,</span><br><span class="line">    // psot发送FormData类型的数据需将请求头设置为 multipart/form-data</span><br><span class="line">    headers: &#123; &quot;Content-Type&quot;: &quot;multipart/form-data&quot; &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vue 组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;el-upload action=&quot;none&quot; :auto-upload=&quot;false&quot; :on-change=&quot;handleUploadChange&quot;&gt;</span><br><span class="line">    &lt;el-button type=&quot;primary&quot;&gt;Click to upload&lt;/el-button&gt;</span><br><span class="line">  &lt;/el-upload&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script lang=&quot;ts&quot; setup&gt;</span><br><span class="line">const handleUploadChange: UploadProps[&quot;onChange&quot;] = async (</span><br><span class="line">  uploadFile,</span><br><span class="line">  uploadFiles</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  let formData = new FormData();</span><br><span class="line">  formData.append(&quot;file&quot;, uploadFile.raw as any);</span><br><span class="line">  const res = await uploadImage(formData);</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="上线服务"><a href="#上线服务" class="headerlink" title="上线服务"></a>上线服务</h2><h3 id="配置-docker-容器"><a href="#配置-docker-容器" class="headerlink" title="配置 docker 容器"></a>配置 docker 容器</h3><p>将<code>AC Terminal</code>里的<code>django_lesson:1.0</code>镜像传到服务器上</p>
<p><code>cd /var/lib/acwing/docker/images/</code></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314174452964.png" alt="image-20230314174452964"></p>
<p>然后在服务器上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># 将镜像加载到本地</span></span><br><span class="line">docker load -i django_lesson_1_0.tar</span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用该镜像，创建并启动一个容器，开放相关kob项目所需的端口，并设置name为kob_docker_server</span></span><br><span class="line">docker run -p 20000:22 -p 443:443 -p 80:80 -p 3030:3030 -p 3040:3040 -p 3050:3050 --name kob_docker_server -itd django_lesson:1.0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入创建的docker容器</span></span><br><span class="line">docker attach kob_docker_server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新root用户密码</span></span><br><span class="line">passwd</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里腾讯云里也要开启 20000 端口</p>
</blockquote>
<p>为防止 root 用户权限过大，导致误操作，先在 root 账户下添加一个新用户</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adduser chjm  <span class="comment"># 创建用户chjm</span></span><br><span class="line">usermod -aG chjm  <span class="comment"># 给用户chjm分配sudo权限</span></span><br><span class="line">adduser chjm sudo <span class="comment"># 将用户名chjm添加到sudoers文件</span></span><br><span class="line">su chjm  <span class="comment"># 切换到chjm用户</span></span><br></pre></td></tr></table></figure>

<p>然后<code>ctrl+p</code>,<code>ctrl+q</code>挂起，通过<code>ssh</code>进行连接，注意这里连接的端口号是<code>20000</code>，</p>
<p>然后将祖传配置传到<code>root</code>文件夹和<code>chjm</code>文件夹下</p>
<blockquote>
<p>这里登录 root 用户使用<code>xftp</code>传才有权限进入 root 目录</p>
</blockquote>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314181424294.png" alt="image-20230314181424294"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp .bashrc .vimrc .tmux.conf /root</span><br><span class="line">sudo cp .bashrc .vimrc .tmux.conf /home/chjm</span><br></pre></td></tr></table></figure>

<p>然后创建<code>/home/chjm/kob</code>文件夹，并在其中创建<code>backcloud</code>，<code>web</code>文件夹</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316105437026.png" alt="image-20230316105437026" style="zoom:67%;" />

<h3 id="安装、配置-mysql"><a href="#安装、配置-mysql" class="headerlink" title="安装、配置 mysql"></a>安装、配置 mysql</h3><p><strong>安装</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先更新</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo apt-get install mysql-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">sudo service mysql start <span class="comment"># 可以输入top 查看启动的进程</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登录</span></span><br><span class="line">sudo mysql -u root</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在mysql下设置root用户的密码</span></span><br><span class="line">ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED WITH caching_sha2_password BY <span class="string">&#x27;yourpasswd&#x27;</span>;  <span class="comment"># yourpasswd为要输入密码</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出</span></span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p><strong>登录<code>mysql</code>，创建<code>kob</code>数据库，并进入<code>kob</code></strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 密码登录</span></span><br><span class="line">sudo mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建kob数据库</span></span><br><span class="line">create database kob; <span class="comment"># show databases; 查看当前所有数据库</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入kob数据库</span></span><br><span class="line">use kob;</span><br><span class="line"></span><br><span class="line">show tables;  <span class="comment"># 可以查看当前所有表</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意 ：mysql 里面输入命令行 最后都需要加<code>；</code></p>
</blockquote>
<p><strong>在<code>kob</code>数据库下创建表：</strong></p>
<p>复制<code>idea</code>生产的 DDL</p>
  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230313211347346.png" alt="image-20230313211347346" style="zoom:67%;" />

<p>在云端创建 sql 文件，并将复制的 DDL 粘贴过去</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vim create_table.sql</span><br><span class="line">:<span class="built_in">set</span> paste</span><br><span class="line">i</span><br><span class="line"><span class="built_in">shift</span>+insert</span><br></pre></td></tr></table></figure>

  <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230313211806888.png" alt="image-20230313211806888" style="zoom:67%;" />

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 密码登录mysql</span></span><br><span class="line">sudo mysql -u root -p</span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入kob数据库</span></span><br><span class="line">use kob;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行脚本</span></span><br><span class="line"><span class="built_in">source</span> /home/chjm/kob/create_table.sql;</span><br></pre></td></tr></table></figure>

<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314183609263.png" alt="image-20230314183609263"></p>
<h3 id="安装-java"><a href="#安装-java" class="headerlink" title="安装 java"></a>安装 java</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先更新</span></span><br><span class="line">sudo apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo apt-get install openjdk-8-jdk</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证是否安装成功</span></span><br><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h3 id="打包后端"><a href="#打包后端" class="headerlink" title="打包后端"></a>打包后端</h3><p><code>pom.xml</code>中添加配置：</p>
<p>三个服务都需要进行如下配置：</p>
<p>添加一行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 打包的类型</span></span><br><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;</span><br></pre></td></tr></table></figure>

<p>以及打包的相关配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;!--这里写上main方法所在类的路径--&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;mainClass&gt;com.kob.backend.BackendApplication&lt;/mainClass&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">                &lt;execution&gt;</span><br><span class="line">                    &lt;goals&gt;</span><br><span class="line">                        &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                    &lt;/goals&gt;</span><br><span class="line">                &lt;/execution&gt;</span><br><span class="line">            &lt;/executions&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><mainClass>com.kob.backend.BackendApplication</mainClass> 要改为三个包主文件相符的路径</p>
</blockquote>
<p><strong>注意打包前修改下 mysql 数据库的账户和密码与服务器里数据库设置的要相匹配</strong></p>
<p>然后使用<code>maven</code>进行打包,会在三个文件夹里生产<code>target</code>目录</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314084612859.png" alt="image-20230314084612859"></p>
<p>将各自<code>target</code>中的<code>jar</code>文件传到服务器即可</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314091644554.png" alt="image-20230314091644554"></p>
<p>将三个<code>jar</code>文件移动到<code>chjm/kob/backendcloud</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将三个jar文件移动到当前目录</span></span><br><span class="line">cp ~/*.jar .</span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\chjm\AppData\Roaming\Typora\typora-user-images\image-20230316111656492.png" alt="image-20230316111656492"></p>
<p>然后使用<code>tmux</code>开启三个窗口，分别运行三个包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">运行java后端</span><br><span class="line">java -jar 包名</span><br><span class="line">sudo java -jar botrunningsystem-0.0.1-SNAPSHOT.jar  <span class="comment"># 注意因为这个服务需要读取文件 所以需要夹sudo权限</span></span><br></pre></td></tr></table></figure>

<h3 id="打包前端"><a href="#打包前端" class="headerlink" title="打包前端"></a>打包前端</h3><p>请求接口配置</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314203919574.png" alt="image-20230314203919574" style="zoom:67%;" />

<p>websocket 配置，这里需要改为 wss</p>
<blockquote>
<p>http 协议下使用 ws，在 https 协议下使用 wss</p>
<p>WS 一般默认是 80 端口，而 WSS 默认是 443 端口，大多数网站用的就是 80 和 433 端口</p>
</blockquote>
<p><img src="C:\Users\chjm\AppData\Roaming\Typora\typora-user-images\image-20230316141814490.png" alt="image-20230316141814490"></p>
<p>在打包后的<code>index.html</code>中添加如下代码，意思是自动将 http 的不安全请求升级为 https</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">&quot;upgrade-insecure-requests&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后将打包的 dist 文件夹内的内容复制到服务器端</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314204408094.png" alt="image-20230314204408094"></p>
<h3 id="设置-nginx"><a href="#设置-nginx" class="headerlink" title="设置 nginx"></a>设置 nginx</h3><p>部署<code>ssl</code>证书</p>
<p>在腾讯云申请后，点击下载，并选择<code>Nginx</code>的配置文件</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316091726912.png" alt="image-20230316091726912"></p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314095742527.png" alt="image-20230314095742527" style="zoom:67%;" />

<p>下载后如图：</p>
 <img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316091703426.png" alt="image-20230316091703426" style="zoom:67%;" />

<p>将<code>.key</code>和<code>.pem</code>文件传到到云端<code>etc/nginx/cert/</code>文件夹下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认是没有cert文件夹的</span></span><br><span class="line">sudo mkdir cert</span><br></pre></td></tr></table></figure>

<p>使用<code>xftp</code>传文件，<code>kob_docker_server</code>需要使用<code>root</code>账户登录<strong>才有权限</strong>进入<code>/etc</code>文件下</p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230316091807404.png" alt="image-20230316091807404"></p>
<p>将下列内容写入<code>/etc/nginx/.conf</code>配置文件中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled<span class="comment">/*.conf;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">events &#123;</span></span><br><span class="line"><span class="comment">	worker_connections 768;</span></span><br><span class="line"><span class="comment">	# multi_accept on;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">http &#123;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment">	# Basic Settings</span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	sendfile on;</span></span><br><span class="line"><span class="comment">	tcp_nopush on;</span></span><br><span class="line"><span class="comment">	tcp_nodelay on;</span></span><br><span class="line"><span class="comment">	keepalive_timeout 65;</span></span><br><span class="line"><span class="comment">	types_hash_max_size 2048;</span></span><br><span class="line"><span class="comment">	# server_tokens off;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	# server_names_hash_bucket_size 64;</span></span><br><span class="line"><span class="comment">	# server_name_in_redirect off;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	include /etc/nginx/mime.types;</span></span><br><span class="line"><span class="comment">	default_type application/octet-stream;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment">	# SSL Settings</span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE</span></span><br><span class="line"><span class="comment">	ssl_prefer_server_ciphers on;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment">	# Logging Settings</span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	access_log /var/log/nginx/access.log;</span></span><br><span class="line"><span class="comment">	error_log /var/log/nginx/error.log;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment">	# Gzip Settings</span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	gzip on;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	# gzip_vary on;</span></span><br><span class="line"><span class="comment">	# gzip_proxied any;</span></span><br><span class="line"><span class="comment">	# gzip_comp_level 6;</span></span><br><span class="line"><span class="comment">	# gzip_buffers 16 8k;</span></span><br><span class="line"><span class="comment">	# gzip_http_version 1.1;</span></span><br><span class="line"><span class="comment">	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment">	# Virtual Host Configs</span></span><br><span class="line"><span class="comment">	##</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	include /etc/nginx/conf.d/*.conf;</span></span><br><span class="line"><span class="comment">	include /etc/nginx/sites-enabled/*;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	server &#123;</span></span><br><span class="line"><span class="comment">         listen 80;</span></span><br><span class="line"><span class="comment">         server_name chjm.online;</span></span><br><span class="line"><span class="comment">         rewrite ^(.*)$ https://$&#123;server_name&#125;$1 permanent;</span></span><br><span class="line"><span class="comment">     	&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	server &#123;</span></span><br><span class="line"><span class="comment"> 		#SSL 默认访问端口号为 443</span></span><br><span class="line"><span class="comment"> 		listen 443 ssl;</span></span><br><span class="line"><span class="comment"> 		#请填写绑定证书的域名</span></span><br><span class="line"><span class="comment"> 		server_name chjm.online;</span></span><br><span class="line"><span class="comment"> 		#请填写证书文件的相对路径或绝对路径</span></span><br><span class="line"><span class="comment"> 		ssl_certificate  cert/chjm.online_bundle.pem;</span></span><br><span class="line"><span class="comment"> 		#请填写私钥文件的相对路径或绝对路径</span></span><br><span class="line"><span class="comment"> 		ssl_certificate_key cert/chjm.online.key;</span></span><br><span class="line"><span class="comment"> 		ssl_session_timeout 5m;</span></span><br><span class="line"><span class="comment"> 		#请按照以下套件配置，配置加密套件，写法遵循 openssl 标准。</span></span><br><span class="line"><span class="comment"> 		ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span></span><br><span class="line"><span class="comment"> 		#请按照以下协议配置</span></span><br><span class="line"><span class="comment"> 		ssl_protocols TLSv1.2 TLSv1.3;</span></span><br><span class="line"><span class="comment"> 		ssl_prefer_server_ciphers on;</span></span><br><span class="line"><span class="comment"> 		location / &#123;</span></span><br><span class="line"><span class="comment">   			#网站主页路径。此路径仅供参考，具体请您按照实际目录操作。</span></span><br><span class="line"><span class="comment">   			#例如，您的网站主页在 Nginx 服务器的 /etc/www 目录下，则请修改 root 后面的 html 为 /etc/www。</span></span><br><span class="line"><span class="comment">   			root /home/chjm/kob/web;</span></span><br><span class="line"><span class="comment">            	index index.html;</span></span><br><span class="line"><span class="comment">            	try_files $uri $uri/ /index.html;</span></span><br><span class="line"><span class="comment"> 		&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		location /api &#123;</span></span><br><span class="line"><span class="comment">            	proxy_pass http://127.0.0.1:3030;</span></span><br><span class="line"><span class="comment">        	&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">		location /websocket &#123;</span></span><br><span class="line"><span class="comment">            	proxy_pass http://127.0.0.1:3030;</span></span><br><span class="line"><span class="comment">            	proxy_set_header X-Real-IP $remote_addr;</span></span><br><span class="line"><span class="comment">            	proxy_set_header Host $http_host;</span></span><br><span class="line"><span class="comment">            	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">            	proxy_http_version 1.1;</span></span><br><span class="line"><span class="comment">            	proxy_set_header Upgrade $http_upgrade;</span></span><br><span class="line"><span class="comment">            	proxy_set_header Connection &quot;upgrade&quot;;</span></span><br><span class="line"><span class="comment">            	proxy_read_timeout  36000s;</span></span><br><span class="line"><span class="comment">        	&#125;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后启动<code>nginx</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/nginx start  <span class="comment"># 启动</span></span><br><span class="line"></span><br><span class="line">sudo /etc/init.d/nginx reload <span class="comment"># 重启动</span></span><br></pre></td></tr></table></figure>

<p>若为<code>fail</code></p>
<p><img src="https://picgocloud.oss-cn-shanghai.aliyuncs.com/picgo/image-20230314103040049.png" alt="image-20230314103040049"></p>
<p>可在<code>/var/log/nginxerror.log</code>查看报错信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /var/<span class="built_in">log</span>/nginx</span><br><span class="line">sudo vim error.log</span><br></pre></td></tr></table></figure>

<p>启动成功即可通过<a target="_blank" rel="noopener" href="https://chjm.online访问部署的网站/">https://chjm.online访问部署的网站</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Scenery</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://vernalscenery.github.io/2023/03/16/SprintBoot%E5%AD%A6%E4%B9%A0/">https://vernalscenery.github.io/2023/03/16/SprintBoot%E5%AD%A6%E4%B9%A0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://VernalScenery.github.io" target="_blank">春和景明的记事本</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/./img/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/03/17/hexo%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AB%AF/"><img class="prev-cover" src="/./img/1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">hexo部署云端</div></div></a></div><div class="next-post pull-right"><a href="/2023/01/15/Linux%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src="/./img/1.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/./img/1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Scenery</div><div class="author-info__description">今天不想跑，所以才去跑</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">5</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/chjm0121" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/1595718686@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#SprintBoot-%E6%A1%86%E6%9E%B6%E8%AF%BE"><span class="toc-text">SprintBoot 框架课</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-Mysql-%E4%B8%8E%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-text">配置 Mysql 与注册登录模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Mysql"><span class="toc-text">1. Mysql</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-mysql-%E6%9C%8D%E5%8A%A1%E7%9A%84%E5%85%B3%E9%97%AD%E4%B8%8E%E5%90%AF%E5%8A%A8"><span class="toc-text">1.1 mysql 服务的关闭与启动</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">1.2 常用操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-SpringBoot-%E9%85%8D%E7%BD%AE-mysql"><span class="toc-text">2. SpringBoot 配置 mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8E%A5%E5%8F%A3%E7%BC%96%E5%86%99%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B"><span class="toc-text">3.接口编写整体流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-SpringBoot-%E4%B8%AD%E7%9A%84%E5%90%84%E4%B8%AA%E5%B1%82"><span class="toc-text">3.1 SpringBoot 中的各个层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-text">3.2 具体实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BF%AE%E6%94%B9-Spring-Security"><span class="toc-text">4. 修改 Spring Security</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-text">4.1 安装相关依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E4%BF%AE%E6%94%B9-security"><span class="toc-text">4.2 修改 security</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-jwt-%E9%AA%8C%E8%AF%81"><span class="toc-text">5. jwt 验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%AE%89%E8%A3%85%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96"><span class="toc-text">5.1 安装相关依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E7%BC%96%E5%86%99-API"><span class="toc-text">5.2 编写 API</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E5%86%99-API-%E7%9A%84%E6%80%BB%E7%BB%93"><span class="toc-text">编写 API 的总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E7%B3%BB%E7%BB%9F"><span class="toc-text">匹配系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%89%8D%E5%90%8E%E7%AB%AF-WebSocekt-%E8%BF%9E%E6%8E%A5"><span class="toc-text">1. 前后端 WebSocekt 连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E9%9B%86%E6%88%90-WebSocket"><span class="toc-text">后端集成 WebSocket</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E9%9B%86%E6%88%90-WebSocket"><span class="toc-text">前端集成 WebSocket</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="toc-text">2.创建微服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bot-%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="toc-text">Bot 代码执行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E5%8A%9F%E8%83%BD"><span class="toc-text">分页功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#spring-%E6%95%B4%E5%90%88-Minio"><span class="toc-text">spring 整合 Minio</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%85%BE%E8%AE%AF%E4%BA%91-ubuntu-%E7%B3%BB%E7%BB%9F%E6%94%B9%E4%B8%BA-root-%E7%99%BB%E9%99%86"><span class="toc-text">1. 腾讯云 ubuntu 系统改为 root 登陆</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87-docker-%E5%AE%89%E8%A3%85-Minio"><span class="toc-text">2. 通过 docker 安装 Minio</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%90%AF%E5%8A%A8-%E5%8F%8A%E9%85%8D%E7%BD%AE-Minio"><span class="toc-text">3. 启动 及配置 Minio</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AEhttps%E8%AE%BF%E9%97%AE"><span class="toc-text">配置https访问</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8-minio"><span class="toc-text">启动 minio</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%99%BB%E5%BD%95-Minio-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="toc-text">4.登录 Minio 服务端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-SpringBoot-%E6%95%B4%E5%90%88-MinIO"><span class="toc-text">4. SpringBoot 整合 MinIO</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%AF%BC%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.导入依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-application-yml-%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF"><span class="toc-text">2. application.yml 配置信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-MinioConfig-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">3.MinioConfig 配置类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-MinioUtil-%E5%B7%A5%E5%85%B7%E7%B1%BB"><span class="toc-text">4.MinioUtil 工具类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%96%87%E4%BB%B6%E5%A4%84%E7%90%86%E6%8E%A5%E5%8F%A3"><span class="toc-text">5.文件处理接口</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-text">后端</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-text">前端</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E7%BA%BF%E6%9C%8D%E5%8A%A1"><span class="toc-text">上线服务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-docker-%E5%AE%B9%E5%99%A8"><span class="toc-text">配置 docker 容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E3%80%81%E9%85%8D%E7%BD%AE-mysql"><span class="toc-text">安装、配置 mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-java"><span class="toc-text">安装 java</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%90%8E%E7%AB%AF"><span class="toc-text">打包后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8C%85%E5%89%8D%E7%AB%AF"><span class="toc-text">打包前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-nginx"><span class="toc-text">设置 nginx</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/07/20/Java%E8%AF%AD%E6%B3%95/" title="Java语法">Java语法</a><time datetime="2024-07-20T01:46:49.000Z" title="发表于 2024-07-20 09:46:49">2024-07-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/17/hexo%E9%83%A8%E7%BD%B2%E4%BA%91%E7%AB%AF/" title="hexo部署云端">hexo部署云端</a><time datetime="2023-03-17T01:02:47.000Z" title="发表于 2023-03-17 09:02:47">2023-03-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/16/SprintBoot%E5%AD%A6%E4%B9%A0/" title="SprintBoot学习">SprintBoot学习</a><time datetime="2023-03-16T09:24:19.000Z" title="发表于 2023-03-16 17:24:19">2023-03-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/01/15/Linux%E5%AD%A6%E4%B9%A0/" title="Linux学习">Linux学习</a><time datetime="2023-01-15T08:19:19.000Z" title="发表于 2023-01-15 16:19:19">2023-01-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/02/01/vue3%E9%A1%B9%E7%9B%AE%E6%90%AD%E5%BB%BA/" title="vue3项目搭建">vue3项目搭建</a><time datetime="2022-02-01T04:14:08.000Z" title="发表于 2022-02-01 12:14:08">2022-02-01</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/./img/1.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Scenery</div><div class="footer_custom_text"><div>波澜不惊</div><div class="footer-div"><img class="footer-icon" src="./img/备案图标.png"><a class="footer-a" target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">皖ICP备2021016944号-1</a></div></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>